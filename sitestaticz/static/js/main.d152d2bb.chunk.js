(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",sim_container:"Simulator_sim_container__H7rj0",simulator:"Simulator_simulator__2tU1d",sim_hidden:"Simulator_sim_hidden__1ggwF",screen:"Simulator_screen__2Qp5p",header:"Simulator_header__2r6Gy",close:"Simulator_close__1RMuB",time:"Simulator_time__3FKl6",battery:"Simulator_battery__3Wa1Y",wifi:"Simulator_wifi__2E-6D",footer:"Simulator_footer__1_obl",reset:"Simulator_reset__1A78l",inactive:"Simulator_inactive__3bLl7",active:"Simulator_active__1MwaM",messages:"Simulator_messages__3Oalm",controls:"Simulator_controls__1TlMu",show_attachments_button:"Simulator_show_attachments_button__3LFcV",attachment_buttons:"Simulator_attachment_buttons__hDIT5",visible:"Simulator_visible__3BBvQ",drawer:"Simulator_drawer__340zx",drawer_visible:"Simulator_drawer_visible__1jBzI",forced:"Simulator_forced__19aUl",drawer_header:"Simulator_drawer_header__nlorO",map_thumb:"Simulator_map_thumb__1zB9o",audio_picker:"Simulator_audio_picker__V2K8X",audio_icon:"Simulator_audio_icon__Ve23Y",audio_message:"Simulator_audio_message___4Yvw",keypad:"Simulator_keypad__29cCi",keypad_entry:"Simulator_keypad_entry__2S4e_",keys:"Simulator_keys__W8GcS",row:"Simulator_row__mtRhr",key:"Simulator_key__Wv2KS",drawer_items:"Simulator_drawer_items__PYHpL",drawer_item:"Simulator_drawer_item__yZRIg",simulator_tab:"Simulator_simulator_tab__uRMHB",tab_hidden:"Simulator_tab_hidden__1BDkU",simulator_tab_icon:"Simulator_simulator_tab_icon__3cmxe",simulator_tab_text:"Simulator_simulator_tab_text__1aI0Q",detail_webhook_called:"Simulator_detail_webhook_called__1A8Iu",quick_replies:"Simulator_quick_replies__3wan9",quick_reply:"Simulator_quick_reply__sSRfK"}},119:function(e,t,n){e.exports={unicode_char:"UnicodeList_unicode_char__3oGkq",unicode_list:"UnicodeList_unicode_list__36pET"}},121:function(e,t,n){e.exports={scheme_selection:"AddURNForm_scheme_selection__3qqeb",path:"AddURNForm_path__vTuFJ"}},122:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",chosen:"MultiChoice_chosen__3fQUn",item:"MultiChoice_item__2hkE_"}},123:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",text:"SayMsg_text__2WoYr",recording:"SayMsg_recording__3JHw8"}},124:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",code:"TransferAirtime_code__3WV9i",amount:"TransferAirtime_amount__3mMNG"}},125:function(e,t,n){e.exports={optional_text_input:"OptionalTextInput_optional_text_input__N6zb8",toggle_link:"OptionalTextInput_toggle_link__3-B4a"}},126:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",errors:"ValidationFailures_errors__3qGX8",error:"ValidationFailures_error__2Q3Gg"}},128:function(e,t,n){e.exports={case_list:"CaseList_case_list__8CbuZ",kase:"CaseList_kase__1FwXZ"}},129:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",lead_in:"FieldRouterForm_lead_in__ShYLI",field_select:"FieldRouterForm_field_select__n0Csy"}},131:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",draggable:"CanvasDraggable_draggable__cqsGq",selected:"CanvasDraggable_selected__2GgF7"}},15:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",evt:"LogEvent_evt__1J8Uq",fadein:"LogEvent_fadein__kgfF4",msg_text:"LogEvent_msg_text__1HqoJ",ivr_msg:"LogEvent_ivr_msg__2pGYZ",send_msg:"LogEvent_send_msg__195Tn",msg_received:"LogEvent_msg_received__gf2kP",image_attachment:"LogEvent_image_attachment__2Ku4T",error:"LogEvent_error__2oBQ9",info:"LogEvent_info__12nsu",email:"LogEvent_email__1XyUb",webhook:"LogEvent_webhook__3jEK2",video_attachment:"LogEvent_video_attachment__2xn3C",audio_attachment:"LogEvent_audio_attachment__2iBWG",media_player:"LogEvent_media_player__22CtH",audio_text:"LogEvent_audio_text__3j-uW",email_details:"LogEvent_email_details__1f2TW",to:"LogEvent_to__H-JTa",subject:"LogEvent_subject__mN7Lz",body:"LogEvent_body__2hSdi",webhook_details:"LogEvent_webhook_details__3mtJW",response:"LogEvent_response__2oEy0",event_viewer:"LogEvent_event_viewer__2D4uw",has_detail:"LogEvent_has_detail__ZRVpP"}},16:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",clickable:"Dialog_clickable__1gSoh",dialog:"Dialog_dialog__16A3R",header:"Dialog_header__YD-Nm",header_overlay:"Dialog_header_overlay__1Of6F",header_icon:"Dialog_header_icon__2z4U8",title:"Dialog_title__1IRe1",barber:"Dialog_barber__3x6cp",iconed:"Dialog_iconed__2eQKD",title_container:"Dialog_title_container__2HiUa",content:"Dialog_content__1YGhY",footer:"Dialog_footer__3UylY",gutter:"Dialog_gutter__1Xxy-",buttons:"Dialog_buttons__1T0cB",left_buttons:"Dialog_left_buttons__31hp_",right_buttons:"Dialog_right_buttons__3NHBO",tabs:"Dialog_tabs__2gLgU",tab:"Dialog_tab__1x47g",tab_icon:"Dialog_tab_icon__28etF",active:"Dialog_active__3yOgq"}},178:function(e,t,n){e.exports=n.p+"static/media/map.5e547148.jpg"},183:function(e,t,n){e.exports={type_list:"TypeList_type_list__3OATW"}},186:function(e,t,n){e.exports={checkbox:"RemoveGroupsForm_checkbox__3W5g6"}},187:function(e,t,n){e.exports={value:"UpdateContactForm_value__19Fyz"}},188:function(e,t,n){e.exports={result_name:"AirtimeRouterForm_result_name__IPVnQ"}},19:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",option_list:"TextInputElement_option_list__18zXF",option_summary:"TextInputElement_option_summary__qaT6A",option_signature:"TextInputElement_option_signature__3c1zs",option:"TextInputElement_option__5N_r_",selected:"TextInputElement_selected__2bCI1",first_option:"TextInputElement_first_option__2owME",fn_marker:"TextInputElement_fn_marker__38I-n",function_help:"TextInputElement_function_help__2jwVQ",completion_container:"TextInputElement_completion_container__3c00R",options_wrapper:"TextInputElement_options_wrapper__2knDu",fn_container:"TextInputElement_fn_container__3tmtw",option_name:"TextInputElement_option_name__2G-0k",option_examples:"TextInputElement_option_examples__2l6sa",fn_signature:"TextInputElement_fn_signature__efYOL",wrapper:"TextInputElement_wrapper__1q0lN",help:"TextInputElement_help__1dGMQ",hidden:"TextInputElement_hidden__3Xul8",textinput:"TextInputElement_textinput__2eOxW"}},190:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",lead_in:"DigitsRouterForm_lead_in__1_8u2"}},191:function(e,t,n){e.exports={result_name:"ResthookRouterForm_result_name__dcAsY"}},192:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",result_name:"WaitRouterForm_result_name__1QlYs"}},193:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",loading:"Loading_loading__3-t_e",pulse:"Loading_pulse__apphI"}},195:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",empty_flow:"Flow_empty_flow__roKNh"}},20:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",exit:"Exit_exit__36tB1",translating:"Exit_translating__mA2Hf",unnamed_exit:"Exit_unnamed_exit__1H6-H",endpoint:"Exit_endpoint__1D08c",missing_localization:"Exit_missing_localization__h2WGJ",name:"Exit_name__22WdX",activity:"Exit_activity__11sTW",count:"Exit_count__1tNM8",confirm_delete:"Exit_confirm_delete__26Wo-",confirm_x:"Exit_confirm_x__1AODA",recent_messages:"Exit_recent_messages__1wUzf",no_recents:"Exit_no_recents__R97kK",title:"Exit_title__3Ugsu",loading:"Exit_loading__37ssZ",message:"Exit_message__Q_zU9",text:"Exit_text__1-x4W",sent:"Exit_sent__1DkCx"}},200:function(e,t,n){e.exports=n(406)},201:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13"}},202:function(e,t,n){},21:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",yellow:"Sticky_yellow__39XW4",color_option:"Sticky_color_option__32vU5",sticky:"Sticky_sticky__3QUKK",blue:"Sticky_blue__3s2JL",purple:"Sticky_purple__278EO",gray:"Sticky_gray__39re9",green:"Sticky_green__3BQ0M",color_chooser_container:"Sticky_color_chooser_container__2lT4F",color_chooser:"Sticky_color_chooser__3Jbqj",sticky_container:"Sticky_sticky_container__CAgg9",selected:"Sticky_selected__1Ra33",removal:"Sticky_removal__2Ktvw",title_wrapper:"Sticky_title_wrapper__2QWs9",remove_button:"Sticky_remove_button__2jDO8",title:"Sticky_title__1kkPN",confirmation:"Sticky_confirmation__wEJ6P",body_wrapper:"Sticky_body_wrapper__3vHL0",body:"Sticky_body__18mNO"}},23:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",node_container:"Node_node_container__2eaRs",uuid:"Node_uuid__1gU_w",ghost:"Node_ghost__1rJWj",nondragged:"Node_nondragged__3odZa",selected:"Node_selected__1ck3F",node:"Node_node__2ympr",save_as:"Node_save_as__27Fv-",save_result:"Node_save_result__cnC6y",result_name:"Node_result_name__1F10Q",cropped:"Node_cropped__3mV37",exit_table:"Node_exit_table__3NybR",exits:"Node_exits__3zABv",add:"Node_add__3PamH",drag_group:"Node_drag_group__1h4JV",flow_start:"Node_flow_start__2ZLmX",flow_start_message:"Node_flow_start_message__21Gdu",active:"Node_active__31xXM",pulse:"Node_pulse__14AYP"}},25:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",link:"WebhookRouterForm_link__1jXIk",info:"WebhookRouterForm_info__qgGFO",method:"WebhookRouterForm_method__1IR0U",url:"WebhookRouterForm_url__T29iJ",code:"WebhookRouterForm_code__3x1A-",instructions:"WebhookRouterForm_instructions__3LG_X",headers_title:"WebhookRouterForm_headers_title__1GMIG",remove_ico:"WebhookRouterForm_remove_ico__l-jUh",example:"WebhookRouterForm_example__1ev4D",header:"WebhookRouterForm_header__2waYT",header_name:"WebhookRouterForm_header_name__3eQVG",header_value:"WebhookRouterForm_header_value__1Fxrk",body_form:"WebhookRouterForm_body_form__3BHas",req_body:"WebhookRouterForm_req_body__1rKz_"}},26:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",simulating:"RevisionExplorer_simulating__3ar2x",mask:"RevisionExplorer_mask__14GgE",visible:"RevisionExplorer_visible__365U6",explorer_wrapper:"RevisionExplorer_explorer_wrapper__3FIUU",explorer:"RevisionExplorer_explorer__1yYSY",revisions:"RevisionExplorer_revisions__1nYCu",revision:"RevisionExplorer_revision__3f_kl",selected:"RevisionExplorer_selected__2zSg4",button:"RevisionExplorer_button__2srjQ",current:"RevisionExplorer_current__Zlqcr",created_on:"RevisionExplorer_created_on__qKoNX",email:"RevisionExplorer_email__Z9xlH"}},28:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",ele:"FormElement_ele__1FpYO",border:"FormElement_border__3bx0s",error_list:"FormElement_error_list__1SrT3",error:"FormElement_error__1Peb9",arrow_up:"FormElement_arrow_up__2HvAv",send_msg_error:"FormElement_send_msg_error__3LIUw",label:"FormElement_label__2dN0p",invalid:"FormElement_invalid__1fOa-",help_text:"FormElement_help_text__a6EcV"}},29:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",action:"Action_action__NVQRK",has_router:"Action_has_router__1Ad-S",body:"Action_body__RtQCZ",add_contact_urn:"Action_add_contact_urn__3Z706",add_input_labels:"Action_add_input_labels__3IeO3",send_msg:"Action_send_msg__1QYPk",set_contact_field:"Action_set_contact_field__1HDvu",set_contact_name:"Action_set_contact_name__1woBb",call_webhook:"Action_call_webhook__2kR_s",call_resthook:"Action_call_resthook__2zGlX",set_contact_language:"Action_set_contact_language__G9Ko5",set_contact_channel:"Action_set_contact_channel__1YEwX",add_contact_groups:"Action_add_contact_groups__3H0fU",remove_contact_groups:"Action_remove_contact_groups__3h7vs",play_audio:"Action_play_audio__ShGHx",say_msg:"Action_say_msg__3CqFc",set_run_result:"Action_set_run_result__1CLz_",send_email:"Action_send_email__2MDnO",send_broadcast:"Action_send_broadcast__1SCyf",transfer_airtime:"Action_transfer_airtime__2LvoA",missing:"Action_missing__1Ghl9",enter_flow:"Action_enter_flow__2ogxI",start_session:"Action_start_session__1yM-7",not_localizable:"Action_not_localizable__2rKMk",overlay:"Action_overlay__ZEDK0",translate_from:"Action_translate_from__3BID_",translate_to:"Action_translate_to__TPeJw",translating:"Action_translating__2n0n7",missing_localization:"Action_missing_localization__1zslf",localized:"Action_localized__3Mwip"}},30:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",group:"CaseElement_group__1fyWB",divider:"CaseElement_divider__mkeU9",kase:"CaseElement_kase__2vP_O",form_group:"CaseElement_form_group__1PJTx",choice:"CaseElement_choice__2RZct",single_operand:"CaseElement_single_operand__o0kaN",multi_operand:"CaseElement_multi_operand__eTLuc",categorize_as:"CaseElement_categorize_as__XFySp",category:"CaseElement_category__2yfW1",remove_icon:"CaseElement_remove_icon__1PFzv",dnd_icon:"CaseElement_dnd_icon__wjvHF",relative_date:"CaseElement_relative_date__DGZXt",empty:"CaseElement_empty__35kBB"}},34:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",checkbox:"SendMsgForm_checkbox__-JOyy",quick_reply_summary:"SendMsgForm_quick_reply_summary__DkA4i",type_choice:"SendMsgForm_type_choice__1dciq",url_attachment:"SendMsgForm_url_attachment__1Su5F",upload:"SendMsgForm_upload__22kwL",remove_upload:"SendMsgForm_remove_upload__2qqap",url:"SendMsgForm_url__2eR-o",remove:"SendMsgForm_remove__20sFL",existing_quick_replies:"SendMsgForm_existing_quick_replies__W866I",existing_quick_reply:"SendMsgForm_existing_quick_reply__2C65m",add_quick_replies:"SendMsgForm_add_quick_replies__3vLIC",template_text:"SendMsgForm_template_text__1zkKJ",variable:"SendMsgForm_variable__3mVDI"}},38:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",pop_wrapper:"PopTab_pop_wrapper__2kOzQ",visible:"PopTab_visible__2udNm",popped:"PopTab_popped__2Imlz",tab_wrapper:"PopTab_tab_wrapper__3n1QM",tab:"PopTab_tab__2Rm5M",label:"PopTab_label__nf1JX",icon:"PopTab_icon__irClb",header:"PopTab_header__1NqmE",header_label:"PopTab_header_label__2YD7z",close:"PopTab_close__3O5BS"}},39:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",random:"shared_random__URuHQ",wait_for_audio:"shared_wait_for_audio__1LjH-",wait_for_image:"shared_wait_for_image__3VU9W",wait_for_video:"shared_wait_for_video__1nv-a",wait_for_location:"shared_wait_for_location__2al5E",wait_for_menu:"shared_wait_for_menu__hot7M",wait_for_digits:"shared_wait_for_digits__35WPZ",wait_for_response:"shared_wait_for_response__ZKUbx",add_contact_groups:"shared_add_contact_groups__2dqfS",remove_contact_groups:"shared_remove_contact_groups__1dJrQ",send_email:"shared_send_email__dY51y",send_broadcast:"shared_send_broadcast__3LXs5",msg:"shared_msg__28OwU",say_msg:"shared_say_msg__2U3R0",send_msg:"shared_send_msg__2tEfv",transfer_airtime:"shared_transfer_airtime__1H5tV",enter_flow:"shared_enter_flow__XHnXb",start_session:"shared_start_session__1f3aq",set_run_result:"shared_set_run_result__1QltP",add_input_labels:"shared_add_input_labels__2pTX0",add_contact_urn:"shared_add_contact_urn__3nXG-",set_contact_name:"shared_set_contact_name__KV1Re",set_contact_field:"shared_set_contact_field__3VSZH",set_contact_language:"shared_set_contact_language__4ZBkW",set_contact_channel:"shared_set_contact_channel__3NhjI",play_audio:"shared_play_audio__2OF7K",missing:"shared_missing__2oICX",subflow:"shared_subflow__yzbLM",split_by_random:"shared_split_by_random__Zh1SY",split_by_expression:"shared_split_by_expression__3k23C",split_by_groups:"shared_split_by_groups__5EnH4",split_by_contact_field:"shared_split_by_contact_field__1XjX5",split_by_run_result:"shared_split_by_run_result__X4-Wp",call_resthook:"shared_call_resthook__16wqp",call_webhook:"shared_call_webhook__1h1Cb",breaks:"shared_breaks__2F4AL",url:"shared_url__1vtQK",node_asset:"shared_node_asset__2MOdQ",node_group:"shared_node_group__ju7iK",node_label:"shared_node_label__1lQNA",advanced_title:"shared_advanced_title__2auaT",alert:"shared_alert__1JnkA"}},40:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",lead_in:"ResultRouterForm_lead_in__2myeK","lead-in-sub":"ResultRouterForm_lead-in-sub__2X4uS",result_select:"ResultRouterForm_result_select__1cu2c","result-select-delimited":"ResultRouterForm_result-select-delimited__p3SFC",should_delimit:"ResultRouterForm_should_delimit__1Z8-4",field_number:"ResultRouterForm_field_number__2WFxV",delimiter:"ResultRouterForm_delimiter__2i5Hr"}},406:function(e,t,n){"use strict";n.r(t);n(201),n(202);var a,i,r,o,s,l,u,c,d,p=n(1),h=n(2),m=n(5),v=n(3),f=n(6),g=n(4),_=n(9),y=n(7),b=n(0),k=n.n(b),C=n(22),E=n(8);!function(e){e.switch="switch",e.random="random"}(a||(a={})),function(e){e.msg="msg"}(i||(i={})),function(e){e.digits="digits",e.audio="audio",e.image="image",e.video="video",e.location="location"}(r||(r={})),function(e){e.UUID="uuid",e["Created By"]="created_by",e["Modified By"]="modified_by",e.Org="org",e.Name="name",e.Language="language",e.Timezone="timezone",e.Channel="channel",e.Email="email",e.Mailto="mailto",e.Phone="phone",e.Groups="groups"}(o||(o={})),function(e){e.text="text",e.numeric="numeric",e.datetime="datetime",e.state="state",e.district="district",e.ward="ward"}(s||(s={})),function(e){e.Complete="C",e.Expired="E"}(l||(l={})),function(e){e.Complete="Complete",e.Expired="Expired"}(u||(u={})),function(e){e.Success="Success",e.Failure="Failure"}(c||(c={})),function(e){e.Success="Success",e.Failure="Failed"}(d||(d={}));var w,O=function(){function e(t,n){var a=n.id,i=n.name;Object(p.a)(this,e),this.localizedKeys={},this.localizedObject=void 0,this.localized=!1,this.iso=void 0,this.name=void 0,this.language=void 0,this.localizedObject=t,this.iso=a,this.language={iso:this.iso,name:i}}return Object(h.a)(e,[{key:"getLanguage",value:function(){return this.language||this.iso&&(this.language={iso:this.iso,name:this.name}),this.language}},{key:"hasTranslation",value:function(e){return e in this.localizedKeys}},{key:"addTranslation",value:function(e,t){this.localized||(this.localizedObject=Object.assign({},this.localizedObject),this.localized=!0),Array.isArray(this.localizedObject[e])?this.localizedObject[e]=t:1===t.length&&(this.localizedObject[e]=t[0]),this.localizedKeys[e]=!0}},{key:"isLocalized",value:function(){return this.localized}},{key:"getObject",value:function(){return this.localizedObject}}]),e}(),S=function(){function e(){Object(p.a)(this,e)}return Object(h.a)(e,null,[{key:"translate",value:function(e,t,n){var a=new O(e,t);if(n&&e.uuid in n){var i=n[e.uuid];Object.keys(i).forEach(function(e){return a.addTranslation(e,i[e])})}return a}}]),e}(),N=n(117),x=n(87),j=n.n(x),T=/\s+(?=\S)/g,R=parseInt(j.a.grid_size,10)||20,U=parseInt(j.a.node_spacing,10)||10,A=parseInt(j.a.node_padding,10)||10,D=function(e,t){var n=e%R,a=t%R;return n>R/3?n=R-n:n*=-1,a>R/3?a=R-a:a*=-1,{left:Math.max(e+n,0),top:Math.max(t+a,0)}},F=function(e){var t=e.left%R,n=e.top%R;t>R/3?t=R-t:t*=-1,n>R/3?n=R-n:n*=-1;var a=Math.max(e.left+t,0),i=Math.max(e.top+n,0);return{left:a,top:i,right:a+e.right-e.left,bottom:i+e.bottom-e.top}},P=function(e){return e.toLowerCase().trim().replace(T,"_")},I=function(e){return e.replace(/\b\w+/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},M=function(e){return 0===e?"select-base":"select-base select-invalid"},L=function(e,t){if(!e.length)return!1;var n=!0,a=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,l=!0,u=!1,c=void 0;try{for(var d,p=t[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var h=d.value;if(s.match(h))return!0}}catch(m){u=!0,c=m}finally{try{l||null==p.return||p.return()}finally{if(u)throw c}}}}catch(m){a=!0,i=m}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return!1},z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2?arguments[2]:void 0;return{onMouseDown:function(e){n&&n(e)},onMouseUp:function(n){t&&t()||e(n)}}},B=function(e,t,n){return S.translate(e,n,t[n.id])},V=function(e){return b.createElement("span",{className:"emph"},e)},G=function(e){return function(t,n){return e?t:n||null}},q=function(e){return null!==e&&void 0!==e},K=function(e){return!1},W=function(e){return{$set:e}},Y=function(e){return{$merge:e}},H=function(e){return{$unset:e}},X=function(e){return{$push:e}},Q=function(e){return{$splice:e}},$=function(){return Object(N.v4)()},Z=function(e,t){return Array.from({length:t-e},function(t,n){return n+e})},J=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"s";return"".concat(t).concat(1!==e?n:"")},ee=n(65),te=n.n(ee);!function(e){e.primary="primary",e.secondary="secondary",e.tertiary="tertiary"}(w||(w={}));var ne,ae=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={active:!1},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleMouseDown",value:function(e){this.setState({active:!0})}},{key:"handleMouseUp",value:function(e){this.setState({active:!1})}},{key:"render",value:function(){var e=this.props,t=e.onRef,n=e.name,a=e.onClick,i=e.type,r=e.disabled,o=e.leftSpacing,s=e.topSpacing,l=e.iconName;return b.createElement("div",{ref:t,style:{marginLeft:o?10:0,marginTop:s?10:0},onClick:a,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,className:"".concat(te.a.btn," ").concat(te.a[i]," ").concat(r?te.a.disabled:""," ").concat(this.state.active?te.a.active:"")},G(null!=l)(b.createElement("span",{style:{paddingRight:4},className:l})),n)}}]),t}(b.Component),ie=n(39),re=n.n(ie),oe=n(16),se=n.n(oe);!function(e){e.NORMAL="normal",e.BARBER="barber"}(ne||(ne={}));var le,ue=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).tabFocus=null,n.primaryButton=null,n.state={activeTab:-1},Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^get/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"showTab",value:function(e){this.setState({activeTab:e})}},{key:"handlePrimaryButton",value:function(e){var t=this;e(),this.tabFocus=window.setTimeout(function(){var e=!1;(t.props.tabs||[]).forEach(function(n,a){if(n.hasErrors)return t.setState({activeTab:a}),void(e=!0)}),e||t.setState({activeTab:-1})},0)}},{key:"handleKey",value:function(e){"Enter"===e.key&&e.shiftKey&&(this.primaryButton?(e.preventDefault(),e.stopPropagation(),e.target.blur(),this.primaryButton.click(),e.target.focus()):console.log("No primary button!"))}},{key:"componentDidMount",value:function(){window.document.addEventListener("keydown",this.handleKey,{capture:!0})}},{key:"componentWillUnmount",value:function(){window.clearTimeout(this.tabFocus),window.document.removeEventListener("keydown",this.handleKey,{capture:!0})}},{key:"getButtons",value:function(){var e=this,t=[],n=this.props.buttons||{primary:null,secondary:null,tertiary:null};n.secondary&&t.push(b.createElement(ae,Object.assign({key:0,type:w.secondary},n.secondary))),n.primary&&t.push(b.createElement(ae,{key:"button_"+n.primary.name,onRef:function(t){e.primaryButton=t},onClick:function(){e.handlePrimaryButton(n.primary.onClick)},leftSpacing:!0,name:n.primary.name,disabled:n.primary.disabled,type:w.primary}));var a=[];return n.tertiary&&a.push(b.createElement(ae,Object.assign({key:0,type:w.tertiary},n.tertiary))),{leftButtons:a,rightButtons:t}}},{key:"render",value:function(){var e=this,t=[se.a.header];this.state.activeTab>-1&&t.push(se.a.clickable),this.props.headerClass&&t.push(re.a[this.props.headerClass]),this.props.headerIcon&&t.push(se.a.iconed),this.props.headerStyle===ne.BARBER&&t.push(se.a.barber);var n=[se.a.dialog],a=this.getButtons(),i=a.leftButtons,r=a.rightButtons;return this.props.className&&n.push(this.props.className),b.createElement("div",{className:n.join(" ")},(this.props.tabs||[]).length>0?b.createElement("div",{className:se.a.tabs},(this.props.tabs||[]).map(function(t,n){return b.createElement("div",{key:"tab_"+t.name,className:se.a.tab+" "+(n===e.state.activeTab?se.a.active:""),onClick:function(t){t.stopPropagation(),e.setState({activeTab:n})}},t.name," ",t.icon?b.createElement("span",{className:se.a.tab_icon+" "+t.icon}):null,t.checked?b.createElement("span",{className:se.a.tab_icon+" fe-check"}):null)})):null,b.createElement("div",{onClick:function(){e.setState({activeTab:-1})},className:t.join(" ")},this.state.activeTab>-1?b.createElement("div",{className:se.a.header_overlay}):null,G(void 0!==this.props.headerIcon)(b.createElement("span",{className:"".concat(se.a.header_icon," ").concat(this.props.headerIcon)})),b.createElement("div",{className:se.a.title_container},b.createElement("div",{className:se.a.title},this.props.title),b.createElement("div",{className:se.a.subtitle},this.props.subtitle))),b.createElement("div",{className:this.props.noPadding?"":se.a.content},this.state.activeTab>-1?this.props.tabs[this.state.activeTab].body:this.props.children),b.createElement("div",{className:se.a.footer},b.createElement("div",{className:se.a.buttons},G(i.length>0)(b.createElement("div",{className:se.a.left_buttons},i)),G(null!=this.props.gutter)(b.createElement("div",{className:se.a.gutter},this.props.gutter)),b.createElement("div",{className:se.a.right_buttons},r))))}}]),t}(b.Component),ce=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,n.state={top:0,fixed:!1},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleScroll",value:function(){var e=window.scrollY>this.state.top;this.setState({fixed:e})}},{key:"componentWillUnmount",value:function(){window.removeEventListener("scroll",this.handleScroll)}},{key:"componentDidMount",value:function(){var e=this.ele.getBoundingClientRect().top+window.scrollY,t=window.scrollY>e;this.setState({top:e,fixed:t}),window.addEventListener("scroll",this.handleScroll)}},{key:"render",value:function(){var e=this,t={position:"absolute"};return this.state.fixed&&(t={position:"fixed",top:0}),b.createElement("div",{ref:function(t){e.ele=t},style:t},this.props.children)}}]),t}(b.PureComponent),de=n(13);!function(e){e.UPDATE_EDITOR_STATE="UPDATE_EDITOR_STATE",e.UPDATE_NODE_EDITOR_SETTINGS="UPDATE_NODE_EDITOR_SETTINGS",e.UPDATE_TRANSLATING="UPDATE_TRANSLATING",e.UPDATE_BASE_LANGUAGE="UPDATE_BASE_LANGUAGE",e.UPDATE_LANGUAGES="UPDATE_LANGUAGES",e.UPDATE_LANGUAGE="UPDATE_LANGUAGE",e.UPDATE_FETCHING_FLOW="FETCHING_FLOW",e.UPDATE_DEFINITION="UPDATE_DEFINITION",e.UPDATE_NODE_DRAGGING="UPDATE_NODE_DRAGGING",e.UPDATE_FLOWS="UPDATE_FLOWS",e.UPDATE_DEPENDENCIES="UPDATE_DEPENDENCIES",e.UPDATE_PENDING_CONNECTIONS="UPDATE_PENDING_CONNECTIONS",e.REMOVE_PENDING_CONNECTION="REMOVE_PENDING_CONNECTION",e.UPDATE_COMPONENTS="UPDATE_COMPONENTS",e.UPDATE_CONTACT_FIELDS="UPDATE_CONTACT_FIELDS",e.UPDATE_GROUPS="UPDATE_GROUPS",e.UPDATE_RESULT_MAP="UPDATE_RESULT_MAP",e.UPDATE_ASSET_MAP="UPDATE_ASSET_MAP",e.UPDATE_NODES="UPDATE_NODES",e.UPDATE_EXITS="UPDATE_EXITS",e.UPDATE_NODE_EDITOR_OPEN="UPDATE_NODE_EDITOR_OPEN",e.UPDATE_CREATE_NODE_POSITION="UPDATE_CREATE_NODE_POSITION",e.UPDATE_DRAG_GROUP="UPDATE_DRAG_GROUP",e.UPDATE_TYPE_CONFIG="UPDATE_TYPE_CONFIG",e.UPDATE_USER_ADDING_ACTION="UPDATE_USER_ADDING_ACTION",e.INCREMENT_SUGGESTED_RESULT_NAME_COUNT="INCREMENT_SUGGESTED_RESULT_NAME_COUNT"}(le||(le={}));var pe,he=le;!function(e){e.Channel="channel",e.Currency="currency",e.Template="template",e.Revision="revision",e.Flow="flow",e.Group="group",e.Field="field",e.Result="result",e.Contact="contact",e.Resthook="resthook",e.URN="urn",e.Label="label",e.Language="language",e.Environment="environment",e.Remove="remove",e.ContactProperty="property",e.Scheme="scheme",e.Expression="expression"}(pe||(pe={}));var me,ve,fe,ge={id:pe.Remove,name:"Remove Value",type:pe.Remove},_e={id:"base",name:"Default",type:pe.Language},ye={definition:null,dependencies:null,baseLanguage:null,contactFields:{},nodes:{},assetStore:{}},be=function(e){return{type:he.UPDATE_DEFINITION,payload:{definition:e}}},ke=function(e){return{type:he.UPDATE_NODES,payload:{nodes:e}}},Ce=function(e){return{type:he.UPDATE_ASSET_MAP,payload:{assets:e}}},Ee=Object(de.combineReducers)({definition:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.definition,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_DEFINITION:return t.payload.definition;default:return e}},nodes:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.nodes,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_NODES:return t.payload.nodes;default:return e}},dependencies:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.dependencies,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_DEPENDENCIES:return t.payload.dependencies;default:return e}},assetStore:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.assetStore,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_ASSET_MAP:return t.payload.assets;default:return e}},baseLanguage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.baseLanguage,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_BASE_LANGUAGE:return t.payload.baseLanguage;default:return e}},contactFields:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ye.contactFields,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_CONTACT_FIELDS:return t.payload.contactFields;default:return e}}}),we=n(39),Oe=function(e,t){return e.originalAction&&e.originalAction.type===t?e.originalAction.uuid:$()},Se=function(e){var t=(e.groups||[]).map(function(e){return{id:e.uuid,name:e.name,type:pe.Group}});return t=(t=t.concat((e.contacts||[]).map(function(e){return{id:e.uuid,name:e.name,type:pe.Contact}}))).concat((e.legacy_vars||[]).map(function(e){return{id:e,name:e,type:pe.Expression}}))},Ne=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,n=arguments.length>2?arguments[2]:void 0;return e.reduce(function(e,a,i){return i<=t-1?e.push(xe(a,n)):i>t-1&&e.length===t&&e.push(b.createElement("div",{key:"ellipses"},"...")),e},[])},xe=function(e,t){switch(e.type){case pe.Group:return b.createElement("div",{className:we.node_asset,key:e.id},b.createElement("span",{className:"".concat(we.node_group," fe-group")}),e.name);case pe.Label:return b.createElement("div",{className:we.node_asset,key:e.id},b.createElement("span",{className:"".concat(we.node_label," fe-label")}),e.name);case pe.Flow:return b.createElement("div",{className:we.node_asset,key:e.id},b.createElement("span",{className:"".concat(we.node_label," fe-split")}),b.createElement("a",{onMouseDown:function(e){e.preventDefault(),e.stopPropagation()},onMouseUp:function(e){e.preventDefault(),e.stopPropagation()},href:"".concat(t.editor,"/").concat(e.id),rel:"noopener noreferrer",target:"_blank"},e.name))}return b.createElement("div",{className:we.node_asset,key:e.id},e.name)},je=function(e){return(e.validationFailures||[]).concat(e.persistantFailures||[])},Te=function(e){return je(e).length>0},Re=function(e){return e.filter(function(e){return e.type===pe.Expression}).map(function(e){return e.id})},Ue=function(e,t){return e.filter(function(e){return e.type===t}).map(function(e){return{uuid:e.id,name:e.name}})},Ae={name:I(o.Name),id:o.Name,type:pe.ContactProperty},De={name:I(o.Channel),id:o.Channel,type:pe.ContactProperty},Fe={name:I(o.Language),id:o.Language,type:pe.ContactProperty};!function(e){e.MESSAGE="message",e.VOICE="voice",e.SURVEY="message_offline",e.NONE="-"}(me||(me={})),function(e){e.execute_actions="execute_actions",e.add_contact_urn="add_contact_urn",e.add_contact_groups="add_contact_groups",e.add_input_labels="add_input_labels",e.remove_contact_groups="remove_contact_groups",e.set_contact_channel="set_contact_channel",e.set_contact_field="set_contact_field",e.set_contact_name="set_contact_name",e.set_contact_language="set_contact_language",e.set_run_result="set_run_result",e.call_resthook="call_resthook",e.call_webhook="call_webhook",e.send_msg="send_msg",e.send_email="send_email",e.send_broadcast="send_broadcast",e.enter_flow="enter_flow",e.start_session="start_session",e.transfer_airtime="transfer_airtime",e.split_by_airtime="split_by_airtime",e.split_by_expression="split_by_expression",e.split_by_contact_field="split_by_contact_field",e.split_by_run_result="split_by_run_result",e.split_by_run_result_delimited="split_by_run_result_delimited",e.split_by_groups="split_by_groups",e.split_by_random="split_by_random",e.split_by_resthook="split_by_resthook",e.split_by_subflow="split_by_subflow",e.split_by_webhook="split_by_webhook",e.wait_for_response="wait_for_response",e.wait_for_menu="wait_for_menu",e.wait_for_digits="wait_for_digits",e.wait_for_audio="wait_for_audio",e.wait_for_video="wait_for_video",e.wait_for_location="wait_for_location",e.wait_for_image="wait_for_image",e.missing="missing",e.say_msg="say_msg",e.play_audio="play_audio"}(ve||(ve={})),function(e){e.has_any_word="has_any_word",e.has_all_words="has_all_words",e.has_phrase="has_phrase",e.has_only_phrase="has_only_phrase",e.has_beginning="has_beginning",e.has_text="has_text",e.has_date="has_date",e.has_date_lt="has_date_lt",e.has_date_eq="has_date_eq",e.has_date_gt="has_date_gt",e.has_time="has_time",e.has_number="has_number",e.has_number_between="has_number_between",e.has_number_lt="has_number_lt",e.has_number_lte="has_number_lte",e.has_number_eq="has_number_eq",e.has_number_gte="has_number_gte",e.has_number_gt="has_number_gt",e.has_run_status="has_run_status",e.has_only_text="has_only_text",e.has_group="has_group",e.has_phone="has_phone",e.has_email="has_email",e.has_value="has_value",e.has_district="has_district",e.has_state="has_state",e.has_ward="has_ward",e.has_pattern="has_pattern",e.has_error="has_error"}(fe||(fe={}));var Pe=[me.NONE],Ie=[me.VOICE],Me=[me.SURVEY],Le=[me.MESSAGE,me.SURVEY],ze=[me.MESSAGE,me.VOICE],Be=function(){return null};Be.isRequired=function(){return null};var Ve="ConfigProvider expects only one child component.",Ge="ConfigProvider expects a valid React element: https://reactjs.org/docs/react-api.html#isvalidelement",qe=function(e){function t(e){var n;if(Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),b.Children.count(e.children)>1)throw new Error(Ve);if(!b.isValidElement(e.children))throw new Error(Ge);return n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getChildContext",value:function(){return{config:this.props.config}}},{key:"render",value:function(){return b.Children.only(this.props.children)}}]),t}(b.Component);qe.childContextTypes={config:Be,assetService:Be};var Ke=function(e,t){var n=e.labels;return b.createElement(b.Fragment,null,Ne(n.map(function(e){return{id:e.uuid,name:e.name,type:pe.Label}}),3,t.config.endpoints))};Ke.contextTypes={config:Be};var We=Ke,Ye=function(e,t){return e.type!==t.type?t.type.localeCompare(e.type):e.name.localeCompare(t.name)},He=n(24),Xe=n.n(He),Qe=n(28),$e=n.n(Qe),Ze=Xe.a.bind($e.a),Je=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^get/,/^has/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getName",value:function(){return G(this.props.showLabel&&void 0!==this.props.name&&null!==this.props.name&&this.props.name.length>0)(b.createElement("div",{className:$e.a.label},this.props.name))}},{key:"getHelpText",value:function(){return G(null!=this.props.helpText)(b.createElement("div",{className:$e.a.help_text},this.props.helpText," "))}},{key:"hasErrors",value:function(){return this.getMergedErrors().length>0}},{key:"getMergedErrors",value:function(){return this.props.entry?(this.props.entry.validationFailures||[]).concat(this.props.entry.persistantFailures||[]):[]}},{key:"getErrors",value:function(){var e=this;if(this.hasErrors()&&!this.props.hideError){var t=this.getMergedErrors().map(function(t,n){var a,i=Ze((a={},Object(E.a)(a,$e.a.error,!0),Object(E.a)(a,$e.a.send_msg_error,!0===e.props.sendMsgError),a));return b.createElement("div",{key:n,className:i},b.createElement("div",{className:$e.a.arrow_up}),b.createElement("div",null,t.message))});return b.createElement("div",{className:$e.a.error_list},t)}return null}},{key:"render",value:function(){var e,t=this.getName(),n=this.getHelpText(),a=this.getErrors(),i=Ze((e={},Object(E.a)(e,$e.a.ele,!0),Object(E.a)(e,$e.a.border,this.props.border),Object(E.a)(e,$e.a.invalid,this.hasErrors()),Object(E.a)(e,this.props.__className,void 0!==this.props.__className),e));return b.createElement("div",{className:i},t,this.props.children,n,a)}}]),t}(b.PureComponent),et=n(42),tt=n.n(et),nt=n(63),at=n(18),it=n.n(at),rt={ARS:{id:"ARS",name:"Argentine Peso",type:pe.Currency},AUD:{id:"AUD",name:"Australian Dollar",type:pe.Currency},BIF:{id:"BIF",name:"Burundi Franc",type:pe.Currency},BRL:{id:"BRL",name:"Brazilian Real",type:pe.Currency},CAD:{id:"CAD",name:"Canadian Dollar",type:pe.Currency},CDF:{id:"CDF",name:"Congolese Franc",type:pe.Currency},CLP:{id:"CLP",name:"Chilean Peso",type:pe.Currency},COP:{id:"COP",name:"Colombian Peso",type:pe.Currency},DJF:{id:"DJF",name:"Djibouti Franc",type:pe.Currency},DOP:{id:"DOP",name:"Dominican Peso",type:pe.Currency},DZD:{id:"DZD",name:"Algerian Dinar",type:pe.Currency},EUR:{id:"EUR",name:"Euro",type:pe.Currency},GBP:{id:"GBP",name:"Pound Sterling",type:pe.Currency},GHS:{id:"GHS",name:"Ghana Cedi",type:pe.Currency},GNF:{id:"GNF",name:"Guinean Franc",type:pe.Currency},KES:{id:"KES",name:"Kenyan Shilling",type:pe.Currency},LBP:{id:"LBP",name:"Lebanese Pound",type:pe.Currency},LKR:{id:"LKR",name:"Sri Lanka Rupee",type:pe.Currency},LRD:{id:"LRD",name:"Liberian Dollar",type:pe.Currency},MWK:{id:"MWK",name:"Malawi Kwacha",type:pe.Currency},MXN:{id:"MXN",name:"Mexican Peso",type:pe.Currency},NAD:{id:"NAD",name:"Namibia Dollar",type:pe.Currency},NPR:{id:"NPR",name:"Nepalese Rupee",type:pe.Currency},NZD:{id:"NZD",name:"New Zealand Dollar",type:pe.Currency},PHP:{id:"PHP",name:"Philippine Piso",type:pe.Currency},PKR:{id:"PKR",name:"Pakistan Rupee",type:pe.Currency},RUB:{id:"RUB",name:"Russian Ruble",type:pe.Currency},RWF:{id:"RWF",name:"Rwanda Franc",type:pe.Currency},SDG:{id:"SDG",name:"Sudanese Pound",type:pe.Currency},SGD:{id:"SGD",name:"Singapore Dollar",type:pe.Currency},SLL:{id:"SLL",name:"Leone",type:pe.Currency},SOS:{id:"SOS",name:"Somali Shilling",type:pe.Currency},SRD:{id:"SRD",name:"Surinam Dollar",type:pe.Currency},SVC:{id:"SVC",name:"El Salvador Colon",type:pe.Currency},TND:{id:"TND",name:"Tunisian Dinar",type:pe.Currency},TRY:{id:"TRY",name:"Turkish Lira",type:pe.Currency},TZS:{id:"TZS",name:"Tanzanian Shilling",type:pe.Currency},UGX:{id:"UGX",name:"Uganda Shilling",type:pe.Currency},USD:{id:"USD",name:"US Dollar",type:pe.Currency},UYU:{id:"UYU",name:"Peso Uruguayo",type:pe.Currency},UZS:{id:"UZS",name:"Uzbekistan Sum",type:pe.Currency},VEF:{id:"VEF",name:"Bol\xedvar",type:pe.Currency},XCD:{id:"XCD",name:"East Caribbean Dollar",type:pe.Currency},YER:{id:"YER",name:"Yemeni Rial",type:pe.Currency},ZAR:{id:"ZAR",name:"Rand",type:pe.Currency},ZMW:{id:"ZMW",name:"Zambian Kwacha",type:pe.Currency},ZWL:{id:"ZWL",name:"Zimbabwe Dollar",type:pe.Currency}};it.a.defaults.headers.post["Content-Type"]="application/javascript",it.a.defaults.responseType="json";var ot,st=function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=document.cookie.split(";")[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,s=o.indexOf("="),l=o.substr(0,s),u=o.substr(s+1);if(l=l.trim(),u=u.trim(),l===e)return u}}catch(c){n=!0,a=c}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}return null},lt=function(e,t){return new Promise(function(n,a){it.a.get(e.endpoint).then(function(a){var i=a.data.results.map(function(t){return dt(t,e.type,e.id)}).find(function(e){return e.id===t});n(i)}).catch(function(e){return a(e)})})},ut=function(e,t,n){return new Promise(function(a,i){it.a.get(e).then(function(e){var i=e.data.results.map(function(e,a){var i=dt(e,t,n);return i.order=a,i});a({assets:i,next:e.data.next})}).catch(function(e){return i(e)})})},ct=function(){var e=Object(nt.a)(tt.a.mark(function e(t,n,a){var i,r,o;return tt.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",new Promise(function(e,t){return e([])}));case 2:i=[],r=t;case 4:if(!r){e.next=12;break}return e.next=7,ut(r,n,a);case 7:o=e.sent,i=i.concat(o.assets),r=o.next,e.next=4;break;case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}},e)}));return function(t,n,a){return e.apply(this,arguments)}}(),dt=function(e,t,n){var a=n||"uuid",i={name:e.name||e.text||e.label||e[a],id:e[a],type:t};return delete e[a],delete e.name,delete e.text,i.content=e,i},pt=function(e,t,n){return(!n||!n(t))&&t.name.toLowerCase().includes(e.toLowerCase())},ht=function(e,t,n,a){var i=e.toLowerCase(),r=Object.keys(t).map(function(e){return t[e]}).filter(function(e){return pt(i,e,a)});return r=r.concat(n||[]).filter(function(e){return pt(i,e,a)})},mt=function(e){return new Promise(function(t,n){var a={channels:{endpoint:ft(e.channels),type:pe.Channel,items:{}},languages:{endpoint:ft(e.languages),type:pe.Language,items:{},id:"iso"},flows:{endpoint:ft(e.flows),type:pe.Flow,items:{}},fields:{endpoint:ft(e.fields),type:pe.Field,id:"key",items:{}},groups:{endpoint:ft(e.groups),type:pe.Group,items:{}},revisions:{endpoint:ft(e.revisions),type:pe.Revision,id:"id",items:{}},labels:{endpoint:ft(e.labels),type:pe.Label,items:{}},results:{type:pe.Result,items:{}},recipients:{endpoint:ft(e.recipients),type:pe.Contact||pe.Group||pe.URN,items:{},id:"id"},resthooks:{endpoint:ft(e.resthooks),type:pe.Resthook,id:"resthook",items:{}},templates:{endpoint:ft(e.templates),type:pe.Template,items:{}},currencies:{type:pe.Currency,id:"id",items:rt,prefetched:!0}},i=[];["languages","fields","groups","labels"].forEach(function(e){var t=a[e];i.push(ct(t.endpoint,t.type,t.id||"uuid").then(function(e){t.items=cl(e),t.prefetched=!0}))}),Promise.all(i).then(function(e){t(a)})})},vt=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new Promise(function(n,a){Object(nt.a)(tt.a.mark(function i(){var r,o,s;return tt.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r=t){i.next=6;break}return i.next=4,it.a.get("".concat(e.endpoint));case 4:(o=i.sent).data.results.length>0&&(r=o.data.results[0].id);case 6:r?(s="".concat(e.endpoint).concat(r),it.a.get(s).then(function(e){var t=e.data;return n(t)}).catch(function(e){return a(e)})):a(new Error("No revision found for flow"));case 7:case"end":return i.stop()}},i)}))()})},ft=function(e){var t=e;return t.endsWith("/")||-1!==t.indexOf("?")||-1!==t.indexOf("groups")||(t+="/"),t.startsWith("http://")||t.startsWith("https://")?t:"".concat(function(){var e=window.location;return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")}()+t)},gt=n(37),_t=n(85),yt=n.n(_t),bt=n(14),kt=n(181);!function(e){e.child="child",e.contact="contact",e.fields="fields",e.input="input",e.parent="parent",e.results="results",e.run="run",e.trigger="trigger",e.urns="urns",e.webhook="webhook"}(ot||(ot={}));var Ct=function(e){return e.name||e.signature.substr(0,e.signature.indexOf("("))},Et=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e||ot.run;return[{name:"".concat(t,".flow"),summary:"The flow in which a ".concat(e," run takes place")},{name:"".concat(t,".flow.uuid"),summary:"The UUID of the flow in which a ".concat(e," run takes place")},{name:"".concat(t,".flow.name"),summary:"The name of the flow in which a ".concat(e," run takes place")},{name:"".concat(t,".flow.revision"),summary:"The revision number of the flow in which a ".concat(e," run takes place")}]},wt=function(e){var t=e?"".concat(e,"."):"",n=e?e===ot.run?"".concat(e,"'s"):"".concat(e," run's"):"";return[{name:"".concat(t,"contact"),summary:"The name of the ".concat(n," contact")},{name:"".concat(t,"contact.first_name"),summary:"The first name of a ".concat(n," contact")},{name:"".concat(t,"contact.name"),summary:"The name of the ".concat(n," contact")},{name:"".concat(t,"contact.display"),summary:"The name or urn of the ".concat(n," contact")},{name:"".concat(t,"contact.fields"),summary:"Custom fields on a ".concat(n," contact")},{name:"".concat(t,"contact.urn"),summary:"The primary urn for a ".concat(n," contact")},{name:"".concat(t,"contact.language"),summary:"The language iso code for a ".concat(n," contact")},{name:"".concat(t,"contact.created_on"),summary:"The creation date for the ".concat(n," contact")},{name:"".concat(t,"contact.groups"),summary:"The groups a ".concat(n," contact is a member of")},{name:"".concat(t,"contact.urns"),summary:"The urns for a ".concat(n," contact")},{name:"".concat(t,"contact.uuid"),summary:"The uuid of the ".concat(n," contact")},{name:"".concat(t,"contact.channel"),summary:"A ".concat(n," contact's preferred channel")},{name:"".concat(t,"contact.channel.uuid"),summary:"The UUID of a ".concat(n," contact's preferred channel")},{name:"".concat(t,"contact.channel.name"),summary:"The name of a ".concat(n," contact's preferred channel")},{name:"".concat(t,"contact.channel.address"),summary:"The address of a ".concat(n," contact's preferred channel")}]},Ot=[{name:ot.run,summary:"A run in this flow"}].concat(Object(bt.a)(Et()),Object(bt.a)(wt(ot.run))),St=[{name:ot.child,summary:"Run details collected in a child flow, if any"}].concat(Object(bt.a)(Et(ot.child)),Object(bt.a)(wt(ot.child))),Nt=[{name:ot.parent,summary:"Run details collected by a parent flow, if any"}].concat(Object(bt.a)(Et(ot.parent)),Object(bt.a)(wt(ot.parent))),xt=[].concat(Object(bt.a)(wt()),[{name:"results",summary:"The results for the current run"},{name:"fields",summary:"The custom fields for the contact"}],[{name:"input",summary:"The most recent input"},{name:"input.uuid",summary:"The UUID of the last input"},{name:"input.type",summary:"The type of the last input"},{name:"input.channel",summary:"The channel the last input was received on"},{name:"input.channel.address",summary:"The channel the last input was received on"},{name:"input.channel.name",summary:"The name of the channel the last input was received on"},{name:"input.channel.uuid",summary:"The uuid of the channel the last input was received on"},{name:"input.created_on",summary:"The date of the last input"},{name:"input.text",summary:"The text from the last message"},{name:"input.attachments",summary:"The attachments from the last message"}],[{name:"urns",summary:"The urns for the contact"},{name:"urns.facebook",summary:"The Facebook urn for the contact"},{name:"urns.fcm",summary:"The Firebase Cloud Messaging id for the contact"},{name:"urns.jiochat",summary:"The Jiochat id for the contact"},{name:"urns.line",summary:"The Line id for the contact"},{name:"urns.mailto",summary:"The email address for the contact"},{name:"urns.tel",summary:"The phone number for the contact"},{name:"urns.telegram",summary:"The Telegram id for the contact"},{name:"urns.twitterid",summary:"The Twitter id for the contact"},{name:"urns.viber",summary:"The Viber id for the contact"},{name:"urns.wechat",summary:"The Wechat id for the contact"},{name:"urns.whatsapp",summary:"The WhatsApp number for the contact"}],Object(bt.a)(Ot),Object(bt.a)(St),Object(bt.a)(Nt),[{name:"webhook",summary:"The parsed JSON payload of the last webhook call"}],[{name:"trigger",summary:"A trigger that initiated a session"},{name:"trigger.type",summary:"The type of a trigger, one of \u201cmanual\u201d or \u201cflow\u201d"},{name:"trigger.params",summary:"The parameters passed to a trigger"}]),jt=(xt.filter(function(e){var t=Ct(e);return t===ot.child||t===ot.contact||t===ot.fields||t===ot.input||t===ot.parent||t===ot.results||t===ot.run||t===ot.trigger||t===ot.urns||t===ot.webhook}),function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a=t.toLowerCase();return e.filter(function(e){if(n&&e.signature)return 0===e.signature.indexOf(a);if(e.name){var t=e.name.substr(a.length);return 0===e.name.indexOf(a)&&(0===t.length||-1===t.substr(1).indexOf("."))}return!1})}),Tt=xt,Rt=function(e){it.a.get(e.functions).then(function(e){var t;t=e.data,Tt=xt.concat(t)}).catch(function(e){return Object(kt.reject)(e)})},Ut=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2]?Tt:xt;return e?[].concat(Object(bt.a)(n),Object(bt.a)(function(e){return Object.keys(e).reduce(function(t,n){var a=e[n];return t.push({name:"fields.".concat(n),summary:"".concat(a.name," for the contact.")}),["","parent.","run.","child."].forEach(function(e){return t.push({name:"".concat(e,"contact.fields.").concat(n),summary:"".concat(a.name," for the contact.")})}),t},[])}(t.fields?t.fields.items:{})),Object(bt.a)(function(e){return Object.keys(e).reduce(function(t,n){var a=e[n];return t.concat([{name:"results.".concat(n),summary:"".concat(a.name," for the run.")},{name:"results.".concat(n,".value"),summary:"".concat(a.name," value for the run.")},{name:"results.".concat(n,".category"),summary:"".concat(a.name," category for the run.")},{name:"results.".concat(n,".category_localized"),summary:"".concat(a.name," localized category for the run.")},{name:"results.".concat(n,".name"),summary:"".concat(a.name," localized category for the run.")},{name:"results.".concat(n,".node_uuid"),summary:"The uuid for the node that created this result."},{name:"results.".concat(n,".input"),summary:"The input at the time this result was created."},{name:"results.".concat(n,".created_on"),summary:"".concat(a.name," localized category for the run.")},{name:"run.results.".concat(n),summary:"".concat(a.name," for the run.")},{name:"run.results.".concat(n,".categories"),summary:"".concat(a.name," categories for the run.")},{name:"run.results.".concat(n,".categories_localized"),summary:"".concat(a.name," localized categories for the run.")},{name:"run.results.".concat(n,".input"),summary:"The input at the time this result was created."},{name:"results.".concat(n,".extra"),summary:"".concat(a.name," extra data for this result, such as a webhook response.")},{name:"run.results.".concat(n,".created_on"),summary:"".concat(a.name," localized category for the run.")}])},[])}(t.results?t.results.items:{}))):n},At={placeholder:function(e,t){return Object(_.a)({},e,{color:"#ddd",marginLeft:"3px"})},singleValue:function(e,t){return Object(_.a)({},e,{marginLeft:"3px"})},multiValue:function(e,t){return Object(_.a)({},e,{marginLeft:"0px"})},input:function(e,t){return Object(_.a)({},e,{marginLeft:"0px",caretColor:"#999",marginBottom:"0px",boxShadow:"none",border:"none"})},control:function(e,t){return Object(_.a)({},e,{borderColor:"#ccc",boxShadow:"none",transition:"all 0.3s ease-in-out","&:hover":{borderColor:"#ccc"}})}},Dt={control:function(e,t){return Object(_.a)({},e,{borderColor:"#ccc",boxShadow:"none",borderBottom:"none",borderBottomRightRadius:"0px",borderBottomLeftRadius:"0px","&:hover":{borderColor:"#ccc"}})}},Ft={control:function(e){return Object(_.a)({},e,{borderColor:"#ccc",boxShadow:"none","&:hover":{borderColor:"#ccc"},minHeight:28,maxHeight:28,fontSize:12})},menuList:function(e){return Object(_.a)({},e,{maxHeight:200})},option:function(e){return Object(_.a)({},e,{fontSize:12})},singleValue:function(e){return Object(_.a)({},e,{maxHeight:28})},indicatorsContainer:function(e){return Object(_.a)({},e,{height:28,maxHeight:28})},valueContainer:function(e){return Object(_.a)({},e,{height:28,maxHeight:28})},input:function(e){return Object(_.a)({},e,{margin:0})}},Pt={control:function(e,t){return Object(_.a)({},e,{borderColor:"#ccc",boxShadow:"none","&:hover":{borderColor:"#ccc"}})},multiValue:function(e){return Object(_.a)({},e,{maxHeight:24,minHeight:24,lineHeight:"17px",backgroundColor:"hsl(0, 0%, 94%)",border:"1px solid hsl(0, 0%, 85%)"})}},It=n(66),Mt=n.n(It),Lt=function(e){var t=e.data,n="";return t.type===pe.Currency&&(n=" (".concat(t.id,")")),e.isDisabled?null:k.a.createElement("div",Object.assign({ref:e.innerRef},e.innerProps),k.a.createElement(gt.b.Option,e,"",function(e){switch(e.type){case pe.Group:return b.createElement("span",{className:"fe-group"});case pe.Label:return b.createElement("span",{className:"fe-label"});case pe.Flow:return b.createElement("span",{className:"fe-split"});case pe.Scheme:return b.createElement("span",{className:"fe-connection"});case pe.Template:return e.content.translations.find(function(e){return"pending"===e.status})?b.createElement("span",{className:"fe-hourglass"}):b.createElement("span",{className:"fe-check"});case pe.Remove:return b.createElement(b.Fragment,null,b.createElement("span",{className:"fe-trash"}),"\xa0");default:return null}}(t)," ",t.name,n))},zt=function(e){function t(e){var n;Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).lastCreation=0,Object(y.react)(Object(f.a)(n),{include:[/^is/,/^handle/,/^get/]});var a=[];e.assets.endpoint||(a=ht("",e.assets.items));var i=[];return n.props.completion&&(i=Ut(!0,n.props.completion,!1).map(function(e){return{id:"@"+e.name,name:"@"+e.name,type:pe.Expression}})),n.state={menuOpen:!1,defaultOptions:a,entry:n.props.entry,isLoading:!1,completionOptions:i},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleChanged",value:function(e){this.setState({message:null}),Array.isArray(e)?this.props.onChange(e):this.props.onChange&&this.props.onChange([e])}},{key:"handleLoadOptions",value:function(e,t){var n=this,a=this.props.additionalOptions||[];if(this.state.completionOptions.length>0&&e.startsWith("@"))return a=a.concat(this.state.completionOptions),void t(ht(e,{},a,this.props.shouldExclude));var i=ht(e,this.props.assets.items,a,this.props.shouldExclude),r=this.props.assets;if(r.prefetched)this.props.onFilter&&(i=i.filter(this.props.onFilter)),t(i.sort(this.props.sortFunction||Ye));else{var o=r.endpoint;o&&e&&(o+=o.indexOf("?")<0?"?":"&",o+="search="+encodeURIComponent(e)),ct(o,r.type,r.id||"uuid").then(function(a){var r=a.filter(function(t){return pt(e,t,n.props.shouldExclude)}),o=n.props.valueClearable?[ge]:[],s=function(e,t){var n={};return e.filter(function(e){var a=e[t];return!n.hasOwnProperty(a)&&(n[a]=!0)})}(i.concat(r).concat(o),"id");if(n.props.entry.value&&!n.props.entry.value.name){var l=s.find(function(e){return e.id===n.props.entry.value.id});l&&n.props.onChange([l])}n.props.onFilter&&(s=s.filter(n.props.onFilter)),t(s.sort(n.props.sortFunction||Ye))})}}},{key:"handleCheckValid",value:function(e,t,n){return!!this.props.createAssetFromInput&&(e.length>0&&0===ht(e,this.props.assets.items,this.props.additionalOptions,this.props.shouldExclude).filter(function(t){return t.name.toLowerCase()===e.toLowerCase()}).length)}},{key:"handleCreatePrompt",value:function(e){return(this.props.createPrefix||"New ".concat(this.props.name,": "))+e}},{key:"handleGetNewOptionData",value:function(e,t){return{id:"_",name:t,type:null}}},{key:"handleLoadingComplete",value:function(){this.setState({isLoading:!1})}},{key:"handleMenuOpen",value:function(){this.setState({menuOpen:!0,message:null})}},{key:"handleMenuClose",value:function(){this.setState({menuOpen:!1})}},{key:"handleClearMessage",value:function(){this.state.message&&this.setState({message:null})}},{key:"handleCreateOption",value:function(e){var t=this,n=(new Date).getTime();if(!(n-this.lastCreation<1e3)){this.lastCreation=n;var a=this.props.createAssetFromInput(e);this.props.assets.endpoint?(this.setState({isLoading:!0,message:null}),function(e,t){var n=st("csrftoken"),a=n?{"X-CSRFToken":n}:{};return new Promise(function(n,i){it.a.post(e.endpoint,t,{headers:a}).then(function(t){n(dt(t.data,e.type,e.id))}).catch(function(e){return i(e)})})}(this.props.assets,a).then(function(e){t.setState({isLoading:!1}),t.props.onAssetCreated(e)}).catch(function(n){console.log(n),t.setState({message:"Couldn't create new ".concat(t.props.assets.type,' "').concat(e,'"'),isLoading:!1})})):this.props.onChange([a])}}},{key:"getStyle",value:function(){if(this.state.message)return Dt;var e,t=this.props.styles||At;if(Te(this.props.entry)){var n=(e=t.control({},{}),{control:function(t){return Object(_.a)({},t,e,{borderColor:"tomato",boxShadow:"0 0 0 3px rgba(255,196,186,0.5) !important;","&:hover":{borderColor:"tomato"}})}});t=Object(_.a)({},t,n)}return t}},{key:"render",value:function(){var e=this,t={className:"react-select "+Mt.a.selection,value:this.state.entry.value,components:{Option:Lt},styles:this.getStyle(),onChange:this.handleChanged,onMenuOpen:this.handleMenuOpen,onMenuClose:this.handleMenuClose,onBlur:this.handleClearMessage,menuShouldBlockScroll:!0,isMulti:this.props.multi,isDisabled:this.state.isLoading,isLoading:this.state.isLoading,isClearable:this.props.formClearable,isSearchable:this.props.searchable,getOptionValue:function(e){return e.id},getOptionLabel:function(e){return e.name}};if(this.props.createAssetFromInput){var n=ht("",this.props.assets.items,this.props.additionalOptions,this.props.shouldExclude),a=this.props.multi?"":"an",i=this.props.multi?"new ones":"a new one";return k.a.createElement(Je,{name:this.props.name,entry:this.props.entry,showLabel:this.props.showLabel,helpText:this.props.helpText,hideError:this.state.menuOpen,__className:Mt.a.ele},k.a.createElement(yt.a,Object.assign({},t,{placeholder:this.props.placeholder||"Select ".concat(a," existing ").concat(this.props.name.toLocaleLowerCase()," or enter ").concat(i),options:n.sort(this.props.sortFunction||Ye),isValidNewOption:this.handleCheckValid,formatCreateLabel:this.handleCreatePrompt,getNewOptionData:this.handleGetNewOptionData,onCreateOption:this.handleCreateOption})))}var r=void 0!==this.props.assets.endpoint;return r||(r=this.state.defaultOptions,this.props.shouldExclude&&(r=ht("",this.props.assets.items,this.props.additionalOptions,this.props.shouldExclude))),k.a.createElement(Je,{name:this.props.name,entry:this.props.entry,showLabel:this.props.showLabel,helpText:this.props.helpText,hideError:this.state.menuOpen,__className:Mt.a.ele},k.a.createElement(gt.a,Object.assign({},t,{defaultOptions:r,cacheOptions:!0,loadOptions:this.handleLoadOptions,noOptionsMessage:function(t){return e.props.noOptionsMessage||"No ".concat(e.props.name," Found")}})),this.state.message?k.a.createElement("div",{className:Mt.a.message},this.state.message):null)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.entry;if(t.defaultOptions&&n.value&&!n.value.name){var a=t.defaultOptions.find(function(e){return e.id===n.value.id});a&&(n={value:a})}return{entry:n}}}]),t}(k.a.Component),Bt=function(e,t){return e.filter(function(e){return void 0===e.visibility||e.visibility.findIndex(function(e){return e===t})>-1})},Vt=n(183),Gt=n.n(Vt),qt=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).typeConfigs=void 0,n.state={config:n.props.initialType},n.handleChangeType=n.handleChangeType.bind(Object(f.a)(n)),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleChangeType",value:function(e){var t=this;this.setState({config:e},function(){return t.props.onChange(e)})}},{key:"getTypeConfigs",value:function(){var e,t;return void 0===this.typeConfigs&&(this.typeConfigs=(e=ls,t=this.context.config.flowType,Bt(e,t))),this.typeConfigs}},{key:"render",value:function(){return b.createElement("div",{className:"".concat(this.props.__className," ").concat(Gt.a.type_list)},b.createElement("p",null,"When a contact arrives at this point in your flow..."),b.createElement("div",null,b.createElement(gt.c,{className:"react-select",styles:At,value:this.state.config,onChange:this.handleChangeType,isSearchable:!0,isClearable:!1,getOptionValue:function(e){return e.type},getOptionLabel:function(e){return e.description},options:this.getTypeConfigs()})))}}]),t}(b.PureComponent);qt.contextTypes={config:Be};var Kt,Wt=n(12),Yt=n.n(Wt),Ht=function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=e||{},i=0,r=Object.keys(t);i<r.length;i++){var o=r[i],s=t[o];if(Array.isArray(s)){var l=!0,u=!1,c=void 0;try{for(var d,p=function(){var t=d.value,n=t.hasOwnProperty("value")&&"object"===typeof t.value;if(n&&t.value.uuid||t.uuid){var i=e[o].findIndex(function(e){return n?e.value.uuid===t.value.uuid:e.uuid===t.uuid});a=i>-1?Yt()(a,Object(E.a)({},o,{$merge:Object(E.a)({},i,t)})):Yt()(a,Object(E.a)({},o,{$push:[t]}))}},h=s[Symbol.iterator]();!(l=(d=h.next()).done);l=!0)p()}catch(G){u=!0,c=G}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}delete t[o]}}var m=!0,v=!1,f=void 0;try{for(var g,_=n.filter(function(e){return"object"===typeof e})[Symbol.iterator]();!(m=(g=_.next()).done);m=!0)for(var y=g.value,b=0,k=Object.keys(y);b<k.length;b++){var C=k[b],w=y[C];if(Array.isArray(w)){var O=!0,S=!1,N=void 0;try{for(var x,j=function(){var e=x.value,t=e.hasOwnProperty("value")&&"object"===typeof e.value;(t&&e.value.uuid||e.uuid)&&(a=Yt()(a,Object(E.a)({},C,function(n){return n.filter(function(n){return t?n.value.uuid!==e.value.uuid:n.uuid!==e.uuid})})))},T=w[Symbol.iterator]();!(O=(x=T.next()).done);O=!0)j()}catch(G){S=!0,N=G}finally{try{O||null==T.return||T.return()}finally{if(S)throw N}}}}}catch(G){v=!0,f=G}finally{try{m||null==_.return||_.return()}finally{if(v)throw f}}var R=n.filter(function(e){return"string"===typeof e});a=Yt()(a,{$merge:t,$unset:R});for(var U=!0,A=0,D=Object.keys(e);A<D.length;A++){var F=D[A],P=a[F];if(Array.isArray(P)){var I=!0,M=!1,L=void 0;try{for(var z,B=P[Symbol.iterator]();!(I=(z=B.next()).done);I=!0){var V=z.value;if(Te(V)){U=!1;break}}}catch(G){M=!0,L=G}finally{try{I||null==B.return||B.return()}finally{if(M)throw L}}}else if(P&&"object"===typeof P&&Te(P)){U=!1;break}}return Yt()(a,{$merge:{valid:U}})},Xt={typeConfig:null,userAddingAction:!1,settings:null},Qt=function(e){return{type:he.UPDATE_NODE_EDITOR_SETTINGS,payload:{settings:e}}},$t=function(e){return{type:he.UPDATE_USER_ADDING_ACTION,payload:{userAddingAction:e}}},Zt=Object(de.combineReducers)({typeConfig:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt.typeConfig,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_TYPE_CONFIG:return t.payload.typeConfig;default:return e}},userAddingAction:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt.userAddingAction,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_USER_ADDING_ACTION:return t.payload.userAddingAction;default:return e}},settings:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xt.settings,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_NODE_EDITOR_SETTINGS:return t.payload.settings;default:return e}}}),Jt=new RegExp("^(?:(?:https?|ftp)://)(?:\\S+(?:u:\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))\\.?)(?::\\d{2,5})?(?:[/?#]\\S*)?$","i"),en=function(e,t){return function(n,a){var i=function(e){var t=e;return"string"===typeof e?t+"":(e&&"object"===typeof e&&(t=e.name||void 0),t?t+"":null)}(a);return i&&!e.test(i)?{value:a,failures:[{message:"".concat(n," ").concat(t)}]}:{failures:[],value:a}}},tn=function(e,t,n){var a=[],i=t;return n.forEach(function(n){var r=n(e,t);i=r.value,a=a.concat(r.failures)}),{value:i,validationFailures:a}},nn=function(e,t){if(t)return{value:t,failures:[{message:"".concat(e," is not finished")}]};if("string"===typeof t){if(0!==t.trim().length)return{value:t,failures:[{message:"".concat(e," is not finished")}]}}else if(Array.isArray(t)&&0!==t.length)return{value:t,failures:[{message:"".concat(e," is not finished")}]};return{failures:[],value:t}},an=function(e,t){if(!t)return{value:t,failures:[{message:"".concat(e," is required")}]};if("string"===typeof t){if(0===t.trim().length)return{value:t,failures:[{message:"".concat(e," is required")}]}}else if(Array.isArray(t)&&0===t.length)return{value:t,failures:[{message:"".concat(e," are required")}]};return{failures:[],value:t}},rn=function(e,t){if("string"===typeof t){var n=t;if(n.trim().startsWith("@"))return{failures:[],value:t};try{new RegExp(n)}catch(a){return{value:t,failures:[{message:"".concat(e," is not a valid regex")}]}}}return{failures:[],value:t}},on=function(e,t){return function(n,a){return"string"===typeof a&&parseFloat(a)<=e?{value:a,failures:[{message:"".concat(n," must be a more than ").concat(t)}]}:{failures:[],value:a}}},sn=function(e){return function(t,n){return e?an(t,n):{failures:[],value:n}}},ln=(Kt=10,function(e,t){return Array.isArray(t)&&t.length>Kt?{value:t,failures:[{message:"".concat(e," cannot have more than ").concat(Kt," entries")}]}:{failures:[],value:t}}),un=en(/^(?!\d)/,"can't start with a number"),cn=en(Jt,"is not a valid URL"),dn=en(/^[\w-]+$/,"is invalid"),pn=en(/^([-+]?((\.\d+)|(\d+)(\.\d+)?)$)/,"must be a number"),hn=en(/^[a-z\d\-_\s]+$/i,"can only have letters and numbers"),mn=en(/^@.*$|^([-+]?((\.\d+)|(\d+)(\.\d+)?)$)/,"must be a number"),vn=function(e){return e.originalAction&&e.originalAction.type===ve.add_input_labels?{labels:{value:e.originalAction.labels.map(function(e){return{id:e.uuid,name:e.name,type:pe.Label}})},valid:!0}:{labels:{value:[]},valid:!1}},fn=function(e,t){return e.filter(function(e){return e.type===t}).map(function(e){return{uuid:e.id,name:e.name}})},gn=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=vn(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleSave",value:function(){var e,t;if(this.handleLabelsChanged(this.state.labels.value,!0)){var n=(e=this.props.nodeSettings,t=this.state,{type:ve.add_input_labels,labels:fn(t.labels.value,pe.Label),uuid:Oe(e,ve.add_input_labels)});this.props.updateAction(n),this.props.onClose(!1)}}},{key:"handleLabelsChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={labels:tn("Labels",e,[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleCreateAssetFromInput",value:function(e){return{name:e}}},{key:"handleLabelCreated",value:function(e){this.props.addAsset("labels",e),this.handleLabelsChanged(this.state.labels.value.concat(e))}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",{"data-spec":"label"},"Select the labels to apply to the incoming message."),b.createElement(zt,{name:"Labels",placeholder:"Enter the name of an existing label or create a new one",assets:this.props.assetStore.labels,entry:this.state.labels,searchable:!0,multi:!0,onChange:this.handleLabelsChanged,createPrefix:"Create Label: ",createAssetFromInput:this.handleCreateAssetFromInput,onAssetCreated:this.handleLabelCreated}))}}]),t}(b.PureComponent);gn.contextTypes={assetService:Be};var _n,yn=function(e){return os.find(function(t){return t.scheme===e})},bn=function(e){return kn(yn(e))},kn=function(e){return{value:e.scheme,label:e.name}},Cn=function(e){if(e.originalAction&&e.originalAction.type===ve.add_contact_urn){var t=e.originalAction,n=t.scheme,a=t.path;return{scheme:{value:bn(n)},path:{value:a},valid:!0}}return{scheme:{value:bn("tel")},path:{value:""},valid:!1}},En=function(e){var t=e.scheme,n=e.path;return b.createElement(b.Fragment,null,"Add ",yn(t).name," ",n)},wn=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){return b.createElement(Je,{name:this.props.name,entry:this.props.entry},b.createElement(gt.c,{isDisabled:void 0===this.props.onChange,placeholder:this.props.placeholder,styles:this.props.styles,name:this.props.name,value:this.props.entry.value,onChange:this.props.onChange,isSearchable:!1,isClearable:!1,options:this.props.options}))}}]),t}(b.Component),On=n(119),Sn=n.n(On),Nn=function(e){var t,n=e.unicodeChars,a=Object.keys(n);return G(a.length>0)(b.createElement("span",{"data-testid":"unicode-list-container"},(t=a.length," Note that your message may require more segments to send because it contains the following ".concat(J(t,"character"),":")),b.createElement("div",{className:Sn.a.unicode_list,"data-testid":"unicode-list"},a.map(function(e,t){return b.createElement("span",{key:e,className:Sn.a.unicode_char},e)}))))},xn=n(43),jn=n.n(xn),Tn=Xe.a.bind(jn.a),Rn=function(e){var t,n=e.count,a=e.parts,i=e.unicodeChars,r=Object.keys(i).length>0,o=Tn((t={},Object(E.a)(t,jn.a.tooltip_text,!0),Object(E.a)(t,jn.a.unicode,r),t));return k.a.createElement("div",{className:jn.a.count},k.a.createElement("div",{className:jn.a.tooltip},n,k.a.createElement("span",{className:jn.a.divider},"/"),a,k.a.createElement("span",{className:o},"This message will be about ",k.a.createElement("b",null,n)," ",J(n,"character")," long. We estimate it will take ",k.a.createElement("b",null,a)," ",J(a,"message")," to send over SMS.",r&&k.a.createElement(Nn,{unicodeChars:i}),k.a.createElement("div",{className:jn.a.fine_print},"Using variables may result in longer messages that require more messages to send over SMS."))))};!function(e){e.KEY_AT="@",e.KEY_SPACE=" ",e.KEY_ENTER="Enter",e.KEY_UP="ArrowUp",e.KEY_DOWN="ArrowDown",e.KEY_RIGHT="ArrowRight",e.KEY_LEFT="ArrowLeft",e.KEY_TAB="Tab",e.KEY_ESC="Escape",e.KEY_BACKSPACE="Backspace",e.KEY_N="n",e.KEY_P="p",e.KEY_F="f",e.KEY_B="b"}(_n||(_n={}));var Un,An={0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,"\n":10,"\f":12,"\r":13," ":32,"!":33,'"':34,"#":35,$:36,"%":37,"&":38,"'":39,"(":40,")":41,"*":42,"+":43,",":44,"-":45,".":46,"/":47,":":58,";":59,"<":60,"=":61,">":62,"?":63,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,"[":91,"\\":92,"]":93,"^":94,_:95,a:97,b:98,c:99,d:100,e:101,f:102,g:103,h:104,i:105,j:106,k:107,l:108,m:109,n:110,o:111,p:112,q:113,r:114,s:115,t:116,u:117,v:118,w:119,x:120,y:121,z:122,"{":123,"|":124,"}":125,"~":126,"\xa1":161,"\xa3":163,"\xa4":164,"\xa5":165,"\xa7":167,"\xbf":191,"\xc4":196,"\xc5":197,"\xc6":198,"\xc7":199,"\xc9":201,"\xd1":209,"\xd6":214,"\xd8":216,"\xdc":220,"\xdf":223,"\xe0":224,"\xe4":228,"\xe5":229,"\xe6":230,"\xe8":232,"\xe9":233,"\xec":236,"\xf1":241,"\xf2":242,"\xf6":246,"\xf8":248,"\xf9":249,"\xfc":252,"\u0393":915,"\u0394":916,"\u0398":920,"\u039b":923,"\u039e":926,"\u03a0":928,"\u03a3":931,"\u03a6":934,"\u03a8":936,"\u03a9":937,"\u20ac":8364},Dn=function(e,t,n){var a=e.substring(1);if("("===a[0])return!0;var i=a.split(".")[0].toLowerCase();if(!n)return t.indexOf(i)>=0;var r,o=!0,s=!1,l=void 0;try{for(var u,c=t[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value;if(r=i,0===d.indexOf(r,0))return!0}}catch(p){s=!0,l=p}finally{try{o||null==c.return||c.return()}finally{if(s)throw l}}return!1},Fn=function(e){return e>="a"&&e<="z"||e>="A"&&e<="Z"||e>="0"&&e<="9"||"_"===e},Pn=function(e){var t=0,n=!0,a=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){'"'===r.value&&t++}}catch(s){a=!0,i=s}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return t%2!==0},In=function(){function e(t,n){Object(p.a)(this,e),this.expressionPrefix=void 0,this.allowedTopLevels=void 0,this.expressionPrefix=t,this.allowedTopLevels=n}return Object(h.a)(e,[{key:"expressionContext",value:function(e){var t=this.findExpressions(e);if(0===t.length)return null;var n=t[t.length-1];return n.end<e.length||n.closed?null:n.text.substring(1)}},{key:"autoCompleteContext",value:function(e){if(Pn(e))return null;for(var t=[],n="",a=!1,i=!1,r="",o=e.length-1;o>=0;o--){var s=e[o];if(" "===s&&(a=!0),","===s&&(a=!0,"("!==t[t.length-1]&&t.push("(")),")"!==s||i||(a=!0,t.push("("),t.push("(")),'"'===s&&(i=!i),a&&("("!==s||i||("("===t[t.length-1]&&t.pop(),0===t.length&&(a=!1))),"("===s&&""===n&&(r="#"),!(a||i||"("===s&&""===n)){if(!Fn(s)&&"."!==s)break;n=s+n}}return n.match(/[A-Za-z][\w]*(\.[\w]+)*/)?r+n:null}},{key:"functionContext",value:function(e){for(var t=Pn(e)?4:6,n="",a="("===e[-1]?0:1,i=e.length-1;i>=0;i--){var r=e[i];if("@"===r)return"";if(6===t)0!==a||!Fn(r)&&"."!==r?'"'===r?t=4:"("===r?a--:")"===r&&a++:(t=2,n=r+n);else if(2===t){if(!Fn(r)&&"."!==r)return n;n=r+n}else 4===t&&'"'===r&&(t=6)}return""}},{key:"getContactFields",value:function(e){var t={},n=/((parent|child\.)*contact\.)*fields\.([a-z0-9_]+)/g,a=this.findExpressions(e),i=!0,r=!1,o=void 0;try{for(var s,l=a[Symbol.iterator]();!(i=(s=l.next()).done);i=!0)for(var u=s.value,c=void 0;c=n.exec(u.text);)t[c[3]]=!0}catch(d){r=!0,o=d}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}return Object.keys(t)}},{key:"findExpressions",value:function(e){for(var t=[],n=0,a=null,i=0,r=0;r<e.length;r++){var o=e[r],s=r<e.length-1?e[r+1]:0,l=r<e.length-2?e[r+2]:0;if(0===n?o!==this.expressionPrefix||!Fn(s)&&"("!==s?o===this.expressionPrefix&&s===this.expressionPrefix&&(n=5):(n=1,a={start:r,end:null,text:o,closed:!1}):1===n?(Fn(o)?n=2:"("===o&&(n=3,i+=1),a.text+=o):2===n?a.text+=o:3===n?("("===o?i+=1:")"===o?i-=1:'"'===o&&(n=4),a.text+=o,0===i&&(a.end=r+1)):4===n?('"'===o&&(n=3),a.text+=o):5===n&&(n=0),2===n&&(!Fn(s)&&"."!==s||"."===s&&!Fn(l))&&(a.end=r+1),null!=a&&(null!=a.end||0===s)){var u=0===s;Dn(a.text,this.allowedTopLevels,u)&&(a.closed="("===a.text[1]&&0===i,a.end=r+1,t.push(a)),a=null,n=0}}return t}}]),e}(),Mn=n(184),Ln=function(e){var t,n={},a=!0,i=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;t=l,An.hasOwnProperty(t)||(n[l]=!0)}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}return n},zn=function(e,t){var n=e;n.constructor===Array&&(n=n[0]),t&&(n=n.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(/[\u2013\u2014]/g,"-").replace(/\u2026/g,"...").replace(/\u2002/g," "));var a=Object(Mn.split)(n);return{value:n,parts:a.parts,characterCount:a.length,unicodeChars:Ln(n)}},Bn=n(17),Vn=n(120),Gn=n.n(Vn),qn=n(19),Kn=n.n(qn),Wn=n(300);!function(e){e.SMS="SMS"}(Un||(Un={}));var Yn={caretCoordinates:{left:0,top:0},completionVisible:!1,selectedOptionIndex:0,matches:[],query:""},Hn=Xe.a.bind(Object(_.a)({},Kn.a,$e.a)),Xn=function(e){function t(e){var n;Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).selectedEl=void 0,n.textEl=void 0,n.parser=void 0,n.nextCaret=-1;var a="";return n.props.entry&&n.props.entry.value&&(a=n.props.entry.value),n.state=Object(_.a)({value:a,options:Ut(n.props.autocomplete,n.props.assetStore)},Yn,n.props.count&&n.props.count===Un.SMS?zn(a):{}),n.parser=new In("@",["contact","child","fields","input","parent","results","run","trigger","urns","webhook"]),Object(y.react)(Object(f.a)(n),{include:[/^on/,/Ref$/,"setSelection","validate",/^has/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"selectedElRef",value:function(e){return this.selectedEl=e}},{key:"textElRef",value:function(e){return this.textEl=e}},{key:"componentWillReceiveProps",value:function(e){var t=this;(e.entry.value!==this.props.entry.value||this.nextCaret>-1)&&this.setState({value:e.entry.value},function(){t.nextCaret>-1&&(t.textEl.selectionStart=t.nextCaret,t.textEl.selectionEnd=t.nextCaret,t.nextCaret=-1)})}},{key:"componentDidMount",value:function(){return this.checkForMissingFields(),this.props.focus&&this.focusInput()}},{key:"componentDidUpdate",value:function(e){this.selectedEl&&this.selectedEl.scrollIntoView&&this.selectedEl.scrollIntoView(!1)}},{key:"handleKeyDown",value:function(e){var t=this;if(this.props.autocomplete&&(e.key!==_n.KEY_ENTER||!this.props.onEnter||!this.props.onEnter(e)))switch(e.key){case _n.KEY_SPACE:e.ctrlKey&&this.reevaluate(e.currentTarget.value,e.currentTarget.selectionStart,!0);break;case _n.KEY_P:e.ctrlKey&&this.state.completionVisible&&(this.setSelection(this.state.selectedOptionIndex-1),e.preventDefault());break;case _n.KEY_UP:this.state.completionVisible&&(this.setSelection(this.state.selectedOptionIndex-1),e.preventDefault());break;case _n.KEY_N:e.ctrlKey&&this.state.completionVisible&&(this.setSelection(this.state.selectedOptionIndex+1),e.preventDefault());break;case _n.KEY_DOWN:return void(this.state.completionVisible&&(this.setSelection(this.state.selectedOptionIndex+1),e.preventDefault()));case _n.KEY_AT:return void this.setState({completionVisible:!0,caretCoordinates:Gn()(this.textEl,this.textEl.selectionEnd)});case _n.KEY_ESC:return void(this.state.completionVisible&&(this.setState({completionVisible:!1}),e.preventDefault(),e.stopPropagation()));case _n.KEY_TAB:case _n.KEY_ENTER:var n=e.currentTarget.selectionStart;if(this.state.completionVisible&&this.state.matches.length>0){var a=this.state.matches[this.state.selectedOptionIndex],i=this.state.value.substr(0,n-this.state.query.length);if(a.signature){var r=1;a.signature.indexOf("()")>-1&&r++,i+=a.signature.substring(0,a.signature.indexOf("(")+r)}else i+=a.name;var o=i.length,s=!0,l=!1,u=void 0;try{for(var c,d=this.state.value.substr(n)[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var p=c.value;if(!Fn(p)&&"."!==p)break;n++}}catch(g){l=!0,u=g}finally{try{s||null==d.return||d.return()}finally{if(l)throw u}}i+=this.state.value.substr(n);var h=null,m="",v=!1,f=[];return(e.key===_n.KEY_TAB||a.signature)&&(m=a.name,f.push.apply(f,Object(bt.a)(jt(this.state.options,m,!0))),v=f.length>0,a.signature&&-1===a.signature.indexOf("()")&&(h=a)),this.setState({fn:h,query:m,value:i,matches:f,completionVisible:v,selectedOptionIndex:0},function(){t.props.onChange&&t.props.onChange(t.state.value),t.nextCaret=o}),e.preventDefault(),void e.stopPropagation()}return void(this.props.onEnter&&(this.checkForMissingFields(),this.props.onEnter(e)));case _n.KEY_BACKSPACE:return void this.executeQuery(e.currentTarget.value,e.currentTarget.selectionStart-1)}}},{key:"reevaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(this.state.completionVisible||n)&&this.setState(this.executeQuery(e,t))}},{key:"handleKeyUp",value:function(e){if(e.currentTarget){var t=e.currentTarget,n=t.value,a=t.selectionStart;switch(e.key){case _n.KEY_P:case _n.KEY_N:if(this.state.completionVisible&&e.ctrlKey)return;return void this.reevaluate(n,a);case _n.KEY_F:case _n.KEY_B:return void this.reevaluate(n,a);case _n.KEY_RIGHT:case _n.KEY_LEFT:return void this.reevaluate(n,a);case _n.KEY_UP:case _n.KEY_DOWN:if(this.state.completionVisible)return;this.reevaluate(n,a)}}}},{key:"handleClick",value:function(e){if(e.currentTarget){var t=e.currentTarget,n=t.value,a=t.selectionStart;this.reevaluate(n,a)}}},{key:"checkForMissingFields",value:function(){var e=this;if(this.props.autocomplete&&this.props.onFieldFailures){var t=this.parser.getContactFields(this.state.value).filter(function(t){return!(t in e.props.assetStore.fields.items)}).map(function(e){return{message:"".concat(e," is not a valid contact field")}});return this.props.onFieldFailures(t),t.length>0}return!1}},{key:"handleBlur",value:function(e){var t=this;this.checkForMissingFields()?this.props.onBlur&&this.props.onBlur(e):this.setState({query:"",matches:[],selectedOptionIndex:0,completionVisible:!1},function(){return t.props.onBlur&&t.props.onBlur(e)})}},{key:"executeQuery",value:function(e,t){var n=this.parser.expressionContext(e.substr(0,t)),a=null;if(null!==n){var i=n.startsWith("(");if(i){var r=this.parser.functionContext(n);if(r){var o=jt(this.state.options,r,i);o.length>0&&(a=o[0])}}for(var s=n.length;s>=0;s--){var l=n[s];if("@"===l||"("===l||" "===l||0===s){if(("("===l||" "===l)&&(s++,!i))return{completionVisible:!1};var u=n.substr(s,n.length-s),c=jt(this.state.options,u,i);return{query:u,matches:c,completionVisible:c.length>0,selectedOptionIndex:0,caretCoordinates:Gn()(this.textEl,t-u.length),fn:a,value:e}}}}return{value:e,query:null,completionVisible:!1,matches:[],selectedOptionIndex:0}}},{key:"handleChange",value:function(e){var t=e.currentTarget,n=t.value,a=t.selectionStart,i=this.executeQuery(n,a);if(this.props.autocomplete){if(this.props.count===Un.SMS){var r=zn(n,!0),o=r.parts,s=r.characterCount,l=r.unicodeChars;i.parts=o,i.characterCount=s,i.unicodeChars=l}i.selectedOptionIndex=0,this.setState(i)}this.props.onChange&&this.props.onChange(n)}},{key:"setSelection",value:function(e){var t=e;e>=this.state.matches.length&&(t=this.state.matches.length-1),e<0&&(t=0),t!==this.state.selectedOptionIndex&&this.setState({selectedOptionIndex:t})}},{key:"focusInput",value:function(){var e=this.textEl.value.length;this.textEl.focus(),this.textEl.selectionStart=e}},{key:"getOption",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Ct(e),i=null,r=null;return t&&(i=b.createElement("div",{"data-spec":"option-summary",className:Kn.a.option_summary},b.createElement(Wn,{source:e.summary}))),e.examples&&n>0&&(r=b.createElement("div",{"data-spec":"option-example",className:Kn.a.option_examples},b.createElement("div",null,"EXAMPLE",1!==n?"S":""),e.examples.slice(0,n).map(function(t,n){return b.createElement("div",{key:e.name+"_example_"+n}," ",t.template)}))),b.createElement(b.Fragment,null,b.createElement("div",{"data-spec":"option-name",className:Kn.a.option_name},e.signature?b.createElement("div",{className:Kn.a.fn_marker},"\u0192"):null,a,t&&e.signature?b.createElement("div",{className:Kn.a.option_signature},function(e){return e.signature.substr(e.signature.indexOf("("))}(e)):null),i,r)}},{key:"getOptions",value:function(){var e=this;return this.state.matches.map(function(t,n){var a=[Kn.a.option];return n===e.state.selectedOptionIndex?(a.push(Kn.a.selected),0===n&&a.push(Kn.a.first_option),b.createElement("li",{ref:e.selectedElRef,className:a.join(" "),key:t.signature||t.name},e.getOption(t,!0,1))):b.createElement("li",{className:a.join(" "),key:t.signature||t.name},e.getOption(t,!1))})}},{key:"hasErrors",value:function(){return this.getMergedErrors().length>0}},{key:"getMergedErrors",value:function(){return this.props.entry?(this.props.entry.validationFailures||[]).concat(this.props.entry.persistantFailures||[]):[]}},{key:"getScroll",value:function(){return this.textEl?this.textEl.scrollTop:0}},{key:"getError",value:function(){return this.props.entry.validationFailures&&this.props.entry.validationFailures.length>0?this.props.entry.validationFailures[0].message:null}},{key:"getTextElement",value:function(){var e,t=Hn((e={},Object(E.a)(e,Kn.a.textinput,!0),Object(E.a)(e,$e.a.invalid,this.hasErrors()||!0===this.props.showInvalid),e)),n=this.state.value;return this.props.entry&&(n=this.props.entry.value),this.props.textarea?b.createElement("textarea",{"data-spec":"input","data-testid":"input",ref:this.textElRef,className:t,value:n,onClick:this.handleClick,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,placeholder:this.props.placeholder,maxLength:this.props.maxLength||-1}):b.createElement("input",{"data-spec":"input","data-testid":"input",ref:this.textElRef,type:"text",className:t,value:n,onClick:this.handleClick,onChange:this.handleChange,onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,placeholder:this.props.placeholder,maxLength:this.props.maxLength||-1})}},{key:"render",value:function(){var e,t,n=Hn((e={},Object(E.a)(e,Kn.a.completion_container,!0),Object(E.a)(e,Kn.a.hidden,!this.state.completionVisible||0===this.state.matches.length),e)),a=Hn((t={},Object(E.a)(t,Kn.a.fn_container,!0),Object(E.a)(t,Kn.a.hidden,!this.state.completionVisible||0===this.state.matches.length),t)),i=this.getOptions(),r=this.props.count&&this.props.count===Un.SMS?b.createElement(Rn,{count:this.state.characterCount,parts:this.state.parts.length,unicodeChars:this.state.unicodeChars}):null,o=this.hasErrors()&&"Message"===this.props.name&&(this.props.typeConfig.type===ve.send_msg||this.props.typeConfig.type===ve.send_broadcast),s=this.state.fn&&!this.state.query;return b.createElement(Je,{__className:this.props.__className,name:this.props.name,helpText:this.props.helpText,showLabel:this.props.showLabel,entry:this.props.entry,sendMsgError:o},b.createElement("div",{className:Kn.a.wrapper},this.getTextElement(),b.createElement("div",{className:n,style:{top:this.state.caretCoordinates.top-this.getScroll(),left:this.state.caretCoordinates.left},"data-spec":"completion-options"},b.createElement("div",{className:Kn.a.options_wrapper},b.createElement("ul",{className:Kn.a.option_list,"data-spec":"completion-list"},i),b.createElement("div",{className:Kn.a.help,"data-spec":"completion-help"},"Tab to complete, enter to select")),s?b.createElement("div",{className:a},this.getOption(this.state.fn,!0,3)):null)),r)}}]),t}(b.Component),Qn=Object(Bn.b)(function(e){var t=e.flowContext.assetStore;return{typeConfig:e.nodeEditor.typeConfig,assetStore:t}},null,null,{withRef:!0})(Xn),$n=n(121),Zn=n.n($n),Jn=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Cn(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleSave",value:function(){var e,t;if(this.handlePathChanged(this.state.path.value,!0)){var n=(e=this.props.nodeSettings,t=this.state,{type:ve.add_contact_urn,uuid:Oe(e,ve.add_input_labels),scheme:t.scheme.value.value,path:t.path.value});this.props.updateAction(n),this.props.onClose(!1)}}},{key:"handleSchemeChanged",value:function(e){var t={scheme:{value:e}},n=Ht(this.state,t);return this.setState(n),n.valid}},{key:"handlePathChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={path:tn("URN",e,[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this,t=this.props.typeConfig;return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement("p",{"data-spec":"label"},"Add a new URN to reach the contact such as a phone number."),b.createElement("div",{className:Zn.a.scheme_selection},b.createElement(wn,{name:"URN Type",entry:this.state.scheme,onChange:this.handleSchemeChanged,options:os.map(function(e){return kn(e)})})),b.createElement("div",{className:Zn.a.path},b.createElement(Qn,{name:"URN",placeholder:"Enter the URN value",entry:this.state.path,onChange:this.handlePathChanged,onFieldFailures:function(t){var n=Object(_.a)({},e.state.path,{persistantFailures:t});e.setState({path:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0})))}}]),t}(b.PureComponent),ea=function(e){var t=e.resthook;return b.createElement("div",null,t)},ta=function(e){var t=e.url;return b.createElement("div",null,t)},na=function(e){return e.content&&e.content.query},aa=function(e){return e.map(function(e){return{name:e.name,id:e.uuid,type:pe.Group}})},ia=function(e){return e?e.map(function(e){return{uuid:e.id,name:e.name}}):[]},ra=function(e){if(e.originalAction&&e.originalAction.type===ve.add_contact_groups){var t=e.originalAction;return{groups:{value:aa(t.groups)},valid:!0}}return{groups:{value:null},valid:!1}},oa=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=ra(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleSave",value:function(){var e,t;if(this.handleGroupsChanged(this.state.groups.value,!0)){var n=(e=this.props.nodeSettings,t=this.state,{type:ve.add_contact_groups,groups:ia(t.groups.value),uuid:Oe(e,ve.add_contact_groups)});this.props.updateAction(n),this.props.onClose(!1)}}},{key:"handleGroupsChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={groups:tn("Groups",e,[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleGroupAdded",value:function(e){this.props.addAsset("groups",e),this.handleGroupsChanged((this.state.groups.value||[]).concat(e),!1)}},{key:"handleCreateAssetFromInput",value:function(e){return{name:e}}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",{"data-spec":"label"},"Select the group(s) to add the contact to."),b.createElement(zt,{name:"Groups",multi:!0,noOptionsMessage:"Enter a name to create a new group",assets:this.props.assetStore.groups,entry:this.state.groups,onChange:this.handleGroupsChanged,searchable:!0,shouldExclude:na,createPrefix:"Create Group: ",createAssetFromInput:this.handleCreateAssetFromInput,onAssetCreated:this.handleGroupAdded}))}}]),t}(b.Component),sa=function(e,t){var n=e.type,a=e.groups,i=[];return n!==ve.remove_contact_groups||a&&a.length?Ne(a.map(function(e){return{id:e.uuid,name:e.name,type:pe.Group}}),3,t):(i.push(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"remove_from_all",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"remove_from_all",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Remove from all groups";return b.createElement("div",{key:e,"data-spec":t},n)}()),i)},la=function(e,t){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"content";return b.createElement("div",{"data-spec":n},sa(e,t))}(e,t.config.endpoints)};la.contextTypes={config:Be};var ua=la,ca=n(54),da=n.n(ca),pa=Xe.a.bind(da.a),ha=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={checked:n.props.checked},n.handleChange=n.handleChange.bind(Object(f.a)(n)),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleChange",value:function(){var e=this;this.setState({checked:!this.state.checked},function(){e.props.onChange&&e.props.onChange(e.state.checked)})}},{key:"validate",value:function(){return!0}},{key:"render",value:function(){var e=this.state.checked?"fe-check-square":"fe-square";return b.createElement("label",{className:pa(da.a.label,this.props.labelClassName),onClick:this.handleChange},b.createElement("span",{"data-spec":"checkbox",className:pa(e,this.props.checkboxClassName)}),G(q(this.props.title))(b.createElement("div",{"data-spec":"title",className:da.a.title},this.props.title)),G(q(this.props.description))(b.createElement("div",{"data-spec":"description",className:this.props.title?da.a.description:da.a.description_solo},this.props.description)))}}]),t}(b.Component),ma=function(e){if(e.originalAction&&e.originalAction.type===ve.remove_contact_groups){var t=e.originalAction,n=t.groups||[];return{groups:{value:aa(n)},removeAll:0===n.length||t.all_groups,valid:!0}}return{groups:{value:null},removeAll:!1,valid:!1}},va=n(186),fa=n.n(va),ga=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=ma(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleSave",value:function(){var e,t;if(this.handleGroupsChanged(this.state.groups.value,!0)){var n=(e=this.props.nodeSettings,t=this.state,{type:ve.remove_contact_groups,groups:t.removeAll?[]:ia(t.groups.value),all_groups:!!t.removeAll,uuid:Oe(e,ve.remove_contact_groups)});this.props.updateAction(n),this.props.onClose(!1)}}},{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={},a=this.state.removeAll?[]:[sn(t)];e.hasOwnProperty("removeAll")&&(n.removeAll=e.removeAll,e.removeAll&&(a=[])),e.hasOwnProperty("groups")&&(n.groups=tn("Groups",e.groups,a));var i=Ht(this.state,n);return this.setState(i),i.valid}},{key:"handleGroupsChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({groups:e},t)}},{key:"handleRemoveAllUpdate",value:function(e){return this.handleUpdate({removeAll:e})}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),G(!this.state.removeAll)(b.createElement("div",null,b.createElement("p",{"data-spec":"label"},"Select the group(s) to remove the contact from."),b.createElement(zt,{name:"Groups",assets:this.props.assetStore.groups,entry:this.state.groups,searchable:!0,onChange:this.handleGroupsChanged,multi:!0}))),b.createElement(ha,{name:"Remove from All",title:"Remove from All",labelClassName:this.state.removeAll?"":fa.a.checkbox,checked:this.state.removeAll,description:"Remove the active contact from all groups they're a member of.",onChange:this.handleRemoveAllUpdate}))}}]),t}(b.Component);ga.contextTypes={assetService:Be};var _a=n(29),ya=n.n(_a),ba=function(e){var t=e.originalNode,n=t&&t.node;if(e.originalAction&&e.originalAction.type)return cs(e.originalAction.type);if(n&&n.actions&&n.actions.length>0)return cs(n.actions[n.actions.length-1].type);try{var a=ds(t),i=cs(a);if(i.type!==ve.missing)return i}catch(Error){}if(n&&n.router)return cs(n.router.type);throw new Error("Couldn't determine type config for: ".concat(n.uuid))},ka=n(67),Ca=n.n(ka),Ea=function(e){var t=e.text;e.text.startsWith("@")?t="@(exp)":e.maxLength&&t.length>e.maxLength&&(t=e.text.substring(0,e.maxLength)+"...");var n=[Ca.a.pill];return e.large&&n.push(Ca.a.large),e.onClick&&n.push(Ca.a.clickable),b.createElement("div",{style:e.style,"data-advanced":e.advanced,onClick:e.onClick,className:n.join(" ")},t,e.icon?b.createElement("span",{"data-advanced":e.advanced,className:Ca.a.icon+" "+e.icon}):null)},wa=n(122),Oa=n.n(wa),Sa=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).props.entry?n.state={currentInput:n.props.entry}:n.state={currentInput:{value:""}},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleInputChanged",value:function(e){this.setState({currentInput:{value:e}}),this.props.onEntryChanged&&this.props.onEntryChanged({value:e})}},{key:"handleAddItem",value:function(e){var t=this;return window.setTimeout(function(){if(!((t.state.currentInput.persistantFailures||[]).length>0)&&t.state.currentInput.value.trim().length>0){var e=t.state.currentInput.value.trim();t.props.onItemAdded(e)&&t.setState({currentInput:{value:""}}),t.props.onEntryChanged&&t.props.onEntryChanged({value:""})}},0),!0}},{key:"handleValidateEmpty",value:function(){var e=this,t=tn(this.props.name,this.state.currentInput.value,[nn]);this.setState({currentInput:t},function(){e.props.onEntryChanged&&e.props.onEntryChanged(t)})}},{key:"getChosenItems",value:function(){var e=this;return this.props.items.value.length>0?b.createElement("div",{className:Oa.a.chosen},this.props.items.value.map(function(t){return b.createElement("div",{key:"item_".concat(t),className:Oa.a.item},b.createElement(Ea,{icon:"fe-x",text:" "+t,large:!0,onClick:function(){e.props.onRemoved(t)}}))})):null}},{key:"render",value:function(){var e=this;return b.createElement(b.Fragment,null,this.getChosenItems(),this.props.helpText?b.createElement("p",null,this.props.helpText):b.createElement("p",null),b.createElement(Qn,{name:this.props.name,placeholder:this.props.name,showLabel:!1,onChange:this.handleInputChanged,entry:this.state.currentInput,autocomplete:!0,focus:!0,onBlur:this.handleValidateEmpty,onEnter:this.handleAddItem,onFieldFailures:function(t){var n=Object(_.a)({},e.state.currentInput,{persistantFailures:t});e.setState({currentInput:n},function(){e.props.onEntryChanged&&e.props.onEntryChanged(n)})}}))}}]),t}(b.Component),Na=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).filePicker=void 0,n.state={},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleRemoveUpload",value:function(){this.props.onUploadChanged(null)}},{key:"handleUploadFile",value:function(e){var t=this,n=new FormData;n.append("file",e[0]);var a=st("csrftoken"),i=a?{"X-CSRFToken":a}:{};it.a.post(this.props.endpoint,n,{headers:i}).then(function(e){t.props.onUploadChanged(e.data.url)}).catch(function(e){console.log(e)})}},{key:"render",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("input",{style:{display:"none"},ref:function(t){e.filePicker=t},type:"file",onChange:function(t){return e.handleUploadFile(t.target.files)}}),this.props.url?b.createElement(ae,{iconName:"fe-trash",name:this.props.removeText,topSpacing:!0,onClick:this.handleRemoveUpload,type:w.tertiary}):b.createElement(ae,{iconName:this.props.icon,name:this.props.uploadText,topSpacing:!0,onClick:function(){e.filePicker.click()},type:w.tertiary}))}}]),t}(b.Component),xa=function(e){if(e.originalAction&&(e.originalAction.type===ve.send_msg||e.originalAction.type===ve.say_msg)&&e.localizations&&e.localizations.length>0){var t=e.localizations[0];if(t.isLocalized()){var n=t.getObject();return{message:{value:"text"in t.localizedKeys?n.text:""},quickReplies:{value:"quick_replies"in t.localizedKeys&&n.quick_replies||[]},audio:{value:"audio_url"in t.localizedKeys?n.audio_url:null},valid:!0}}}return{message:{value:""},quickReplies:{value:[]},audio:{value:null},valid:!0}},ja=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=xa(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^on/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleMessageUpdate",value:function(e){return this.handleUpdate({text:e})}},{key:"handleQuickRepliesUpdate",value:function(e){return this.handleUpdate({quickReplies:e})}},{key:"handleAudioChanged",value:function(e){this.handleUpdate({audio:e})}},{key:"handleUpdate",value:function(e){var t={};e.hasOwnProperty("text")&&(t.message=tn("Message",e.text,[])),e.hasOwnProperty("quickReplies")&&(t.quickReplies=tn("Quick Replies",e.quickReplies,[ln])),e.hasOwnProperty("audio")&&(t.audio={value:e.audio});var n=Ht(this.state,t);return this.setState(n),n.valid}},{key:"handleSave",value:function(){var e=this.state,t=e.message,n=e.quickReplies,a=e.audio;if(!(ba(this.props.nodeSettings).localizeableKeys.indexOf("quick_replies")>-1)||this.handleQuickRepliesUpdate(this.state.quickReplies.value)){var i={};t.value&&(i.text=t.value),n.value&&(i.quick_replies=n.value),a.value&&(i.audio_url=a.value),this.props.updateLocalizations(this.props.language.id,[{uuid:this.props.nodeSettings.originalAction.uuid,translations:i}]),this.props.onClose(!1)}}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleAddQuickReply",value:function(e){var t=Object(bt.a)(this.state.quickReplies.value);return!(t.length>=10)&&(!t.find(function(t){return t.toLowerCase()===e.toLowerCase()})&&(t.push(e),this.setState({quickReplies:{value:t}}),!0))}},{key:"handleRemoveQuickReply",value:function(e){this.setState({quickReplies:{value:this.state.quickReplies.value.filter(function(t){return t!==e})}})}},{key:"handleQuickReplyFieldFailures",value:function(e){var t=Object(_.a)({},this.state.quickReplies,{persistantFailures:e});this.setState({quickReplies:t,valid:this.state.valid&&!Te(t)})}},{key:"render",value:function(){var e=this,t=ba(this.props.nodeSettings),n=[];t.localizeableKeys.indexOf("quick_replies")>-1&&n.push({name:"Quick Replies",body:b.createElement(b.Fragment,null,b.createElement(Sa,{name:"Quick Reply",helpText:"Add a new ".concat(this.props.language.name," Quick Reply and press enter."),items:this.state.quickReplies,onRemoved:this.handleRemoveQuickReply,onItemAdded:this.handleAddQuickReply,onFieldErrors:this.handleQuickReplyFieldFailures}))});var a=null;return t.localizeableKeys.indexOf("audio_url")>0&&(a=b.createElement(Na,{icon:"fe-mic",uploadText:"Upload Recording",removeText:"Remove Recording",url:this.state.audio.value,endpoint:this.context.config.endpoints.attachments,onUploadChanged:this.handleAudioChanged})),b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons(),tabs:n},b.createElement("div",{"data-spec":"translation-container"},b.createElement("div",{"data-spec":"text-to-translate",className:ya.a.translate_from},this.props.nodeSettings.originalAction.text)),b.createElement(Qn,{name:"Message",showLabel:!1,onChange:this.handleMessageUpdate,entry:this.state.message,placeholder:"".concat(this.props.language.name," Translation"),onFieldFailures:function(t){var n=Object(_.a)({},e.state.message,{persistantFailures:t});e.setState({message:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,focus:!0,textarea:!0}),a)}}]),t}(b.Component);ja.contextTypes={config:Be};var Ta=function(e){var t=e.type;return b.createElement("div",{className:"placeholder"},"No implementation yet for ",t)},Ra=function(e){return b.createElement("div",null,e.audio_url)},Ua=function(e){return e.originalAction&&e.originalAction.type===ve.play_audio?{audio:{value:e.originalAction.audio_url},valid:!0}:{audio:{value:""},valid:!1}},Aa=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Ua(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleAudioUpdate",value:function(e){var t={};t.audio=tn("Recording",e,[an]);var n=Ht(this.state,t);return this.setState(n),n.valid}},{key:"handleSave",value:function(){var e;this.handleAudioUpdate(this.state.audio.value)&&(this.props.updateAction((e=this.props.nodeSettings,{audio_url:this.state.audio.value,type:ve.play_audio,uuid:Oe(e,ve.say_msg)})),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this,t=this.props.typeConfig;return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement("p",null,"Previous Recording"),b.createElement(Qn,{name:"Message",showLabel:!1,onChange:this.handleAudioUpdate,entry:this.state.audio,onFieldFailures:function(t){var n=Object(_.a)({},e.state.audio,{persistantFailures:t});e.setState({audio:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,focus:!0,helpText:"Enter a variable that contains a recording the contact has previously recorded. For example, @flow.voicemail or @contact.short_bio."}))}}]),t}(b.Component),Da=n(44),Fa=n.n(Da),Pa=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,n.stroke=1,n.radius=9,n.radiusNormalized=n.radius-2*n.stroke,n.circumference=2*n.radiusNormalized*Math.PI,n.state={durationSeconds:0,currentSeconds:0,playing:!1,progress:0},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleTimeUpdate",value:function(e){var t=this,n=this.ele.currentTime||0,a=this.ele.duration||0;this.setState(function(e){return(t.ele.ended||0===n)&&e.playing&&setTimeout(function(){t.setState({progress:0,playing:!1})},500),{currentSeconds:t.ele.ended?0:n,durationSeconds:a,playing:n>0,progress:a>0?Math.floor(n/a*100):0}})}},{key:"componentDidMount",value:function(){this.props.triggered&&this.handleTogglePlay(null)}},{key:"handleTogglePlay",value:function(e){this.state.playing?(this.ele.pause(),this.ele.currentTime=0):this.ele.play(),null!==e&&(e.preventDefault(),e.stopPropagation())}},{key:"handleRef",value:function(e){return this.ele=e}},{key:"componentDidUpdate",value:function(e){this.props.url!==e.url&&this.setState({durationSeconds:0,currentSeconds:0,playing:!1,progress:0})}},{key:"render",value:function(){var e=this.state.progress||0,t=this.circumference-e/100*this.circumference;return b.createElement("div",{className:Fa.a.player+" "+(this.state.playing?Fa.a.playing:""),style:{height:2*this.radius,width:2*this.radius},onMouseDown:this.handleTogglePlay},b.createElement("audio",{ref:this.handleRef,onTimeUpdate:this.handleTimeUpdate,src:this.props.url}),b.createElement("div",{className:Fa.a.circles},b.createElement("svg",{height:2*this.radius,width:2*this.radius},b.createElement("circle",{className:Fa.a.circle_background,stroke:"#fff",fill:"#fff",strokeWidth:this.stroke,r:this.radiusNormalized,cx:this.radius,cy:this.radius}),b.createElement("circle",{className:Fa.a.circle_background,stroke:"#ddd",fill:"transparent",strokeWidth:this.stroke,r:this.radiusNormalized,cx:this.radius,cy:this.radius}),b.createElement("circle",{className:Fa.a.circle_foreground,stroke:"cornflowerblue",fill:"transparent",strokeWidth:this.stroke,strokeDasharray:this.circumference+" "+this.circumference,style:{strokeDashoffset:t},r:this.radiusNormalized,cx:this.radius,cy:this.radius}))),b.createElement("div",{className:Fa.a.button+" "+(this.state.playing?"fe-stop":"fe-play_arrow")}))}}]),t}(b.Component),Ia=n(123),Ma=n.n(Ia),La=function(e){return e.text?b.createElement(b.Fragment,null,b.createElement("div",{className:Ma.a.text},e.text),e.audio_url?b.createElement("div",{className:Ma.a.recording},b.createElement(Pa,{url:e.audio_url})):null):b.createElement("div",{className:"placeholder"},"Send a message to the contact")},za=function(e){if(e.originalAction&&e.originalAction.type===ve.say_msg){var t=e.originalAction;return{message:{value:t.text},audio:{value:t.audio_url},valid:!0}}return{message:{value:""},audio:{value:""},valid:!1}},Ba=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=za(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("text")&&(n.message=tn("Message",e.text,[sn(t)]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleMessageUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({text:e},t)}},{key:"handleSave",value:function(){var e,t;this.handleUpdate({text:this.state.message.value},!0)&&(this.props.updateAction((e=this.props.nodeSettings,{text:(t=this.state).message.value,audio_url:t.audio.value,type:ve.say_msg,uuid:Oe(e,ve.say_msg)})),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleUploadChanged",value:function(e){this.setState({audio:{value:e}})}},{key:"render",value:function(){var e=this,t=this.props.typeConfig;return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement(Qn,{name:"Message",showLabel:!1,onChange:this.handleMessageUpdate,entry:this.state.message,onFieldFailures:function(t){var n=Object(_.a)({},e.state.message,{persistantFailures:t});e.setState({message:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,focus:!0,textarea:!0}),b.createElement(Na,{icon:"fe-mic",uploadText:"Upload Recording",removeText:"Remove Recording",url:this.state.audio.value,endpoint:this.context.config.endpoints.attachments,onUploadChanged:this.handleUploadChanged}))}}]),t}(b.Component);Ba.contextTypes={config:Be};var Va=n(68),Ga=n.n(Va),qa=function(e,t){var n=Se(e);return e.text?b.createElement("div",{className:Ga.a.node},b.createElement("div",{className:Ga.a.to},Ne(n,3,t.config.endpoints)),b.createElement("div",{className:Ga.a.message},e.text.split(/\r?\n/).map(function(t,n){return b.createElement("div",{key:e.uuid+n,className:Ga.a.line},t)}))):b.createElement("div",{className:"placeholder"},"Send a message to the contact")};qa.contextTypes={config:Be};var Ka=qa,Wa=function(e){if(e.originalAction&&e.originalAction.type===ve.send_broadcast){var t=e.originalAction;if(e.localizations&&e.localizations.length>0){if(!e.localizations[0].isLocalized())return{message:{value:""},recipients:{value:[]},valid:!0};t=e.localizations[0].getObject()}return{message:{value:t.text},recipients:{value:Se(t)},valid:!0}}return{message:{value:""},recipients:{value:[]},valid:!1}},Ya=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Wa(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleRecipientsChanged",value:function(e){return this.handleUpdate({recipients:e})}},{key:"handleMessageUpdate",value:function(e){return this.handleUpdate({text:e})}},{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("recipients")&&(n.recipients=tn("Recipients",e.recipients,[sn(t)])),e.hasOwnProperty("text")&&(n.message=tn("Message",e.text,[sn(t)]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){var e,t;this.handleUpdate({text:this.state.message.value,recipients:this.state.recipients.value},!0)&&(this.props.updateAction((e=this.props.nodeSettings,t=this.state,{legacy_vars:Re(t.recipients.value),contacts:Ue(t.recipients.value,pe.Contact),groups:Ue(t.recipients.value,pe.Group),text:t.message.value,type:ve.send_broadcast,uuid:Oe(e,ve.send_broadcast)})),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this,t=this.props.typeConfig;return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement(zt,{name:"Recipients",assets:this.props.assetStore.recipients,entry:this.state.recipients,completion:this.props.assetStore,searchable:!0,multi:!0,onChange:this.handleRecipientsChanged}),b.createElement("p",null),b.createElement(Qn,{name:"Message",showLabel:!1,count:Un.SMS,onChange:this.handleMessageUpdate,entry:this.state.message,onFieldFailures:function(t){var n=Object(_.a)({},e.state.message,{persistantFailures:t});e.setState({message:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,focus:!0,textarea:!0}))}}]),t}(b.Component);Ya.contextTypes={endpoints:Be,assetService:Be};var Ha=function(e){var t=e.subject;return b.createElement("div",null,t)},Xa=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateTags",value:function(e){this.props.onChange&&this.props.onChange(function(e){return e.map(function(e){return e.label})}(e))}},{key:"handleCheckValid",value:function(e){return!(!e||0===e.trim().length)&&this.props.onCheckValid(e)}},{key:"arrowRenderer",value:function(){return k.a.createElement("div",null)}},{key:"render",value:function(){var e=this,t=M((this.props.entry.validationFailures||[]).length),n=function(e){return e.value.map(function(e){return{label:e,value:e}})}(this.props.entry);return k.a.createElement(Je,{name:this.props.name,entry:this.props.entry},k.a.createElement(yt.a,{styles:Pt,className:t,name:this.props.name,placeholder:this.props.placeholder,value:n,onChange:this.handleUpdateTags,isMulti:!0,isSearchable:!0,isValidNewOption:this.handleCheckValid,noOptionsMessage:function(){return e.props.prompt},options:[]}))}}]),t}(k.a.Component),Qa=function(e){if(e.originalAction&&e.originalAction.type===ve.send_email){var t=e.originalAction;return{body:{value:t.body},subject:{value:t.subject},recipients:{value:t.addresses},valid:!0}}return{body:{value:""},subject:{value:""},recipients:{value:[]},valid:!0}},$a=n(89),Za=n.n($a),Ja=/\S+@\S+\.\S+/,ei=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Qa(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleRecipientsChanged",value:function(e){return this.handleUpdate({recipients:e})}},{key:"handleSubjectChanged",value:function(e){return this.handleUpdate({subject:e})}},{key:"handleBodyChanged",value:function(e){return this.handleUpdate({body:e})}},{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("recipients")&&(n.recipients=tn("Recipients",e.recipients,[sn(t)])),e.hasOwnProperty("subject")&&(n.subject=tn("Subject",e.subject,[sn(t)])),e.hasOwnProperty("body")&&(n.body=tn("Body",e.body,[sn(t)]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){var e,t;this.handleUpdate({recipients:this.state.recipients.value,subject:this.state.subject.value,body:this.state.body.value},!0)&&(this.props.updateAction((e=this.props.nodeSettings,{addresses:(t=this.state).recipients.value,subject:t.subject.value,body:t.body.value,type:ve.send_email,uuid:Oe(e,ve.send_email)})),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleCheckValid",value:function(e){return Ja.test(e)}},{key:"render",value:function(){var e=this,t=this.props.typeConfig;return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement("div",{className:Za.a.ele},b.createElement(Xa,{name:"Recipient",placeholder:"To",prompt:"Enter e-mail address",onCheckValid:this.handleCheckValid,entry:this.state.recipients,onChange:this.handleRecipientsChanged}),b.createElement(Qn,{__className:Za.a.subject,name:"Subject",placeholder:"Subject",onChange:this.handleSubjectChanged,entry:this.state.subject,onFieldFailures:function(t){var n=Object(_.a)({},e.state.subject,{persistantFailures:t});e.setState({subject:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0}),b.createElement(Qn,{__className:Za.a.message,name:"Message",showLabel:!1,onChange:this.handleBodyChanged,entry:this.state.body,onFieldFailures:function(t){var n=Object(_.a)({},e.state.body,{persistantFailures:t});e.setState({body:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,textarea:!0})))}}]),t}(b.Component),ti=n(55),ni=n.n(ti),ai=function(e){if(e.text){var t=null;return(e.quick_replies||[]).length>0&&(t=b.createElement("div",{className:ni.a.quick_replies},e.quick_replies.map(function(t){return b.createElement(Ea,{style:{marginLeft:4,marginTop:4},maxLength:20,advanced:!0,key:e.uuid+t,text:t})}))),b.createElement(b.Fragment,null,b.createElement("div",null,e.text.split(/\r?\n/).map(function(t,n){return b.createElement("div",{key:e.uuid+n,className:ni.a.line},t)}),e.attachments&&e.attachments.length>0?b.createElement("div",{"data-advanced":!0,className:"".concat(ni.a.attachment," fe-paperclip")}):null,e.templating&&e.templating.template?b.createElement("div",{"data-advanced":!0,className:"".concat(ni.a.whatsapp," fe-whatsapp")}):null),b.createElement("div",{className:ni.a.summary},t))}return b.createElement("div",{className:"placeholder"},"Send a message to the contact")},ii=function(e,t){var n={value:null},a=[];if(e.originalAction&&e.originalAction.type===ve.send_msg){var i=e.originalAction,r=[];if((i.attachments||[]).forEach(function(e){var t=e.indexOf(":"),n=e.substring(0,t),a={type:n,url:e.substring(t+1),uploaded:n.indexOf("/")>-1};r.push(a)}),i.templating){var o=i.templating.template;n={value:{id:o.uuid,name:o.name,type:pe.Template}},a=i.templating.variables.map(function(e){return{value:e}})}return{template:n,templateVariables:a,attachments:r,message:{value:i.text},quickReplies:{value:i.quick_replies||[]},quickReplyEntry:{value:""},sendAll:i.all_urns,valid:!0}}return{template:n,templateVariables:[],attachments:[],message:{value:""},quickReplies:{value:[]},quickReplyEntry:{value:""},sendAll:!1,valid:!1}},ri=n(34),oi=n.n(ri),si=[{value:"image",label:"Image URL"},{value:"audio",label:"Audio URL"},{value:"video",label:"Video URL"}],li=si.concat([{value:"upload",label:"Upload Attachment"}]),ui=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).filePicker=void 0,n.state=ii(n.props.nodeSettings,n.props.assetStore),Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^on/]}),null!==n.state.template.value&&lt(n.props.assetStore.templates,n.state.template.value.id).then(function(e){null!==e&&n.handleTemplateChanged([e])}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("text")&&(n.message=tn("Message",e.text,[sn(t)])),e.hasOwnProperty("sendAll")&&(n.sendAll=e.sendAll),e.hasOwnProperty("quickReplies")&&(n.quickReplies=tn("Quick Replies",e.quickReplies,[ln]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleMessageUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({text:e},t)}},{key:"handleQuickRepliesUpdate",value:function(e){return this.handleUpdate({quickReplies:e})}},{key:"handleSendAllUpdate",value:function(e){return this.handleUpdate({sendAll:e})}},{key:"handleSave",value:function(){var e=this.handleMessageUpdate(this.state.message.value,!0),t=this.state.templateVariables;this.state.templateVariables.forEach(function(n,a){var i=tn("Variable ".concat(a+1),n.value,[an]);t=Yt()(t,Object(E.a)({},a,{$merge:i})),e=e&&!Te(i)}),(e=e&&!Te(this.state.quickReplyEntry))?(this.props.updateAction(function(e,t){var n=t.attachments.filter(function(e){return e.url.trim().length>0}).map(function(e){return"".concat(e.type,":").concat(e.url)}),a=null;t.template&&t.template.value&&(a={template:{uuid:t.template.value.id,name:t.template.value.name},variables:t.templateVariables.map(function(e){return e.value})});var i={attachments:n,text:t.message.value,type:ve.send_msg,all_urns:t.sendAll,quick_replies:t.quickReplies.value,uuid:Oe(e,ve.send_msg)};return a&&(i.templating=a),i}(this.props.nodeSettings,this.state)),this.props.onClose(!1)):this.setState({templateVariables:t,valid:e})}},{key:"handleFieldFailures",value:function(e){var t=Object(_.a)({},this.state.message,{persistantFailures:e});this.setState({message:t,valid:this.state.valid&&!Te(t)})}},{key:"handleQuickReplyFieldFailures",value:function(e){var t=Object(_.a)({},this.state.quickReplies,{persistantFailures:e});this.setState({quickReplies:t,valid:this.state.valid&&!Te(t)})}},{key:"handleAttachmentRemoved",value:function(e){var t=Yt()(this.state.attachments,{$splice:[[e,1]]});this.setState({attachments:t})}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderUpload",value:function(e,t){var n=this;return b.createElement("div",{className:oi.a.url_attachment,key:e>-1?"url_attachment_"+e:$()},b.createElement("div",{className:oi.a.type_choice},b.createElement(wn,{name:"Type",styles:Ft,entry:{value:{label:t.type}},options:si})),b.createElement("div",{className:oi.a.url},b.createElement("span",{className:oi.a.upload},b.createElement(Ea,{icon:"fe-download",text:" Download",large:!0,onClick:function(){window.open(t.url,"_blank")}}),b.createElement("div",{className:oi.a.remove_upload},b.createElement(Ea,{icon:"fe-x",text:" Remove",large:!0,onClick:function(){n.handleAttachmentRemoved(e)}})))))}},{key:"handleUploadFile",value:function(e){var t=this,n=this.state.attachments,a=st("csrftoken"),i=a?{"X-CSRFToken":a}:{},r=new FormData;r.append("file",e[0]),it.a.post(this.context.config.endpoints.attachments,r,{headers:i}).then(function(e){n=Yt()(n,{$push:[{type:e.data.type,url:e.data.url,uploaded:!0}]}),t.setState({attachments:n})}).catch(function(e){console.log(e)})}},{key:"renderAttachment",value:function(e,t){var n,a=this,i=this.state.attachments;return b.createElement("div",{className:oi.a.url_attachment,key:e>-1?"url_attachment_"+e:$()},b.createElement("div",{className:oi.a.type_choice},b.createElement(wn,{styles:Ft,name:"Type Options",placeholder:"Add Attachment",entry:{value:e>-1?(n=t.type,si.find(function(e){return e.value===n})):null},onChange:function(n){"upload"===n.value?window.setTimeout(function(){a.filePicker.click()},200):(i=-1===e?Yt()(i,{$push:[{type:n.value,url:""}]}):Yt()(i,Object(E.a)({},e,{$set:{type:n.value,url:t.url}})),a.setState({attachments:i}))},options:e>-1?si:li})),e>-1?b.createElement(b.Fragment,null,b.createElement("div",{className:oi.a.url},b.createElement(Qn,{placeholder:"URL",name:"url",onChange:function(n){i=Yt()(i,Object(E.a)({},e,{$set:{type:t.type,url:n}})),a.setState({attachments:i})},entry:{value:t.url},autocomplete:!0})),b.createElement("div",{className:oi.a.remove},b.createElement(Ea,{icon:"fe-x",text:" Remove",large:!0,onClick:function(){a.handleAttachmentRemoved(e)}}))):null)}},{key:"renderAttachments",value:function(){var e=this,t=this.state.attachments.map(function(t,n){return t.uploaded?e.renderUpload(n,t):e.renderAttachment(n,t)}),n=this.state.attachments.length<3?this.renderAttachment(-1,{url:"",type:""}):null;return b.createElement(b.Fragment,null,b.createElement("p",null,"Add up to ",3," attachments to each message. Each attachment can be a file you upload or a dynamic URL using expressions and variables from your Flow."),t,n,b.createElement("input",{style:{display:"none"},ref:function(t){e.filePicker=t},type:"file",onChange:function(t){return e.handleUploadFile(t.target.files)}}))}},{key:"handleTemplateChanged",value:function(e){var t=e[0];if(t){var n=t.content.translations[0],a=0===this.state.templateVariables.length||this.state.template.value&&this.state.template.value.id!==t.id?Z(0,n.variable_count).map(function(){return{value:""}}):this.state.templateVariables;this.setState({template:{value:t},templateTranslation:n,templateVariables:a})}else this.setState({template:{value:null},templateTranslation:null,templateVariables:[]})}},{key:"handleTemplateFieldFailures",value:function(e,t){var n=Yt()(this.state.templateVariables,Object(E.a)({},t,{$merge:{persistantFailures:e}}));this.setState({templateVariables:n,valid:this.state.valid&&!Te(n[t])})}},{key:"handleTemplateVariableChanged",value:function(e,t){var n=tn("Variable ".concat(t+1),e,[an]),a=Yt()(this.state.templateVariables,{$merge:Object(E.a)({},t,n)});this.setState({templateVariables:a})}},{key:"handleShouldExcludeTemplate",value:function(e){return!e.content.translations.find(function(e){return"pending"===e.status||"approved"===e.status})}},{key:"renderTemplateConfig",value:function(){var e=this;return b.createElement(b.Fragment,null,b.createElement("p",null,"Sending messages over a WhatsApp channel requires that a template be used if you have not received a message from a contact in the last 24 hours. Setting a template to use over WhatsApp is especially important for the first message in your flow."),b.createElement(zt,{name:"Template",noOptionsMessage:"No templates found",assets:this.props.assetStore.templates,entry:this.state.template,onChange:this.handleTemplateChanged,shouldExclude:this.handleShouldExcludeTemplate,searchable:!0,formClearable:!0}),this.state.templateTranslation?b.createElement(b.Fragment,null,b.createElement("div",{className:oi.a.template_text},this.state.templateTranslation.content),Z(0,this.state.templateTranslation.variable_count).map(function(t){return b.createElement("div",{className:oi.a.variable,key:"tr_arg_"+t},b.createElement(Qn,{name:"Variable ".concat(t+1),showLabel:!1,placeholder:"Variable ".concat(t+1),onChange:function(n){e.handleTemplateVariableChanged(n,t)},entry:e.state.templateVariables[t],autocomplete:!0,onFieldFailures:function(n){e.handleTemplateFieldFailures(n,t)}}))})):null)}},{key:"handleAddQuickReply",value:function(e){var t=Object(bt.a)(this.state.quickReplies.value);return!(t.length>=10)&&(!t.find(function(t){return t.toLowerCase()===e.toLowerCase()})&&(t.push(e),this.setState({quickReplies:{value:t}}),!0))}},{key:"handleRemoveQuickReply",value:function(e){this.setState({quickReplies:{value:this.state.quickReplies.value.filter(function(t){return t!==e})}})}},{key:"handleQuickReplyEntry",value:function(e){this.setState({quickReplyEntry:e})}},{key:"render",value:function(){var e=this.props.typeConfig,t=[{name:"Quick Replies",body:b.createElement(b.Fragment,null,b.createElement("p",null,'Quick Replies are made into buttons for supported channels. For example, when asking a question, you might add a Quick Reply for "Yes" and one for "No".'),b.createElement(Sa,{name:"Quick Reply",helpText:"Add a new Quick Reply and press enter.",items:this.state.quickReplies,entry:this.state.quickReplyEntry,onRemoved:this.handleRemoveQuickReply,onItemAdded:this.handleAddQuickReply,onEntryChanged:this.handleQuickReplyEntry,onFieldErrors:this.handleQuickReplyFieldFailures})),checked:this.state.quickReplies.value.length>0,hasErrors:Te(this.state.quickReplyEntry)},{name:"Attachments",body:this.renderAttachments(),checked:this.state.attachments.length>0},{name:"Advanced",body:b.createElement(ha,{name:"All Destinations",title:"All Destinations",labelClassName:oi.a.checkbox,checked:this.state.sendAll,description:"Send a message to all destinations known for this contact. If you aren't sure what this means, leave it unchecked.",onChange:this.handleSendAllUpdate}),checked:this.state.sendAll}];if(this.context.config.showTemplates){var n={name:"WhatsApp",body:this.renderTemplateConfig(),checked:null!=this.state.template.value,hasErrors:!!this.state.templateVariables.find(function(e){return Te(e)})};t.splice(0,0,n)}return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons(),tabs:t},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement(Qn,{name:"Message",showLabel:!1,count:Un.SMS,onChange:this.handleMessageUpdate,entry:this.state.message,autocomplete:!0,focus:!0,textarea:!0,onFieldFailures:this.handleFieldFailures}))}}]),t}(b.Component);ui.contextTypes={config:Be};var ci=function(e){return b.createElement("span",{className:"emph"},e)},di=function(e){var t=e.value,n=e.name;return t?function(e,t){return b.createElement("div",null,"Save ",e," as ",t)}(t,ci(n)):function(e){return b.createElement("div",null,"Clear value for ",e)}(ci(n))},pi=function(e){if(e.originalAction&&e.originalAction.type===ve.set_run_result){var t=e.originalAction;return{name:{value:{id:P(t.name),name:t.name,type:pe.Result}},value:{value:t.value},category:{value:t.category},valid:!0}}return{name:{value:null},value:{value:""},category:{value:""},valid:!1}},hi=n(90),mi=n.n(hi),vi=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=pi(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^on/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleNameUpdate",value:function(e){this.handleUpdate({name:e[0]})}},{key:"handleValueUpdate",value:function(e){return this.handleUpdate({value:e})}},{key:"handleCategoryUpdate",value:function(e){return this.handleUpdate({category:e})}},{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("name")&&(n.name=tn("Name",e.name,[sn(t),hn,un])),e.hasOwnProperty("value")&&(n.value=tn("Value",e.value,[])),e.hasOwnProperty("category")&&(n.category=tn("Category",e.category,[]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){var e,t;this.handleUpdate({name:this.state.name.value},!0)&&(this.props.updateAction((e=this.props.nodeSettings,t=this.state,{type:ve.set_run_result,name:t.name.value.name,value:t.value.value,category:t.category.value,uuid:Oe(e,ve.set_run_result)})),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleCreateAssetFromInput",value:function(e){return{id:P(e),name:e,type:pe.Result}}},{key:"render",value:function(){var e=this,t=this.props.typeConfig,n=!Te(this.state.name)&&this.state.name.value?"."+P(this.state.name.value.name):"";return b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement("div",{className:mi.a.form},b.createElement(zt,{name:"Result",assets:this.props.assetStore.results,entry:this.state.name,searchable:!0,createPrefix:"New: ",onChange:this.handleNameUpdate,createAssetFromInput:this.handleCreateAssetFromInput,formClearable:!0,showLabel:!0,helpText:"The name of the result, used to reference later as @results".concat(n)}),b.createElement(Qn,{__className:mi.a.value,name:"Value",showLabel:!0,onChange:this.handleValueUpdate,entry:this.state.value,onFieldFailures:function(t){var n=Object(_.a)({},e.state.value,{persistantFailures:t});e.setState({value:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,helpText:"The value to save for this result or empty to clears it. You can use expressions, for example: @(title(input))"}),b.createElement(Qn,{__className:mi.a.category,name:"Category",placeholder:"Optional",showLabel:!0,onChange:this.handleCategoryUpdate,entry:this.state.category,autocomplete:!1,helpText:"An optional category for your result. For age, the value might be 17, but the category might be 'Young Adult'"})))}}]),t}(b.PureComponent),fi=function(e,t){var n=e.flow,a=n.name,i=n.uuid;return b.createElement(b.Fragment,null,Ne([{name:a,id:i,type:pe.Flow}],3,t.config.endpoints))};fi.contextTypes={config:Be};var gi=fi,_i=n(91),yi=n.n(_i),bi=function(e,t){var n=Se(e);return b.createElement("div",{className:yi.a.node},b.createElement("div",{className:yi.a.to},Ne(n,3,t.config.endpoints)),b.createElement("div",{className:yi.a.flow},Ne([{name:e.flow.name,id:e.flow.uuid,type:pe.Flow}],3,t.config.endpoints)))};bi.contextTypes={config:Be};var ki=bi,Ci=function(e){if(e.originalAction&&e.originalAction.type===ve.start_session){var t=e.originalAction;return{recipients:{value:Se(t)},flow:{value:{id:t.flow.uuid,name:t.flow.name,type:pe.Flow}},valid:!0}}return{recipients:{value:[]},flow:{value:null},valid:!1}},Ei=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Ci(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleRecipientsChanged",value:function(e){return this.handleUpdate({recipients:e})}},{key:"handleFlowChanged",value:function(e){var t=null;return e&&e.length>0&&(t=e[0]),this.handleUpdate({flow:t})}},{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("recipients")&&(n.recipients=tn("Recipients",e.recipients,[sn(t)])),e.hasOwnProperty("flow")&&(n.flow=tn("Flow",e.flow,[sn(t)]));var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){this.handleUpdate({recipients:this.state.recipients.value,flow:this.state.flow.value},!0)&&(this.props.updateAction(function(e,t){var n=t.flow.value;return{legacy_vars:Re(t.recipients.value),contacts:Ue(t.recipients.value,pe.Contact),groups:Ue(t.recipients.value,pe.Group),flow:{name:n.name,uuid:n.id},type:ve.start_session,uuid:Oe(e,ve.start_session)}}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",null,b.createElement(zt,{name:"Recipients",assets:this.props.assetStore.recipients,completion:this.props.assetStore,entry:this.state.recipients,searchable:!0,multi:!0,onChange:this.handleRecipientsChanged}),b.createElement("p",null),b.createElement(zt,{name:"Flow",placeholder:"Select the flow to start",assets:this.props.assetStore.flows,entry:this.state.flow,searchable:!0,onChange:this.handleFlowChanged})))}}]),t}(b.Component);Ei.contextTypes={endpoints:Be,assetService:Be};var wi,Oi=n(124),Si=n.n(Oi),Ni=function(e){var t=Object.keys(e.amounts).map(function(t){return b.createElement("div",{key:"transfer_"+t},b.createElement("div",{className:Si.a.amount},e.amounts[t]),b.createElement("div",{className:Si.a.code},t))});return b.createElement("div",null,t)},xi=function(e,t){return t?V(e):e},ji=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return t?b.createElement("div",null,"Set ",xi(e,n)," to ",V(t),"."):b.createElement("div",null,"Clear ",xi(e,n),".")},Ti=function(e){switch(e.type){case ve.set_contact_field:return ji(e.field.name,e.value,!0);case ve.set_contact_channel:return ji("channel",e.channel.name);case ve.set_contact_language:return ji("language",e.language);case ve.set_contact_name:return ji("name",e.name)}},Ri=function(e){if(e.ghost){var t=Object.keys(e.inboundConnections);if(t.length>0){var n=t[0];return{exitUUID:n,nodeUUID:e.inboundConnections[n]}}}},Ui=[Ae,Fe,De],Ai=[Ae,Fe],Di=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return!e||function(e){return!!ze.find(function(t){return t===e})}(e)?Ui:Ai};!function(e){e.All_Responses="All Responses",e.No_Response="No Response",e.Any_Value="Any Value",e.Other="Other"}(wi||(wi={}));var Fi=function(e,t,n,a){return{node:{uuid:e,actions:arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],router:t,exits:n},ui:{type:a,position:null,config:arguments.length>5&&void 0!==arguments[5]?arguments[5]:{}},inboundConnections:{}}},Pi=function(e){return!!(e.router&&e.router.cases&&e.router.cases.length)},Ii=function(e,t){var n=function(e){return e.node.router?e.node.router.categories:[]}(t);return e.map(function(e){var a=n.find(function(t){return t.uuid===e.category_uuid});if(Mi(e.type)&&t.ui.config&&t.ui.config.cases){var i=t.ui.config.cases[e.uuid];i&&i.arguments&&(e.arguments=i.arguments)}return{uuid:e.uuid,kase:e,categoryName:a?a.name:null,valid:!0}})},Mi=function(e){return!![fe.has_date_eq,fe.has_date_gt,fe.has_date_lt].find(function(t){return e===t})},Li=function(e,t){return e.name.toLowerCase().trim()===t.categoryName.trim().toLowerCase()},zi=function(e){return e&&e.router&&e.router.type===a.switch?e.router:null},Bi=function(e,t,n){var a=function(e,t){var n=[],a=[],i=[],r={},o=t&&t.router,s=o&&o.categories||[],l=!0,u=!1,c=void 0;try{for(var d,p=function(){var e=d.value;if(!e.categoryName||0===e.categoryName.trim().length)return"continue";Mi(e.kase.type)&&(r[e.uuid]={arguments:e.kase.arguments},e.kase.arguments=["@(datetime_add(today(), ".concat(e.kase.arguments[0],', "D"))')]);var o=n.find(function(t){return Li(t,e)});if(!o){if(!(o=s.find(function(t){return Li(t,e)}))){var l=zi(t);if(l){var u=l.cases.find(function(t){return t.uuid===e.uuid});if(u){var c=s.find(function(e){return e.uuid===u.category_uuid});c&&(o=Object(_.a)({},c,{name:e.categoryName}))}}}if(o){n.push(o);var p=t.exits.find(function(e){return o.exit_uuid===e.uuid});i.push(p)}}if(!o){var h={uuid:$()};i.push(h),o={uuid:$(),name:e.categoryName,exit_uuid:h.uuid},n.push(o)}a.push(Object(_.a)({},e.kase,{category_uuid:o.uuid}))},h=e[Symbol.iterator]();!(l=(d=h.next()).done);l=!0)p()}catch(m){u=!0,c=m}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}return{cases:a,categories:n,exits:i,caseConfig:r}}(e,n),i=function(e,t){var n=zi(t);if(n){var a=n.categories.find(function(e){return e.uuid===n.default_category_uuid}),i=t.exits.find(function(e){return e.uuid===a.exit_uuid});return a.name=e?wi.Other:wi.All_Responses,{defaultCategory:a,defaultExit:i}}var r={uuid:$()};return{defaultCategory:{uuid:$(),name:e?wi.Other:wi.All_Responses,exit_uuid:r.uuid},defaultExit:r}}(a.categories.length>0,n),r=i.defaultCategory,o=i.defaultExit;a.categories.push(r),a.exits.push(o);var s=Object(_.a)({},a,{defaultCategory:r.uuid});if(t){var l=function(e){var t=null,n=null,a=zi(e);if(a&&a.wait&&a.wait.timeout){var i=a.wait.timeout.category_uuid;t=a.categories.find(function(e){return e.uuid===i}),n=e.exits.find(function(e){return e.uuid===t.exit_uuid})}return t||(n={uuid:$()},t={uuid:$(),name:wi.No_Response,exit_uuid:n.uuid}),{timeoutCategory:t,timeoutExit:n}}(n),u=l.timeoutCategory,c=l.timeoutExit;a.categories.push(u),a.exits.push(c),s.timeoutCategory=u.uuid}return s},Vi=function(e,t){var n=[],i=[],r=[];if(t&&1===t.node.actions.length&&t.node.actions[0].type===e.type){var o=zi(t.node);t.node.exits.forEach(function(e){return n.push(e)}),o.cases.forEach(function(e){return i.push(e)}),t.node.router.categories.forEach(function(e){return r.push(e)})}else n.push({uuid:$(),destination_uuid:null},{uuid:$(),destination_uuid:null}),r=[{uuid:$(),name:c.Success,exit_uuid:n[0].uuid},{uuid:$(),name:c.Failure,exit_uuid:n[1].uuid}],i=[{uuid:$(),type:fe.has_only_text,arguments:[c.Success],category_uuid:r[0].uuid}];var s={type:a.switch,operand:"@results."+P(e.result_name)+".category",cases:i,categories:r,default_category_uuid:r[r.length-1].uuid},l=ve.split_by_webhook;return e.type===ve.call_resthook?l=ve.split_by_resthook:e.type===ve.transfer_airtime&&(l=ve.split_by_airtime),Fi(t.node.uuid,s,n,l,[e])},Gi=function(e,t){return e.node.router?e.node.router.categories.filter(function(e){return e.exit_uuid===t.uuid}):[]},qi=function(e){var t=zi(e);if(t&&t.result_name)return t.result_name;if(1===e.actions.length){var n=e.actions[0];if(n.type===ve.call_webhook||n.type===ve.call_resthook||n.type===ve.transfer_airtime)return n.result_name}},Ki=n(12),Wi=function(e){return Ki(e,Y({uuid:$()}))},Yi=function(e,t,n){if(e&&t.results){var a=function(e,t,n){var a=P(e);if(a in t){var i=t[a].references.filter(function(e){return e.nodeUUID!==n.nodeUUID||e.actionUUID!==n.actionUUID});return 0===i.length?Ki(t,{$unset:[a]}):Ki(t,Object(E.a)({},a,{references:{$set:i}}))}var r=a in t?t[a]:{name:e,id:a,type:pe.Result,references:[]};return r.references.find(function(e){return e.nodeUUID===n.nodeUUID&&e.actionUUID===n.actionUUID})||r.references.push(n),Ki(t,{$merge:Object(E.a)({},a,r)})}(e,t.results.items,n);return Ki(t,{results:{items:{$set:a}}})}return t},Hi=function(e,t,n){var a=P(e),i=a in t?t[a]:{name:e,id:a,type:pe.Result,references:[]};return i.references.find(function(e){return e.nodeUUID===n.nodeUUID&&e.actionUUID===n.actionUUID})||i.references.push(n),Ki(t,{$merge:Object(E.a)({},a,i)})},Xi=function(e,t,n,a){var i=e,r=el(e,t);a&&el(e,a);var o=tl(r.node,n),s=r.node.exits[o].destination_uuid;return i=Ki(i,Object(E.a)({},t,{node:{exits:Object(E.a)({},o,{destination_uuid:W(a)})}})),a&&(i=Ki(i,Object(E.a)({},a,{inboundConnections:Y(Object(E.a)({},n,t))}))),null!=s&&(i=Ki(i,Object(E.a)({},s,{inboundConnections:H([[n]])}))),i},Qi=function(e,t){var n=e;n[t.node.uuid]&&(n=Zi(e,t.node.uuid)),n=Ki(e,Y(Object(E.a)({},t.node.uuid,t)));for(var a=0,i=Object.keys(t.inboundConnections);a<i.length;a++){var r=i[a],o=t.inboundConnections[r],s=el(e,o),l=tl(s.node,r);n=Ki(n,Object(E.a)({},o,{node:{exits:Object(E.a)({},l,Y({destination_uuid:t.node.uuid}))}}))}return n},$i=function(e,t,n){var i=e[t],r=function(e){if(e.router.type===a.switch){var t=e.router;return e.exits.find(function(e){return e.uuid===t.default_category_uuid})}}(i.node),o=r?r.destination_uuid:null,s=Zi(e,i.node.uuid,!1),l={node:{uuid:$(),actions:[n],exits:[{uuid:$(),destination_uuid:o}]},ui:{position:i.ui.position,type:ve.execute_actions},inboundConnections:i.inboundConnections};return s=Qi(s,l)},Zi=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=el(e,t),i=e,r=!0,o=!1,s=void 0;try{for(var l,u=a.node.exits[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value;c.destination_uuid&&(i=Ki(i,Object(E.a)({},c.destination_uuid,{inboundConnections:H([c.uuid])})))}}catch(_){o=!0,s=_}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}for(var d=0,p=Object.keys(a.inboundConnections);d<p.length;d++){var h=p[d],m=null;n&&1===a.node.exits.length&&(m=a.node.exits[0].destination_uuid);var v=a.inboundConnections[h],f=el(e,v);if(m)try{il(i,v,m)}catch(y){m=null}var g=tl(f.node,h);i=Ki(i,Object(E.a)({},v,{node:{exits:Object(E.a)({},g,{destination_uuid:W(m)})}})),m&&(el(e,m),i=Ki(i,Object(E.a)({},m,{inboundConnections:Y(Object(E.a)({},h,v))})))}return Ki(i,H([t]))},Ji=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=n.left,r=n.top,o={left:i,top:r};return a&&(o=D(i,r)),Ki(e,Object(E.a)({},t,{ui:{position:W({left:o.left,top:o.top})}}))},er=function(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];e._ui.stickies||(e._ui.stickies={});var i=e._ui.stickies[t].position,r=i.right-i.left,o=i.bottom-i.top,s=n.left,l=n.top,u={left:s,top:l};return a&&(u=D(s,l)),Ki(e,{_ui:{stickies:Object(E.a)({},t,{position:W({left:u.left,top:u.top,right:u.left+r,bottom:u.top+o})})}})},tr=function(e,t,n){return e._ui.stickies||(e._ui.stickies={}),Ki(e,n?{_ui:{stickies:Y(Object(E.a)({},t,n))}}:{_ui:{stickies:H([t])}})},nr=n(187),ar=n.n(nr),ir=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=ps(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^get/,/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};e.hasOwnProperty("type")&&(n.type=e.type),e.hasOwnProperty("name")&&(n.name={value:e.name}),e.hasOwnProperty("channel")&&(n.channel=tn("Channel",e.channel,[sn(t)])),e.hasOwnProperty("language")&&(n.language=tn("Language",e.language,[sn(t)])),e.hasOwnProperty("field")&&(n.field={value:e.field}),e.hasOwnProperty("fieldValue")&&(n.fieldValue={value:e.fieldValue,validationFailures:[]});var a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handlePropertyChange",value:function(e){var t=e[0];if(t.type===pe.ContactProperty)switch(t.id){case o.Name:return this.handleUpdate({field:t,type:ve.set_contact_name,name:""});case o.Language:return this.handleUpdate({field:t,type:ve.set_contact_language});case o.Channel:return this.handleUpdate({field:t,type:ve.set_contact_channel})}return this.handleUpdate({type:ve.set_contact_field,field:t,fieldValue:""})}},{key:"handleChannelUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({channel:e[0]},t)}},{key:"handleLanguageUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({language:e[0]},t)}},{key:"handleFieldValueUpdate",value:function(e){return this.handleUpdate({fieldValue:e,name:""})}},{key:"handleNameUpdate",value:function(e){return this.handleUpdate({name:e,fieldValue:""})}},{key:"onUpdated",value:function(e,t){var n=t().flowContext.assetStore;this.state.field.value.type===pe.Field&&e(Ce(function(e,t,n){var a=cl(n);return Ki(t,Object(E.a)({},e,{items:{$merge:a}}))}("fields",n,[this.state.field.value])))}},{key:"handleFieldAdded",value:function(e){this.props.addAsset("fields",e),this.handlePropertyChange([e])}},{key:"handleSave",value:function(){var e=this.state.valid;this.state.type===ve.set_contact_language&&(e=this.handleLanguageUpdate([this.state.language.value],!0)&&e),this.state.type===ve.set_contact_channel&&(e=this.handleChannelUpdate([this.state.channel.value],!0)&&e),e&&(this.props.updateAction(hs(this.props.nodeSettings,this.state),this.onUpdated),this.props.onClose(!0))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"getValueWidget",value:function(){var e=this;return this.state.type===ve.set_contact_channel?b.createElement(zt,{key:"select_channel",name:"Channel",placeholder:"Select the channel to use for this contact",assets:this.props.assetStore.channels,entry:this.state.channel,searchable:!0,valueClearable:!0,onChange:this.handleChannelUpdate}):this.state.type===ve.set_contact_language?b.createElement(zt,{key:"select_language",name:"Language",placeholder:"Select the language to use for this contact",assets:this.props.assetStore.languages,entry:this.state.language,searchable:!0,valueClearable:!0,onChange:this.handleLanguageUpdate}):this.state.type===ve.set_contact_name?b.createElement(Qn,{name:"Name",placeholder:"Enter a new name for the contact",onFieldFailures:function(t){var n=Object(_.a)({},e.state.name,{persistantFailures:t});e.setState({name:n,valid:e.state.valid&&!Te(n)})},onChange:this.handleNameUpdate,entry:this.state.name,autocomplete:!0,focus:!0}):b.createElement(Qn,{name:"Field Value",placeholder:"Enter a new value for ".concat(this.state.field.value.name),onFieldFailures:function(t){var n=Object(_.a)({},e.state.fieldValue,{persistantFailures:t});e.setState({fieldValue:n,valid:e.state.valid&&!Te(n)})},onChange:this.handleFieldValueUpdate,entry:this.state.fieldValue,autocomplete:!0,focus:!0})}},{key:"handleCreateAssetFromInput",value:function(e){return{label:e,value_type:"text"}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",null,"Select what to update"),b.createElement(zt,{name:"Contact Field",assets:this.props.assetStore.fields,additionalOptions:Di(this.context.config.flowType),entry:this.state.field,searchable:!0,sortFunction:ms,onChange:this.handlePropertyChange,createPrefix:"Create Contact Field: ",createAssetFromInput:this.handleCreateAssetFromInput,onAssetCreated:this.handleFieldAdded}),b.createElement("div",{className:ar.a.value},this.getValueWidget()))}}]),t}(b.Component);ir.contextTypes={assetService:Be,config:Be};var rr=n(56),or=n.n(rr),sr=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleCurrencyChanged",value:function(e){this.props.onChange(this.props.index,{value:{amount:this.props.transfer.value.amount,code:e[0].id},validationFailures:this.props.transfer.validationFailures})}},{key:"handleAmountChanged",value:function(e){var t=[];isNaN(Number(e))&&t.push({message:"Invalid amount, please enter a number"}),this.props.onChange(this.props.index,{value:{amount:e,code:this.props.transfer.value.code},validationFailures:t})}},{key:"render",value:function(){var e=this,t="Transfer Amount",n="",a=null;if(this.props.transfer.value){var i=this.props.transfer.value;i.code&&(t="".concat(i.code," ").concat(t),a={id:i.code}),n=""+i.amount}var r=this.props.index>-1?b.createElement("div",{className:or.a.amount},b.createElement(Qn,{placeholder:t,name:"value",onChange:this.handleAmountChanged,entry:{value:n}})):null,o=this.props.index>-1?b.createElement("div",{className:or.a.remove,onClick:function(){e.props.onRemove(e.props.index)}},b.createElement("span",{className:"fe-x"})):null;return b.createElement(Je,{name:"Currency",entry:this.props.transfer,__className:or.a.form_element},b.createElement("div",{className:or.a.transfer},b.createElement("div",{className:or.a.currency},b.createElement(zt,{styles:Ft,name:"Currency",shouldExclude:function(t){return e.props.exclude.filter(function(e){return e.value.code===t.id}).length>1},assets:this.props.currencies,entry:{value:a},searchable:!0,onChange:this.handleCurrencyChanged})),r," ",o))}}]),t}(b.Component),lr=n(125),ur=n.n(lr),cr=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n.state={editing:n.props.value.value.trim().length>0,valid:!0},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleTextChanged",value:function(e){this.props.onChange(e)}},{key:"handleEditingChanged",value:function(){this.setState({editing:!0})}},{key:"render",value:function(){var e;return e=this.state.editing?b.createElement(Qn,{"data-spec":"optional-field",name:this.props.name,showLabel:!0,entry:this.props.value,onChange:this.handleTextChanged,helpText:this.props.helpText,maxLength:this.props.maxLength}):b.createElement("span",{"data-spec":"toggle-link",className:ur.a.toggle_link,onClick:this.handleEditingChanged},this.props.toggleText),b.createElement("div",{className:ur.a.optional_text_input},e)}}]),t}(b.Component),dr=function(e,t){var n=!Te(e)&&e.value?"."+P(e.value):"";return b.createElement(cr,{name:"Result Name",maxLength:64,value:e,onChange:t,toggleText:"Save as..",helpText:"By naming the result, you can reference it later using @results".concat(n)})},pr=n(126),hr=n.n(pr),mr=function(e){var t=e.validationFailures.map(function(e,t){return b.createElement("div",{key:"validation_"+t,className:hr.a.error},e.message)});return b.createElement("div",{className:hr.a.errors},t)},vr=n(188),fr=n.n(vr),gr=function(e){var t=_r(e),n={value:"Result"},a=!1,i=[];return t&&t.type===ve.transfer_airtime&&(Object.keys(t.amounts).forEach(function(e){i.push({value:{code:e,amount:""+t.amounts[e]}})}),n={value:t.result_name},a=!0),{valid:a,amounts:i,resultName:n}},_r=function(e){var t=e.originalAction||e.originalNode.node.actions.length>0&&e.originalNode.node.actions[0];if(t.type===ve.transfer_airtime)return t},yr=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=gr(e.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleSave",value:function(){var e=[];this.state.amounts.forEach(function(t,n){0===t.value.amount.trim().length&&e.push(n)});var t=!this.state.amounts.find(function(e){return(e.validationFailures||[]).length>0});t&&((t=void 0!==this.state.amounts.find(function(e){return e.value.amount.trim().length>0}))||this.setState({valid:!1,validationFailures:[{message:"At least one amount to transfer is required"}]})),t&&(this.props.updateRouter(function(e,t){var n=$(),a=_r(e);a&&(n=a.uuid);var i={};t.amounts.forEach(function(e){e.value.amount.trim().length>0&&(i[e.value.code]=Number(e.value.amount))});var r={uuid:n,type:ve.transfer_airtime,amounts:i,result_name:t.resultName.value};return Vi(r,e.originalNode)}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[an,hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleRemoved",value:function(e){var t=Yt()(this.state.amounts,{$splice:[[e,1]]});this.setState({amounts:t})}},{key:"handleTransferChanged",value:function(e,t){var n=this.state.amounts;n=e>-1?Yt()(this.state.amounts,{$merge:Object(E.a)({},e,t)}):Yt()(this.state.amounts,{$push:[t]}),this.setState({amounts:n,validationFailures:[]})}},{key:"renderAmount",value:function(e,t){return b.createElement(sr,{key:"currency_"+e,exclude:this.state.amounts,currencies:this.props.assetStore.currencies,transfer:t,index:e,onChange:this.handleTransferChanged,onRemove:this.handleRemoved})}},{key:"renderAmounts",value:function(){var e=this,t=this.state.amounts.map(function(t,n){return e.renderAmount(n,t)});return b.createElement("div",null,t,this.renderAmount(-1,{value:{code:null,amount:""}}))}},{key:"render",value:function(){var e=this.props.typeConfig,t=this.state.validationFailures?b.createElement(mr,{validationFailures:this.state.validationFailures}):null;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),this.renderAmounts(),t,b.createElement("div",{className:fr.a.result_name},dr(this.state.resultName,this.handleUpdateResultName)))}}]),t}(b.PureComponent),br=n(189),kr=n.n(br),Cr=[{type:fe.has_any_word,verboseName:"has any of the words",operands:1,visibility:Le},{type:fe.has_all_words,verboseName:"has all of the words",operands:1,visibility:Le},{type:fe.has_phrase,verboseName:"has the phrase",operands:1,visibility:Le},{type:fe.has_only_phrase,verboseName:"has only the phrase",operands:1,visibility:Le},{type:fe.has_beginning,verboseName:"starts with",operands:1},{type:fe.has_text,verboseName:"has some text",operands:0,categoryName:"Has Text",visibility:Le},{type:fe.has_number,verboseName:"has a number",operands:0,categoryName:"Has Number"},{type:fe.has_number_between,verboseName:"has a number between",operands:2},{type:fe.has_number_lt,verboseName:"has a number below",operands:1},{type:fe.has_number_lte,verboseName:"has a number at or below",operands:1},{type:fe.has_number_eq,verboseName:"has a number equal to",operands:1},{type:fe.has_number_gte,verboseName:"has a number at or above",operands:1},{type:fe.has_number_gt,verboseName:"has a number above",operands:1},{type:fe.has_date,verboseName:"has a date",operands:0,categoryName:"Has Date",visibility:Le},{type:fe.has_date_lt,verboseName:"has a date before",operands:1,visibility:Le},{type:fe.has_date_eq,verboseName:"has a date equal to",operands:1,visibility:Le},{type:fe.has_date_gt,verboseName:"has a date after",operands:1,visibility:Le},{type:fe.has_time,verboseName:"has a time",operands:0,categoryName:"Has Time",visibility:Le},{type:fe.has_group,verboseName:"is in the group",operands:1,visibility:Pe},{type:fe.has_phone,verboseName:"has a phone number",operands:0,categoryName:"Has Phone"},{type:fe.has_email,verboseName:"has an email",operands:0,categoryName:"Has Email",visibility:Le},{type:fe.has_error,verboseName:"has an error",operands:0,categoryName:"Has Error",visibility:Pe},{type:fe.has_value,verboseName:"is not empty",operands:0,categoryName:"Not Empty"},{type:fe.has_pattern,verboseName:"matches regex",operands:1}],Er=Cr.reduce(function(e,t){return e[t.type]=t,e},{}),wr=function(e){return Er[e]},Or=n(30),Sr=n.n(Or),Nr=function(e){return{errors:[],operatorConfig:wr(e.kase.type),argument:{value:e.kase.arguments&&1===e.kase.arguments.length?e.kase.arguments[0]:""},min:{value:e.kase.arguments&&2===e.kase.arguments.length?e.kase.arguments[0]:""},max:{value:e.kase.arguments&&2===e.kase.arguments.length?e.kase.arguments[1]:""},categoryName:{value:e.categoryName||""},categoryNameEdited:!!e.categoryName,valid:!0}},xr=function(e){var t="";return e.indexOf("_lt")>-1?t=e.indexOf("date")>-1?"Before ":e.indexOf("lte")>-1?"<= ":"< ":e.indexOf("_gt")>-1&&(t=e.indexOf("date")>-1?"After ":e.indexOf("gte")>-1?">= ":">"),t},jr=function(e){var t,n,a=e.exitEdited&&e.exitName?[an]:[],i={operatorConfig:e.operatorConfig};if(e.operatorConfig.operands>0){switch(e.operatorConfig.type){case fe.has_number_eq:case fe.has_number_gt:case fe.has_number_gte:case fe.has_number_lt:case fe.has_number_lte:a.push(mn);break;case fe.has_date_eq:case fe.has_date_lt:case fe.has_date_gt:a.push(pn);break;case fe.has_pattern:a.push(rn)}e.operatorConfig.type===fe.has_number_between?(i.min=tn("Minimum value",e.min||"",a.concat([pn,(t=parseFloat(e.max),n="the maximum",function(e,a){return"string"===typeof a&&parseFloat(a)>=t?{value:a,failures:[{message:"".concat(e," must be a less than ").concat(n)}]}:{failures:[],value:a}})])),i.max=tn("Maximum value",e.max||"",a.concat([pn,on(parseFloat(e.min),"the minimum")])),i.argument={value:"",validationFailures:[]}):(i.min={value:"",validationFailures:[]},i.max={value:"",validationFailures:[]},i.argument=tn("Value",e.argument||"",a))}else i.min={value:"",validationFailures:[]},i.max={value:"",validationFailures:[]},i.argument={value:"",validationFailures:[]};return i.categoryNameEdited=!!e.exitEdited,i.categoryName=tn("Category",i.categoryNameEdited?e.exitName:Tr(i),i.argument.value||i.min.value&&i.max.value?[an]:[]),i.valid=0===i.min.validationFailures.length&&0===i.max.validationFailures.length&&0===i.argument.validationFailures.length&&0===i.categoryName.validationFailures.length,i},Tr=function(e){if(e.categoryNameEdited)return e.categoryName.value;if(0===e.operatorConfig.operands)return e.operatorConfig.categoryName;if(e.operatorConfig.type===fe.has_number_between&&e.min.value&&e.max.value)return"".concat(e.min.value," - ").concat(e.max.value);if(Mi(e.operatorConfig.type)){var t=parseInt(e.argument.value,10);if(!isNaN(t)){var n=e.operatorConfig.type===fe.has_date_eq?"Today":"today",a=t<0?" - ":" + ",i=1===Math.abs(t)?" day":" days";return xr(e.operatorConfig.type)+n+a+Math.abs(t)+i}}if(e.argument&&e.argument.value){var r=xr(e.operatorConfig.type),o=e.argument.value.match(/\w+/g);if(o&&o.length>0){var s=Object(C.a)(o,1)[0];return r+I(s)}return r+I(e.argument.value)}return""},Rr=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).operators=void 0,Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^get/]}),n.state=Nr(e),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getOperators",value:function(){var e,t;return void 0===this.operators&&(this.operators=(e=Cr,t=this.context.config.flowType,Bt(e,t))),this.operators}},{key:"getArgumentArray",value:function(){return 0===this.state.operatorConfig.operands?[]:this.state.operatorConfig.type===fe.has_number_between?[this.state.min.value,this.state.max.value]:[this.state.argument.value]}},{key:"handleOperatorChanged",value:function(e){var t=this,n=jr({operatorConfig:e,argument:this.state.argument.value,min:this.state.min.value,max:this.state.max.value,exitName:this.state.categoryName.value,exitEdited:this.state.categoryNameEdited});this.setState(n,function(){return t.handleChange()})}},{key:"handleArgumentChanged",value:function(e){var t=this,n=jr({operatorConfig:this.state.operatorConfig,argument:e,exitName:this.state.categoryName.value,exitEdited:this.state.categoryNameEdited});this.setState(n,function(){return t.handleChange()})}},{key:"handleMinChanged",value:function(e){var t=this,n=jr({operatorConfig:this.state.operatorConfig,min:e,max:this.state.max.value,exitName:this.state.categoryName.value,exitEdited:this.state.categoryNameEdited});this.setState(n,function(){return t.handleChange()})}},{key:"handleMaxChanged",value:function(e){var t=this,n=jr({operatorConfig:this.state.operatorConfig,min:this.state.min.value,max:e,exitName:this.state.categoryName.value,exitEdited:this.state.categoryNameEdited});this.setState(n,function(){return t.handleChange()})}},{key:"handleExitChanged",value:function(e){var t=this,n=jr({operatorConfig:this.state.operatorConfig,argument:this.state.argument.value,min:this.state.min.value,max:this.state.max.value,exitName:e,exitEdited:!0});this.setState(n,function(){return t.handleChange()})}},{key:"handleRemoveClicked",value:function(){this.props.onRemove(this.props.kase.uuid)}},{key:"getCaseProps",value:function(){return{uuid:this.props.kase.uuid,categoryName:this.state.categoryName.value,kase:{arguments:this.getArgumentArray(),type:this.state.operatorConfig.type,uuid:this.props.kase.uuid,category_uuid:this.state.categoryNameEdited?null:this.props.kase.category_uuid},valid:this.state.valid}}},{key:"handleChange",value:function(){this.state.categoryName.value||(this.state.operatorConfig.type===fe.has_number_between?!this.state.min.value&&this.state.max.value:this.state.argument.value),this.props.onChange(this.getCaseProps())}},{key:"renderArguments",value:function(){var e=this;return this.state.operatorConfig.operands>0?this.state.operatorConfig.operands>1?b.createElement(b.Fragment,null,b.createElement(Qn,{name:"arguments",onChange:this.handleMinChanged,entry:this.state.min}),b.createElement("span",{className:Sr.a.divider},"and"),b.createElement(Qn,{name:"arguments",onChange:this.handleMaxChanged,entry:this.state.max})):Mi(this.state.operatorConfig.type)?b.createElement(b.Fragment,null,b.createElement("span",{className:Sr.a.divider},"today + "),b.createElement(Qn,{__className:Sr.a.relative_date,name:"arguments",onChange:this.handleArgumentChanged,entry:this.state.argument,autocomplete:!1}),b.createElement("span",{className:Sr.a.divider},"days")):b.createElement(Qn,{name:"arguments",onChange:this.handleArgumentChanged,entry:this.state.argument,onFieldFailures:function(t){var n=Object(_.a)({},e.state.argument,{persistantFailures:t});e.setState({argument:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0}):null}},{key:"render",value:function(){return b.createElement(Je,{"data-spec":"case-form",name:this.props.name,__className:Sr.a.group,kaseError:this.state.errors.length>0},b.createElement("div",{className:"".concat(Sr.a.kase),"data-draggable":!0},b.createElement("span",{className:"fe-chevrons-expand ".concat(Sr.a.dnd_icon),"data-draggable":!0}),b.createElement("div",{className:Sr.a.choice+" select-medium"},b.createElement(gt.c,{className:M(0),styles:Ft,"data-spec":"operator-list",isClearable:!1,menuPlacement:"auto",options:this.getOperators(),getOptionLabel:function(e){return e.verboseName},getOptionValue:function(e){return e.type},isSearchable:!1,name:"operator",onChange:this.handleOperatorChanged,value:this.state.operatorConfig})),b.createElement("div",{className:this.state.operatorConfig.type===fe.has_number_between?Sr.a.multi_operand:Sr.a.single_operand},this.renderArguments()),b.createElement("div",{className:Sr.a.categorize_as,"data-draggable":!0},"categorize as"),b.createElement("div",{className:Sr.a.category},b.createElement(Qn,{name:"exitName",onChange:this.handleExitChanged,entry:this.state.categoryName,maxLength:36,showInvalid:L(this.state.errors,[/category/])})),b.createElement("span",{"data-testid":"remove-case-"+this.props.kase.uuid,className:"fe-x ".concat(Sr.a.remove_icon),onClick:this.handleRemoveClicked})))}}]),t}(b.Component);Rr.contextTypes={config:Be};var Ur,Ar=function(){var e=$();return{uuid:e,kase:{uuid:e,type:fe.has_any_word,arguments:[""],category_uuid:null},categoryName:"",valid:!0}},Dr=n(127),Fr=n(128),Pr=n.n(Fr);!function(e){e.move="move",e.pointer="pointer"}(Ur||(Ur={}));var Ir=function(e){function t(e){var n,a=this;Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).sortableItem=Object(Dr.SortableElement)(function(e){var t=e.value;return b.createElement("div",{className:Pr.a.kase},b.createElement(Rr,Object.assign({key:t.uuid},t,{onRemove:n.handleRemoveCase,onChange:n.handleUpdateCase})))}),n.sortableList=Object(Dr.SortableContainer)(function(e){var t=e.items;return b.createElement("div",{className:Pr.a.case_list},t.map(function(e,t){return b.createElement(a.sortableItem,{key:"item-".concat(t),index:t,value:e,disabled:t===n.state.currentCases.length-1,shouldCancelStart:function(e){return console.log(e),!0}})}))}),Object(y.react)(Object(f.a)(n),{include:[/^handle/]});var i=n.props.cases;return n.hasEmptyCase(i)||i.push(Ar()),n.state={currentCases:i,valid:!0},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t=this,n={},a=!1;e.hasOwnProperty("caseProps")&&(n.currentCases=[e.caseProps],a=!0,e.caseProps.valid||(n.valid=!1));var i=[];e.hasOwnProperty("removeCase")&&(i=[{currentCases:[e.removeCase]}],a=!0);var r=Ht(this.state,n,i);return this.props.onCasesUpdated(r.currentCases),this.setState(r,function(){a&&(t.hasEmptyCase(t.state.currentCases)||t.handleUpdate({caseProps:Ar()}))}),r.valid}},{key:"hasEmptyCase",value:function(e){return null!=e.find(function(e){return 0===e.categoryName.trim().length})}},{key:"handleRemoveCase",value:function(e){return this.handleUpdate({removeCase:{uuid:e}})}},{key:"handleUpdateCase",value:function(e){return this.handleUpdate({caseProps:e})}},{key:"handleSortEnd",value:function(e){var t=this,n=e.oldIndex,a=e.newIndex;this.setState(function(e){var i=e.currentCases;return{currentCases:kr()(i,n,a===t.state.currentCases.length-1?a-1:a)}},function(){t.props.onCasesUpdated(t.state.currentCases)})}},{key:"render",value:function(){return b.createElement(b.Fragment,null,b.createElement(this.sortableList,{items:this.state.currentCases,onSortEnd:this.handleSortEnd,shouldCancelStart:function(e){return!(e.target instanceof HTMLElement)||!e.target.dataset.draggable}}))}}]),t}(b.Component);Ir.contextTypes={config:Be};var Mr,Lr=n(190),zr=n.n(Lr),Br=function(e){var t=[],n={value:""};if(ds(e.originalNode)===ve.wait_for_digits){var a=e.originalNode.node.router;a&&(Pi(e.originalNode.node)&&(t=Ii(a.cases,e.originalNode)),n={value:a.result_name||""})}return{cases:t,resultName:n,valid:!0}},Vr=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Br(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleCasesUpdated",value:function(e){this.setState({cases:e})}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t){var n=Bi(t.cases,!1,e.originalNode.node),o=n.cases,s=n.exits,l=n.categories,u=n.defaultCategory,c=n.caseConfig,d={};t.resultName.value&&(d.result_name=t.resultName.value);var p=Object(_.a)({type:a.switch,default_category_uuid:u,categories:l,cases:o,operand:"@input",wait:{type:i.msg,hint:{type:r.digits}}},d);return Fi(e.originalNode.node.uuid,p,s,ve.wait_for_response,[],{cases:c})}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",{className:zr.a.lead_in},"If the keypad entry before the # symbol.."),b.createElement(Ir,{"data-spec":"cases",cases:this.state.cases,onCasesUpdated:this.handleCasesUpdated}),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component),Gr='@(json(object(\n  "contact", object(\n    "uuid", contact.uuid, \n    "name", contact.name, \n    "urn", contact.urn\n  ),\n  "flow", object(\n    "uuid", run.flow.uuid, \n    "name", run.flow.name\n  ),\n  "results", results\n)))',qr=function(e){var t=[],n={value:""},a="@input.text";if(e.originalNode&&e.originalNode.ui.type===ve.split_by_expression){var i=e.originalNode.node.router;i&&(Pi(e.originalNode.node)&&(t=Ii(i.cases,e.originalNode)),n={value:i.result_name||""}),a=i.operand}return{cases:t,resultName:n,operand:{value:a},valid:!0}};!function(e){e.args="args",e.min="min",e.max="max",e.exit="exit"}(Mr||(Mr={}));var Kr,Wr=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=qr(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleOperandUpdated",value:function(e){this.setState({operand:tn("Operand",e,[an])})}},{key:"handleCasesUpdated",value:function(e){this.setState({cases:e})}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t){var n=Bi(t.cases,!1,e.originalNode.node),i=n.cases,r=n.exits,o=n.defaultCategory,s=n.caseConfig,l=n.categories,u={};t.resultName.value&&(u.result_name=t.resultName.value);var c=Object(_.a)({type:a.switch,default_category_uuid:o,categories:l,cases:i,operand:t.operand.value},u);return Fi(e.originalNode.node.uuid,c,r,ve.split_by_expression,[],{cases:s})}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",null,"If the expression..."),b.createElement(Qn,{name:"Operand",showLabel:!1,autocomplete:!0,onChange:this.handleOperandUpdated,entry:this.state.operand}),b.createElement(Ir,{"data-spec":"cases",cases:this.state.cases,onCasesUpdated:this.handleCasesUpdated}),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component),Yr=n(129),Hr=n.n(Yr),Xr=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return[].concat(Object(bt.a)(Di(e)),Object(bt.a)(os.map(function(e){return{name:e.name,id:e.scheme,type:pe.Scheme}})))},Qr=function(e,t){var n=[],a={value:""},i=null;if(e.originalNode&&e.originalNode.ui.type===ve.split_by_contact_field){var r=e.originalNode.node.router;r&&(Pi(e.originalNode.node)&&(n=Ii(r.cases,e.originalNode)),a={value:r.result_name||""});var o=e.originalNode.ui.config.operand;if(t.fields&&o.id in t.fields.items){var s=t.fields.items[o.id].name;i={id:o.id,type:o.type,name:s}}i||(i=Xr().find(function(e){return e.id===o.id}))}return i||(i=Ae),{cases:n,resultName:a,field:{value:i},valid:!0}};!function(e){e.args="args",e.min="min",e.max="max",e.exit="exit"}(Kr||(Kr={}));var $r=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Qr(n.props.nodeSettings,n.props.assetStore),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleFieldChanged",value:function(e){this.setState({field:{value:e[0]}})}},{key:"handleCasesUpdated",value:function(e){this.setState({cases:e})}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t){var n=Bi(t.cases,!1,e.originalNode.node),i=n.cases,r=n.exits,o=n.defaultCategory,s=n.caseConfig,l=n.categories,u={};t.resultName.value&&(u.result_name=t.resultName.value);var c="@input.text",d=t.field.value;c=d.type===pe.Scheme?"@(format_urn(urns.".concat(d.id,"))"):d.type===pe.Field?"@contact.fields.".concat(d.id):"@contact.".concat(d.id);var p=Object(_.a)({type:a.switch,default_category_uuid:o,cases:i,categories:l,operand:c},u);return Fi(e.originalNode.node.uuid,p,r,ve.split_by_contact_field,[],{operand:{id:d.id,type:d.type,name:d.name},cases:s})}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",{className:Hr.a.lead_in},"If the contact's",b.createElement("div",{className:"".concat(Hr.a.field_select," select-small")},b.createElement(zt,{name:"Contact Field",styles:Ft,assets:this.props.assetStore.fields,additionalOptions:Xr(this.context.config.flowType),entry:this.state.field,searchable:!0,sortFunction:ms,onChange:this.handleFieldChanged}))),b.createElement(Ir,{"data-spec":"cases",cases:this.state.cases,onCasesUpdated:this.handleCasesUpdated}),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component);$r.contextTypes={assetService:Be,config:Be};var Zr,Jr=function(e){var t={groups:{value:[]},resultName:{value:""},valid:!1};return e.originalNode.ui.type===ve.split_by_groups&&(t.groups.value=eo(e.originalNode.node),t.resultName={value:e.originalNode.node.router.result_name||""},t.valid=!0),t},eo=function(e){var t=[],n=zi(e);return n&&(t=n.cases.map(function(e){return{name:n.categories.find(function(t){return t.uuid===e.category_uuid}).name,id:e.arguments[0],type:pe.Group}})),t},to=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){var t=e.name,n=e.id;return{uuid:n,kase:{uuid:$(),type:fe.has_group,arguments:[n],category_uuid:""},categoryName:t,valid:!0}})},no=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Jr(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleGroupsChanged",value:function(e){this.handleUpdate({groups:e})}},{key:"handleUpdateResultName",value:function(e){this.handleUpdate({resultName:e})}},{key:"handleUpdate",value:function(e){var t={};e.hasOwnProperty("groups")&&(t.groups=tn("Groups",e.groups,[an])),e.hasOwnProperty("resultName")&&(t.resultName={value:e.resultName});var n=Ht(this.state,t);return this.setState(n),n.valid}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t){var n=to(t.groups.value),i=Bi(n,!1,e.originalNode.node),r=i.cases,o=i.exits,s=i.defaultCategory,l=i.caseConfig,u=i.categories,c={type:a.switch,cases:r,categories:u,default_category_uuid:s,operand:"@contact.groups",result_name:t.resultName.value};return Fi(e.originalNode.node.uuid,c,o,ve.split_by_groups,[],{cases:l})}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("p",null,"Select the group(s) you'd like to split by below"),b.createElement(zt,{name:"Groups",assets:this.props.assetStore.groups,entry:this.state.groups,searchable:!0,onChange:this.handleGroupsChanged,multi:!0}),dr(this.state.resultName,this.handleUpdateResultName))}}]),t}(b.Component);no.contextTypes={endpoints:Be,assetService:Be},function(e){e[e.Category=0]="Category",e[e.Case=1]="Case"}(Zr||(Zr={}));var ao=function(e,t){var n=[],a=e.originalNode.node.router.categories;t===Zr.Case&&(a=function(e){var t=e.ui.type;return t===ve.wait_for_response||t===ve.split_by_expression}(e.originalNode)?e.originalNode.node.router.cases:[]);var i=!0,r=!1,o=void 0;try{for(var s,l=function(){var t=s.value,a=e.localizations.filter(function(e){return e.getObject().uuid===t.uuid}),i=Object(C.a)(a,1)[0];i.isLocalized()?n.push(i.getObject()):n.push({uuid:t.uuid})},u=a[Symbol.iterator]();!(i=(s=u.next()).done);i=!0)l()}catch(c){r=!0,o=c}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}return n},io=n(45),ro=n.n(io),oo=function(e){function t(e){var n;Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e));var a=ao(e.nodeSettings,Zr.Category),i=ao(e.nodeSettings,Zr.Case);return n.state={categories:a,cases:i,valid:!0},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t={};e.hasOwnProperty("category")&&(t.categories=[e.category]),e.hasOwnProperty("kase")&&(t.cases=[e.kase]);var n=Ht(this.state,t);return this.setState(n),n.valid}},{key:"handleUpdateCategoryName",value:function(e,t){return e.name=t,this.handleUpdate({category:e})}},{key:"handleUpdateCaseArgument",value:function(e,t){return e.arguments=[t],this.handleUpdate({kase:e})}},{key:"handleSave",value:function(){var e=this.state.categories.map(function(e){return e.name?{uuid:e.uuid,translations:{name:e.name}}:{uuid:e.uuid}});e.push.apply(e,Object(bt.a)(this.state.cases.map(function(e){return e.arguments?{uuid:e.uuid,translations:{arguments:e.arguments}}:{uuid:e.uuid}}))),this.props.updateLocalizations(this.props.language.id,e),this.props.onClose(!1)}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderCases",value:function(){var e=this;return this.state.cases.map(function(t){var n,a,i=(n=e.props.nodeSettings,a=t.uuid,n.originalNode.node.router.cases.find(function(e){return e.uuid===a})),r=wr(i.type).verboseName,o=Object(C.a)(i.arguments,1)[0],s="";return t.arguments&&t.arguments.length>0&&(s=t.arguments[0]),b.createElement("div",{key:"translate_".concat(t.uuid),"data-spec":"operator-field",className:ro.a.translating_operator_container},b.createElement("div",{"data-spec":"verbose-name",className:ro.a.translating_operator},r),b.createElement("div",{"data-spec":"argument-to-translate",className:ro.a.translating_from},o),b.createElement("div",{className:ro.a.translating_to},b.createElement(Qn,{"data-spec":"localize-case",name:t.uuid,placeholder:"".concat(e.props.language.name," Translation"),showLabel:!1,onChange:function(n){return e.handleUpdateCaseArgument(t,n)},entry:{value:s}})))})}},{key:"renderCategories",value:function(){var e=this;return this.state.categories.map(function(t){var n,a,i=(n=e.props.nodeSettings,a=t.uuid,n.originalNode.node.router.categories.find(function(e){return e.uuid===a})),r="".concat(e.props.language.name," Translation");return t.name||(t.name=""),b.createElement("div",{key:t.uuid,className:ro.a.translating_category},b.createElement("div",{"data-spec":"category-name",className:ro.a.translating_from},i.name),b.createElement("div",{className:ro.a.translating_to},b.createElement(Qn,{"data-spec":"localize-category",name:t.name,placeholder:r,showLabel:!1,entry:{value:t.name},onChange:function(n){return e.handleUpdateCategoryName(t,n)}})))})}},{key:"render",value:function(){var e=ba(this.props.nodeSettings),t=[];return this.state.cases.length>0&&t.push({name:"Rule Translations",body:b.createElement(b.Fragment,null,b.createElement("p",{"data-spec":"instructions"},"Sometimes languages need special rules to route things properly. If a translation is not provided, the original rule will be used."),this.renderCases())}),b.createElement(ue,{title:"".concat(this.props.language.name," Category Names"),headerClass:e.type,buttons:this.getButtons(),tabs:t},b.createElement("p",{"data-spec":"instructions"},"When category names are referenced later in the flow, the appropriate language for the category will be used. If no translation is provided, the original text will be used."),this.renderCategories())}}]),t}(b.Component),so=function(e){for(var t={value:""},n=[],a=0;a<10;a++)n.push("");if(ds(e.originalNode)===ve.wait_for_menu){var i=e.originalNode.node.router,r=!0,o=!1,s=void 0;try{for(var l,u=function(){var t=l.value,a=parseInt(t.arguments[0],10)-1;-1===a&&(a=n.length-1),n[a]=e.originalNode.node.router.categories.find(function(e){return e.uuid===t.category_uuid}).name},c=i.cases[Symbol.iterator]();!(r=(l=c.next()).done);r=!0)u()}catch(d){o=!0,s=d}finally{try{r||null==c.return||c.return()}finally{if(o)throw s}}t={value:i.result_name||""}}return{resultName:t,menu:n,valid:!0}},lo=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.map(function(e,n){var a=9===n?0:n+1,i=t.find(function(e){return e.arguments[0]===""+a})||{uuid:$(),arguments:[""+a],type:fe.has_number_eq,category_uuid:""};return{uuid:i.uuid,kase:i,categoryName:e,valid:!0}}).filter(function(e){return e.categoryName.trim().length>0})},uo=n(69),co=n.n(uo),po=n(12),ho=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=so(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleSave",value:function(){this.props.updateRouter(function(e,t){var n={};t.resultName.value&&(n.result_name=t.resultName.value);var o=[];ds(e.originalNode)===ve.wait_for_menu&&(o=e.originalNode.node.router.cases);var s=lo(t.menu,o),l=Bi(s,!1,e.originalNode.node),u=l.cases,c=l.exits,d=l.defaultCategory,p=l.caseConfig,h=l.categories,m=Object(_.a)({type:a.switch,operand:"@input",default_category_uuid:d,cases:u,categories:h,wait:{type:i.msg,hint:{type:r.digits,count:1}}},n);return Fi(e.originalNode.node.uuid,m,c,ve.wait_for_response,[],{cases:p})}(this.props.nodeSettings,this.state)),this.props.onClose(!1)}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleMenuChanged",value:function(e,t){var n=po(this.state.menu,Object(E.a)({},e,{$set:t}));this.setState({menu:n})}},{key:"renderOption",value:function(e){var t=this;return b.createElement("div",{key:"menuoption-"+e,className:co.a.menu_option},b.createElement("div",{className:co.a.digit},9===e?0:e+1),b.createElement("div",{className:co.a.category},b.createElement(Qn,{name:"Menu "+e,entry:{value:this.state.menu[e]},onChange:function(n){t.handleMenuChanged(e,n)}})))}},{key:"renderMenu",value:function(){for(var e=[],t=0;t<10;t++)e.push(this.renderOption(t));return e}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",{className:co.a.menu},this.renderMenu()),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component);ho.contextTypes={assetService:Be};var mo,vo=Z(2,11).map(function(e){return{value:e+"",label:e+" buckets"}}),fo=function(e){var t=vo.find(function(t){return t.value===e+""});return t||(t={label:"".concat(e," Buckets"),value:e+""}),t},go=function(e){var t={value:""},n=2,a=[];e.originalNode&&e.originalNode.ui.type===ve.split_by_random&&(t={value:e.originalNode.node.router.result_name||""},n=e.originalNode.node.exits.length,a=e.originalNode.node.router.categories);return{categories:a=_o(a,n),resultName:t,bucketChoice:{value:fo(n)},valid:!0}},_o=function(e,t){return e.concat(Z(e.length,t).map(function(e){return{uuid:$(),name:"Bucket ".concat(e+1),exit_uuid:null}}))},yo=n(70),bo=n.n(yo);!function(e){e.args="args",e.min="min",e.max="max",e.exit="exit"}(mo||(mo={}));var ko=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=go(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleBucketsChanged",value:function(e){var t=parseInt(e.value,10),n=this.state.categories.concat([]);n=n.slice(0,t),n=_o(n,t);var a={bucketChoice:{value:e}},i=Ht(this.state,a);return this.setState(Object(_.a)({},i,{categories:n})),i.valid}},{key:"handleSave",value:function(){this.props.updateRouter(function(e,t){var n={};t.resultName.value&&(n.result_name=t.resultName.value);var i=e.originalNode.ui.type===ve.split_by_random?e.originalNode.node.exits:[];t.categories.forEach(function(e,t){if(t<i.length)e.exit_uuid=i[t].uuid;else{var n={uuid:$(),destination_uuid:null};e.exit_uuid=n.uuid,i.push(n)}});var r=Object(_.a)({type:a.random,categories:t.categories},n);return Fi(e.originalNode.node.uuid,r,i,ve.split_by_random,[],null)}(this.props.nodeSettings,this.state)),this.props.onClose(!1)}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleBucketNameChanged",value:function(e,t){var n=this.state.categories;n.find(function(t){return t.uuid===e.uuid}).name=t,this.setState({categories:n})}},{key:"renderBucketNames",value:function(){var e=this;return this.state.categories.map(function(t){return b.createElement(Qn,{key:t.uuid,__className:bo.a.bucket_name,"data-spec":"optional-field",name:t.uuid,entry:{value:t.name},onChange:function(n){e.handleBucketNameChanged(t,n)}})})}},{key:"renderEdit",value:function(){var e=this.props.typeConfig,t=vo.concat([]);return-1===vo.indexOf(this.state.bucketChoice.value)&&t.push(this.state.bucketChoice.value),b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",{className:bo.a.lead_in},"Split them randomly into one of"),b.createElement("div",{className:bo.a.bucket_select},b.createElement(wn,{styles:Ft,name:"Buckets",entry:this.state.bucketChoice,onChange:this.handleBucketsChanged,options:t})),b.createElement("div",{className:bo.a.bucket_list},this.renderBucketNames()),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component);ko.contextTypes={assetService:Be};var Co,Eo=function(e){var t=[],n={value:"Result"},a=0;if(e.originalNode&&e.originalNode.ui.type===ve.wait_for_response){var i=e.originalNode.node.router;i&&(Pi(e.originalNode.node)&&(t=Ii(i.cases,e.originalNode)),n={value:i.result_name||""}),e.originalNode.node.router.wait&&e.originalNode.node.router.wait.timeout&&(a=e.originalNode.node.router.wait.timeout.seconds||0)}return{cases:t,resultName:n,timeout:a,valid:!0}},wo=n(71),Oo=n.n(wo),So=[{value:60,label:"1 minute"},{value:120,label:"2 minutes"},{value:180,label:"3 minutes"},{value:240,label:"4 minutes"},{value:300,label:"5 minutes"},{value:600,label:"10 minutes"},{value:900,label:"15 minutes"},{value:3600,label:"1 hours"},{value:7200,label:"2 hours"},{value:10800,label:"3 hours"},{value:21600,label:"6 hours"},{value:43200,label:"12 hours"},{value:64800,label:"18 hours"},{value:86400,label:"1 days"},{value:172800,label:"2 days"},{value:259200,label:"3 days"},{value:604800,label:"1 week"}],No=So[4],xo=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getSelected",value:function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=So.entries()[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value,s=Object(C.a)(o,2),l=s[0];if(s[1].value===e)return So[l]}}catch(u){n=!0,a=u}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}return null}},{key:"isChecked",value:function(){return this.props.timeout>0}},{key:"getInstructions",value:function(){var e="Continue when there is no response";return this.isChecked()?"".concat(e," for"):"".concat(e,"...")}},{key:"handleChecked",value:function(){this.props.timeout>0?this.props.onChanged(0):this.props.onChanged(No.value)}},{key:"handleTimeoutChanged",value:function(e){this.props.onChanged(e.value)}},{key:"render",value:function(){return b.createElement("div",{className:Oo.a.timeout_control_container},b.createElement("div",{className:Oo.a.left_section},b.createElement(ha,{name:"Timeout",checked:this.isChecked(),description:this.getInstructions(),checkboxClassName:Oo.a.checkbox,onChange:this.handleChecked})),G(this.isChecked())(b.createElement("div",{className:Oo.a.drop_down},b.createElement(gt.c,{name:"timeout",menuPlacement:"auto",styles:Ft,isClearable:!1,isSearchable:!1,value:this.getSelected(this.props.timeout),onChange:this.handleTimeoutChanged,options:So}))))}}]),t}(b.Component);!function(e){e.args="args",e.min="min",e.max="max",e.exit="exit"}(Co||(Co={}));var jo=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Eo(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleUpdateTimeout",value:function(e){this.setState({timeout:e})}},{key:"handleCasesUpdated",value:function(e){var t=e.find(function(e){return!e.valid});this.setState({cases:e,valid:!t})}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t){var n=Bi(t.cases,t.timeout>0,e.originalNode.node),r=n.cases,o=n.exits,s=n.defaultCategory,l=n.timeoutCategory,u=n.caseConfig,c=n.categories,d={};t.resultName.value&&(d.result_name=t.resultName.value);var p={type:i.msg};t.timeout>0&&(p.timeout={seconds:t.timeout,category_uuid:l});var h=Object(_.a)({type:a.switch,default_category_uuid:s,cases:r,categories:c,operand:"@input.text",wait:p},d);return Fi(e.originalNode.node.uuid,h,o,ve.wait_for_response,[],{cases:u})}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons(),gutter:b.createElement(xo,{timeout:this.state.timeout,onChanged:this.handleUpdateTimeout})},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",null,"If the message response..."),b.createElement(Ir,{"data-spec":"cases",cases:this.state.cases,onCasesUpdated:this.handleCasesUpdated}),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component),To=function(e){var t={value:null},n={value:"Result"},a=!1,i=Ro(e);if(i&&i.type===ve.call_resthook){var r=i.resthook;t={value:{id:r,name:r,type:pe.Resthook}},n={value:i.result_name},a=!0}return{resthook:t,resultName:n,valid:a}},Ro=function(e){var t=e.originalAction||e.originalNode.node.actions.length>0&&e.originalNode.node.actions[0];if(t.type===ve.call_resthook)return t},Uo=n(191),Ao=n.n(Uo),Do=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=To(e.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[an,hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleResthookChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={resthook:tn("Resthook",e[0],[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){this.handleResthookChanged([this.state.resthook.value],!0)&&(this.props.updateRouter(function(e,t){var n=$(),a=Ro(e);a&&(n=a.uuid);var i={uuid:n,resthook:t.resthook.value.id,type:ve.call_resthook,result_name:t.resultName.value};return Vi(i,e.originalNode)}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement(zt,{name:"Resthook",placeholder:"Select the resthook to call",assets:this.props.assetStore.resthooks,entry:this.state.resthook,searchable:!0,onChange:this.handleResthookChanged}),b.createElement("div",{className:Ao.a.result_name},dr(this.state.resultName,this.handleUpdateResultName)))}}]),t}(b.PureComponent),Fo=[{value:"1",label:"first"},{value:"2",label:"second"},{value:"3",label:"third"},{value:"4",label:"fourth"},{value:"5",label:"fifth"},{value:"6",label:"sixth"},{value:"7",label:"seventh"},{value:"8",label:"eighth"},{value:"9",label:"ninth"}],Po=[{value:" ",label:"spaces"},{value:".",label:"periods"},{value:"+",label:"plusses"}],Io=function(e){return Po.find(function(t){return t.value===e})},Mo=function(e,t){var n=[],a={value:""},i=null,r=1,o=" ",s=!1;if(e.originalNode&&e.originalNode.ui.type===ve.split_by_run_result||e.originalNode.ui.type===ve.split_by_run_result_delimited){var l=e.originalNode.node.router;l&&(Pi(e.originalNode.node)&&(n=Ii(l.cases,e.originalNode)),a={value:l.result_name||""});var u=e.originalNode.ui.config;u&&u.operand&&(i=u.operand.id in t.results.items?t.results.items[u.operand.id]:null),e.originalNode.ui.type===ve.split_by_run_result_delimited&&(r=u.index,o=u.delimiter,s=!0)}return{cases:n,resultName:a,result:{value:i},shouldDelimit:s,fieldNumber:r,delimiter:o,valid:!0}},Lo=n(40),zo=n.n(Lo),Bo=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Mo(n.props.nodeSettings,n.props.assetStore),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleResultChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={result:tn("Result to split on",e[0],[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleCasesUpdated",value:function(e){this.setState({cases:e})}},{key:"handleSave",value:function(){this.handleResultChanged([this.state.result.value],!0)&&(this.props.updateRouter(function(e,t){var n=Bi(t.cases,!1,e.originalNode.node),i=n.cases,r=n.exits,o=n.defaultCategory,s=n.caseConfig,l=n.categories,u={};t.resultName.value&&(u.result_name=t.resultName.value);var c=ve.split_by_run_result,d="@input.text",p=t.result.value;d=p.type===pe.URN?"@(format_urn(contact.urns.".concat(p.id,"))"):p.type===pe.Field?"@contact.fields.".concat(p.id):"@contact.".concat(p.id);var h={operand:{id:p.id,type:p.type,name:p.name},cases:s};t.shouldDelimit&&(h.index=t.fieldNumber,h.delimiter=t.delimiter,c=ve.split_by_run_result_delimited);var m=Object(_.a)({type:a.switch,default_category_uuid:o,categories:l,cases:i,operand:d},u);return Fi(e.originalNode.node.uuid,m,r,c,[],h)}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleShouldDelimitChanged",value:function(e){this.setState({shouldDelimit:e})}},{key:"handleFieldNumberChanged",value:function(e){this.setState({fieldNumber:parseInt(e.value,10)})}},{key:"handleDelimiterChanged",value:function(e){this.setState({delimiter:e.value})}},{key:"renderField",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:zo.a.lead_in},"If the flow result"),b.createElement("div",{className:zo.a.result_select},b.createElement(zt,{entry:this.state.result,styles:Ft,name:"Flow Result",placeholder:"Select Result",searchable:!1,assets:this.props.assetStore.results,onChange:this.handleResultChanged})))}},{key:"renderFieldDelimited",value:function(){return b.createElement(b.Fragment,null,b.createElement("div",{className:zo.a.lead_in},"If the"),b.createElement("div",{className:zo.a.field_number},b.createElement(wn,{styles:Ft,name:"Field Number",entry:{value:(e=this.state.fieldNumber,Fo.find(function(t){return t.value===""+e}))},onChange:this.handleFieldNumberChanged,options:Fo})),b.createElement("div",{className:zo.a.lead_in_sub},"field of"),b.createElement("div",{className:zo.a.result_select_delimited},b.createElement(zt,{entry:this.state.result,styles:Ft,name:"Flow Result",placeholder:"Select Result",searchable:!1,assets:this.props.assetStore.results,onChange:this.handleResultChanged})),b.createElement("div",{className:zo.a.lead_in_sub},"delimited by"),b.createElement("div",{className:zo.a.delimiter},b.createElement(wn,{styles:Ft,name:"Delimiter",entry:{value:Io(this.state.delimiter)},onChange:this.handleDelimiterChanged,options:Po})));var e}},{key:"render",value:function(){var e=this.props.typeConfig,t={name:"Advanced",body:b.createElement("div",{className:zo.a.should_delimit},b.createElement(ha,{name:"Delimit",title:"Delimit Result",checked:this.state.shouldDelimit,description:"Evaluate your rules against a delimited part of your result",onChange:this.handleShouldDelimitChanged})),checked:this.state.shouldDelimit};return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons(),tabs:[t]},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),this.state.shouldDelimit?this.renderFieldDelimited():this.renderField(),b.createElement(Ir,{"data-spec":"cases",cases:this.state.cases,onCasesUpdated:this.handleCasesUpdated}),dr(this.state.resultName,this.handleUpdateResultName))}}]),t}(b.Component),Vo=function(e){if(e.originalNode.ui.type===ve.split_by_subflow){var t=e.originalAction||e.originalNode.node.actions.length>0&&e.originalNode.node.actions[0];return{flow:{value:Go(t.flow)},valid:!0}}return{flow:{value:null},valid:!1}},Go=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{uuid:"",name:""};return{id:e.uuid,name:e.name,type:pe.Flow}},qo=function(e){return{uuid:e.id,name:e.name}},Ko=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Vo(e.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleFlowChanged",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={flow:tn("Flow",e[0],[sn(t)])},a=Ht(this.state,n);return this.setState(a),a.valid}},{key:"handleSave",value:function(){this.handleFlowChanged([this.state.flow.value],!0),this.state.valid&&(this.props.updateRouter(function(e,t){var n,i,r,o={uuid:(e.originalAction||e.originalNode.node.actions.length>0&&e.originalNode.node.actions[0]).uuid||$(),type:ve.enter_flow,flow:qo(t.flow.value)};if(e.originalNode.ui.type===ve.split_by_subflow){n=e.originalNode.node.exits;var s=e.originalNode.node.router;i=s.cases,r=s.categories}else n=[{uuid:$(),destination_uuid:null},{uuid:$(),destination_uuid:null}],r=[{uuid:$(),name:u.Complete,exit_uuid:n[0].uuid},{uuid:$(),name:u.Expired,exit_uuid:n[1].uuid}],i=[{uuid:$(),type:fe.has_only_text,arguments:["completed"],category_uuid:r[0].uuid},{uuid:$(),arguments:["expired"],type:fe.has_only_text,category_uuid:r[1].uuid}];var l={type:a.switch,operand:"@child.run.status",cases:i,categories:r,default_category_uuid:r[r.length-1].uuid};return Fi(e.originalNode.node.uuid,l,n,ve.split_by_subflow,[o])}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"handleFilter",value:function(e){return e.content.type===this.context.config.flowType}},{key:"render",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement(zt,{name:"Flow",placeholder:"Select the flow to start",assets:this.props.assetStore.flows,entry:this.state.flow,searchable:!0,onFilter:this.handleFilter,onChange:this.handleFlowChanged}))}}]),t}(b.PureComponent);Ko.contextTypes={config:Be};var Wo,Yo=function(e){var t={value:"Result"};if(e.originalNode&&e.originalNode.ui.type===ve.wait_for_response){var n=e.originalNode.node.router;n&&(t={value:n.result_name||""})}return{resultName:t,valid:!0}},Ho=n(192),Xo=n.n(Ho),Qo=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=Yo(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleSave",value:function(){this.state.valid&&(this.props.updateRouter(function(e,t,n){var o=Bi([],!1,e.originalNode.node),s=o.exits,l=o.defaultCategory,u=o.caseConfig,c=o.categories,d={};t.resultName.value&&(d.result_name=t.resultName.value);var p={type:i.msg};switch(n.type){case ve.wait_for_audio:p.hint={type:r.audio};break;case ve.wait_for_image:p.hint={type:r.image};break;case ve.wait_for_location:p.hint={type:r.location};break;case ve.wait_for_video:p.hint={type:r.video}}var h=Object(_.a)({type:a.switch,default_category_uuid:l,cases:[],categories:c,wait:p,operand:"@input.text"},d);return Fi(e.originalNode.node.uuid,h,s,ve.wait_for_response,[],{cases:u})}(this.props.nodeSettings,this.state,this.props.typeConfig)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this.props.typeConfig;return b.createElement(ue,{title:e.name,headerClass:e.type,buttons:this.getButtons()},b.createElement(qt,{__className:"",initialType:e,onChange:this.props.onTypeChange}),b.createElement("div",{className:Xo.a.result_name},dr(this.state.resultName,this.handleUpdateResultName)))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component),$o=n(25),Zo=n.n($o),Jo=function(e){function t(e){var n;Object(p.a)(this,t);var a=(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).props.entry.value,i=a.name||"",r=a.value||"";return n.state={name:{value:i},value:{value:r}},Object(y.react)(Object(f.a)(n),{include:[/^on/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getHeader",value:function(){return{name:this.state.name.value,value:this.state.value.value,uuid:this.props.entry.value.uuid}}},{key:"handleChangeName",value:function(e){var t=this,n=tn("Header name",e,[dn]);this.setState({name:{value:n.value}},function(){return t.props.onChange(t.getHeader(),je(t.state.value).concat(je(n)))})}},{key:"handleChangeValue",value:function(e){var t=this;this.setState({value:{value:e}},function(){var e=tn("Header name",t.state.name.value,[dn]);t.props.onChange(t.getHeader(),je(t.state.value).concat(je(e)))})}},{key:"handleRemove",value:function(){this.props.onRemove(this.getHeader())}},{key:"getRemoveIco",value:function(){return b.createElement("div",{className:Zo.a.remove_ico,onClick:this.handleRemove,"data-spec":"remove-icon"},b.createElement("span",{className:"fe-x"}))}},{key:"render",value:function(){var e=this,t=this.getRemoveIco();return b.createElement(Je,{name:"Header",entry:this.props.entry},b.createElement("div",{className:Zo.a.header,"data-spec":"header-container"},b.createElement("div",{className:Zo.a.header_name,"data-spec":"name-container"},b.createElement(Qn,{placeholder:"Header Name",name:"name",onChange:this.handleChangeName,entry:this.state.name})),b.createElement("div",{className:Zo.a.header_value,"data-spec":"value-container"},b.createElement(Qn,{placeholder:"Value",name:"value",onChange:this.handleChangeValue,entry:this.state.value,onFieldFailures:function(t){var n=tn("Header name",e.state.name.value,[dn]);e.props.onChange(e.getHeader(),t.concat(je(n)))},autocomplete:!0})),t))}}]),t}(b.Component);!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT"}(Wo||(Wo={}));var es={value:Wo.GET,label:Wo.GET},ts=[es,{value:Wo.POST,label:Wo.POST},{value:Wo.PUT,label:Wo.PUT}],ns=function(e){var t=e.originalAction||e.originalNode.node.actions.length>0&&e.originalNode.node.actions[0];if(t.type===ve.call_webhook)return t},as=function(e){var t={headers:[],resultName:{value:"Result"},method:{value:es},url:{value:""},postBody:{value:Gr},valid:!1};if(e.originalNode.ui.type===ve.split_by_webhook){var n=ns(e),a=!0,i=!1,r=void 0;try{for(var o,s=Object.keys(n.headers||[]).sort()[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;t.headers.push({value:{uuid:$(),value:n.headers[l],name:l}})}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}t.resultName={value:n.result_name},t.url={value:n.url},t.method={value:{label:n.method,value:n.method}},t.postBody={value:n.body},t.valid=!0}else t.headers.push({value:{uuid:$(),name:"Content-Type",value:"application/json"}});return t.headers.push({value:{uuid:$(),name:"",value:""}}),t},is=n(86),rs=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state=as(n.props.nodeSettings),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a={},i=!1;e.hasOwnProperty("method")&&(a.method={value:e.method},e.method.value!==es.value?this.state.postBody.value||(a.postBody={value:Gr}):a.postBody={value:null}),e.hasOwnProperty("url")&&(a.url=tn("URL",e.url,[sn(n),cn])),e.hasOwnProperty("resultName")&&(a.resultName=tn("Result Name",e.resultName,[sn(n)])),e.hasOwnProperty("postBody")&&(a.postBody={value:e.postBody}),e.hasOwnProperty("header")&&(a.headers=[{value:e.header,validationFailures:e.validationFailures}],i=!0);var r=[];e.hasOwnProperty("removeHeader")&&(r=[{headers:[{value:e.removeHeader}]}],i=!0);var o=Ht(this.state,a,r);return this.setState(o,function(){if(i){var e=!0,n=!0,a=!1,r=void 0;try{for(var o,s=t.state.headers[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){if(""===o.value.value.name.trim()){e=!1;break}}}catch(l){a=!0,r=l}finally{try{n||null==s.return||s.return()}finally{if(a)throw r}}e&&t.handleCreateHeader()}}),o.valid}},{key:"handleUpdateResultName",value:function(e){var t=tn("Result Name",e,[an,hn,un]);this.setState({resultName:t,valid:this.state.valid&&!Te(t)})}},{key:"handleMethodUpdate",value:function(e){return this.handleUpdate({method:e})}},{key:"handleUrlUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.handleUpdate({url:e},t)}},{key:"handleHeaderRemoved",value:function(e){return this.handleUpdate({removeHeader:e})}},{key:"handleHeaderUpdated",value:function(e,t){return this.handleUpdate({header:e,validationFailures:t})}},{key:"handleCreateHeader",value:function(){return this.handleUpdate({header:{uuid:$(),name:"",value:""}})}},{key:"handlePostBodyUpdate",value:function(e){return this.handleUpdate({postBody:e})}},{key:"handleSave",value:function(){this.handleUpdate({url:this.state.url.value,resultName:this.state.resultName.value},!0)&&(this.props.updateRouter(function(e,t){var n={},a=!0,i=!1,r=void 0;try{for(var o,s=t.headers[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;0!==l.value.name.trim().length&&(n[l.value.name]=l.value.value)}}catch(p){i=!0,r=p}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}var u=$(),c=ns(e);c&&(u=c.uuid);var d={uuid:u,headers:n,type:ve.call_webhook,url:t.url.value,method:t.method.value.value,result_name:t.resultName.value};return d.method!==Wo.GET&&(d.body=t.postBody.value),Vi(d,e.originalNode)}(this.props.nodeSettings,this.state)),this.props.onClose(!1))}},{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:this.handleSave},secondary:{name:"Cancel",onClick:function(){return e.props.onClose(!0)}}}}},{key:"renderEdit",value:function(){var e=this,t=this.props.typeConfig,n=this.state.headers.map(function(t,n,a){return b.createElement("div",{key:"header_".concat(t.value.uuid)},b.createElement(Jo,{entry:t,onRemove:e.handleHeaderRemoved,onChange:e.handleHeaderUpdated,index:n}))}),a=[];a.push({name:"HTTP Headers",hasErrors:!!this.state.headers.find(function(e){return Te(e)}),body:b.createElement(b.Fragment,null,b.createElement("p",{className:Zo.a.info},"Add any additional headers below that you would like to send along with your request."),b.createElement(is.a,{easing:"ease-out",enterAnimation:"elevator",leaveAnimation:"elevator",duration:100},n)),checked:this.state.headers.length>1});var i=this.state.method.value.value;return i!==Wo.POST&&i!==Wo.PUT||a.push({name:"POST Body",body:b.createElement("div",{key:"post_body",className:Zo.a.body_form},b.createElement("h4",null,this.state.method.value.label," Body"),b.createElement("p",null,"Modify the body of your ",this.state.method.value.label," request."),b.createElement(Qn,{__className:Zo.a.req_body,name:"Body",showLabel:!1,entry:this.state.postBody,onChange:this.handlePostBodyUpdate,helpText:"Modify the body of the ".concat(this.state.method.value.label," \n                        request that will be sent to your webhook."),onFieldFailures:function(t){var n=Object(_.a)({},e.state.postBody,{persistantFailures:t});e.setState({postBody:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0,textarea:!0})),checked:this.state.postBody.value!==Gr}),b.createElement(ue,{title:t.name,headerClass:t.type,buttons:this.getButtons(),tabs:a},b.createElement(qt,{__className:"",initialType:t,onChange:this.props.onTypeChange}),b.createElement("div",{className:Zo.a.method},b.createElement(wn,{name:"MethodMap",entry:this.state.method,onChange:this.handleMethodUpdate,options:ts})),b.createElement("div",{className:Zo.a.url},b.createElement(Qn,{name:"URL",placeholder:"Enter a URL",entry:this.state.url,onChange:this.handleUrlUpdate,onFieldFailures:function(t){var n=Object(_.a)({},e.state.url,{persistantFailures:t});e.setState({url:n,valid:e.state.valid&&!Te(n)})},autocomplete:!0})),b.createElement("div",{className:Zo.a.instructions},b.createElement("p",null,"If your server responds with JSON, each property will be added to the Flow."),b.createElement("pre",{className:Zo.a.code},'{ "product": "Solar Charging Kit", "stock level": 32 }'),b.createElement("p",null,"This response would add ",b.createElement("span",{className:Zo.a.example},"@webhook.product")," and"," ",b.createElement("span",{className:Zo.a.example},'@webhook["stock level"]')," for use in the flow.")),dr(this.state.resultName,this.handleUpdateResultName))}},{key:"render",value:function(){return this.renderEdit()}}]),t}(b.Component),os=[{scheme:"ext",name:"External ID"},{scheme:"facebook",name:"Facebook ID"},{scheme:"fcm",name:"Firebase ID"},{scheme:"jiochat",name:"Jiochat ID"},{scheme:"line",name:"Line ID"},{scheme:"mailto",name:"Email Address"},{scheme:"tel",name:"Phone Number"},{scheme:"telegram",name:"Telegram ID"},{scheme:"twitterid",name:"Twitter ID"},{scheme:"wechat",name:"Wechat ID"},{scheme:"whatsapp",name:"Whatsapp Number"},{scheme:"viber",name:"Viber ID"}],ss=[{type:ve.missing,name:"Missing",description:" ** Unsupported ** ",component:Ta,visibility:Pe},{type:ve.say_msg,name:"Play Message",description:"Play a message",form:Ba,localization:ja,localizeableKeys:["text","audio_url"],component:La,visibility:Ie},{type:ve.wait_for_menu,name:"Wait for Menu Selection",description:"Wait for menu selection",form:ho,localization:oo,localizeableKeys:["exits"],visibility:Ie},{type:ve.wait_for_digits,name:"Wait for Digits",description:"Wait for multiple digits",form:Vr,localization:oo,localizeableKeys:["exits","cases"],visibility:Ie},{type:ve.send_msg,name:"Send Message",description:"Send the contact a message",form:ui,localization:ja,localizeableKeys:["text","quick_replies"],component:ai},{type:ve.wait_for_response,name:"Wait for Response",description:"Wait for the contact to respond",form:jo,localization:oo,localizeableKeys:["exits","cases"],aliases:[a.switch],visibility:Le},{type:ve.send_broadcast,name:"Send Broadcast",description:"Send somebody else a message",form:Ya,localization:ja,localizeableKeys:["text"],component:Ka},{type:ve.add_input_labels,name:"Add Labels",description:"Label the incoming message",form:gn,component:We},{type:ve.add_contact_urn,name:"Add URN",description:"Add a URN for the contact",form:Jn,component:En},{type:ve.add_contact_groups,name:"Add to Group",description:"Add the contact to a group",form:oa,component:ua},{type:ve.remove_contact_groups,name:"Remove from Group",description:"Remove the contact from a group",form:ga,component:ua},{type:ve.set_contact_field,aliases:[ve.set_contact_name,ve.set_contact_language,ve.set_contact_channel],name:"Update Contact",description:"Update the contact",form:ir,component:Ti},{type:ve.send_email,name:"Send Email",description:"Send an email",form:ei,component:Ha,visibility:ze},{type:ve.set_run_result,name:"Save Flow Result",description:"Save a result for this flow",form:vi,component:di},{type:ve.play_audio,name:"Play Recording",description:"Play a contact recording",form:Aa,component:Ra,visibility:Ie},{type:ve.call_webhook,name:"Call Webhook",description:"Call a webhook",form:rs,localization:oo,localizeableKeys:["exits"],component:ta,aliases:[ve.split_by_webhook],visibility:ze},{type:ve.call_resthook,name:"Call Zapier",description:"Call Zapier",form:Do,localization:oo,localizeableKeys:["exits"],component:ea,aliases:[ve.split_by_resthook],visibility:ze},{type:ve.enter_flow,name:"Enter a Flow",description:"Enter another flow",form:Ko,localization:oo,localizeableKeys:["exits"],component:gi,aliases:[ve.split_by_subflow]},{type:ve.start_session,name:"Start Somebody Else",description:"Start somebody else in a flow",localization:oo,localizeableKeys:["exits"],form:Ei,component:ki,visibility:ze},{type:ve.transfer_airtime,name:"Send Airtime",description:"Send the contact airtime",form:yr,localization:oo,localizeableKeys:["exits"],component:Ni,aliases:[ve.split_by_airtime]},{type:ve.wait_for_audio,name:"Wait for Audio",description:"Wait for an audio recording",form:Qo,localization:oo,localizeableKeys:["exits"],visibility:Me},{type:ve.wait_for_image,name:"Wait for Image",description:"Wait for an image",form:Qo,localization:oo,localizeableKeys:["exits"],visibility:Me},{type:ve.wait_for_video,name:"Wait for Video",description:"Wait for a video",form:Qo,localization:oo,localizeableKeys:["exits"],visibility:Me},{type:ve.wait_for_location,name:"Wait for Location",description:"Wait for location GPS coordinates",form:Qo,localization:oo,localizeableKeys:["exits"],visibility:Me},{type:ve.split_by_expression,name:"Split by Expression",description:"Split by a custom expression",localization:oo,localizeableKeys:["exits","cases"],form:Wr},{type:ve.split_by_contact_field,name:"Split by Contact Field",description:"Split by a contact field",localization:oo,localizeableKeys:["exits","cases"],form:$r},{type:ve.split_by_run_result,aliases:[ve.split_by_run_result_delimited],name:"Split by Flow Result",description:"Split by a result in the flow",localization:oo,localizeableKeys:["exits","cases"],form:Bo},{type:ve.split_by_random,name:"Split Randomly",description:"Split by random chance",localization:oo,localizeableKeys:["exits"],form:ko},{type:ve.split_by_groups,name:"Split by Group Membership",description:"Split by group membership",localization:oo,localizeableKeys:["exits"],form:no}],ls=function(e){var t={};return e.filter(function(e){if("missing"===e.type)return!1;var n=e.name;return!t[n]&&(t[n]=!0)})}(ss),us=ss.reduce(function(e,t){return e[t.type]=t,t.aliases&&t.aliases.forEach(function(n){return e[n]=t}),e},{}),cs=function(e){var t=us[e];return t||(t=us.missing),t},ds=function(e){var t=e.node.router.wait;if(t&&t.hint)switch(t.hint.type){case r.digits:return 1===t.hint.count?ve.wait_for_menu:ve.wait_for_digits;case r.audio:return ve.wait_for_audio;case r.image:return ve.wait_for_image;case r.location:return ve.wait_for_location;case r.video:return ve.wait_for_video}return e.ui.type},ps=function(e){var t={type:ve.set_contact_name,valid:!1,name:{value:""},channel:{value:null},language:{value:null},field:{value:Ae},fieldValue:{value:""}};if(e.originalAction){var n=e.originalAction.type;if(cs(n)===cs(ve.set_contact_field))switch(t.type=n,n){case ve.set_contact_field:var a=e.originalAction;return t.field={value:vs(a.field)},t.fieldValue={value:a.value},t.valid=!0,t;case ve.set_contact_channel:var i=e.originalAction;return t.field={value:De},t.channel={value:bs(i.channel)},t.valid=!0,t;case ve.set_contact_language:var r=e.originalAction;return t.field={value:Fe},t.valid=!0,t.language={value:ys({iso:r.language,name:r.language})},t;case ve.set_contact_name:var o=e.originalAction;return t.valid=!0,t.name={value:o.name},t}}return t},hs=function(e,t){return t.type===ve.set_contact_field?{uuid:Oe(e,ve.set_contact_field),type:t.type,field:fs(t.field.value),value:t.fieldValue.value}:t.type===ve.set_contact_channel?{uuid:Oe(e,ve.set_contact_channel),type:t.type,channel:gs(t.channel.value)}:t.type===ve.set_contact_language?{uuid:Oe(e,ve.set_contact_language),type:t.type,language:_s(t.language.value)}:t.type===ve.set_contact_name?{uuid:Oe(e,ve.set_contact_name),type:t.type,name:t.name.value}:void 0},ms=function(e,t){if(e===Ae&&t!==Ae)return-1;if(t===Ae&&e!==Ae)return 1;if(e.type===t.type)return e.name.localeCompare(t.name);if(e.type===pe.Scheme)return 1;if(e.type!==t.type){if(e.type===pe.ContactProperty)return-1;if(t.type===pe.ContactProperty)return 1}return e.name.localeCompare(t.name)},vs=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{key:"",name:""};return{id:e.key,name:e.name,type:pe.Field}},fs=function(e){return{key:e.id,name:e.name}},gs=function(e){return e.id===ge.id?{}:{uuid:e.id,name:e.name}},_s=function(e){return e.id===ge.id?"":e.id},ys=function(e){var t=e.iso,n=e.name;return t&&0!==t.length?{id:t,name:n,type:pe.Language}:ge},bs=function(e){var t=e.uuid,n=e.name;return t?{id:t,name:n,type:pe.Language}:ge},ks=n(130),Cs=n.n(ks),Es={dragStartTime:0,dragDownPosition:null,dragActive:!1,dragNodeUUID:null,dragGroup:!1,dragSelection:null},ws={containerOffset:{top:0,left:0},currentRevision:null,simulating:!1,translating:!1,language:null,fetchingFlow:!1,dragStartTime:0,dragDownPosition:null,dragActive:!1,dragNodeUUID:null,dragGroup:!1,dragSelection:null,ghostNode:null,debug:null,activity:{segments:{},nodes:{}},liveActivity:{segments:{},nodes:{}},activityInterval:5e3,visible:!0},Os=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ws,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case he.UPDATE_EDITOR_STATE:return t.payload.editorState;default:return e}},Ss=function(){},Ns=null,xs=!1,js=function(e,t,n){return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;Ns&&window.clearTimeout(Ns);var i=n(),r=i.flowContext,o=r.definition,s=r.nodes,l=r.assetStore,u=i.editorState.currentRevision;t(Ts({saving:!0}));var c=ol(o,s,!0);c.revision=u,Ns=xs?window.setTimeout(function(){Ss()},2e3):window.setTimeout(function(){xs=!0,function(e,t){var n=st("csrftoken"),a=n?{"X-CSRFToken":n}:{};return new Promise(function(n,i){it.a.post(e,t,{headers:a}).then(function(e){n(e.data.revision)}).catch(function(e){return i(e)})})}(e,c).then(function(e){o.revision=e.revision,t(be(o));var n=function(e,t){return Ki(e,{revisions:{items:{$merge:Object(E.a)({},t.id,t)}}})}(l,e);t(Ce(n)),t(Ts({currentRevision:e.revision,saving:!1})),xs=!1},function(e){var n=e.response.data,a=n&&n.description||"Hmm, we ran into a problem trying to save your changes. It could just be that your internet connection is not working well at the moment. Perhaps wait a minute or so and try again. It may also be that we encountered a problem we didn't anticipate. If your connection is good and you still can't save your changes, please contact support so we can help you out.";t(Ts({modalMessage:{title:"Uh oh, we couldn't save your changes",body:a},saving:!1})),xs=!1})},a)}},Ts=function(e){return function(t,n){var a=n().editorState,i=Yt()(a,{$merge:e});return t(function(e){return{type:he.UPDATE_EDITOR_STATE,payload:{editorState:e}}}(i)),i}},Rs=function(){return function(e,t){Ss(0)}},Us=function(e,t,n){return function(a,i){i().editorState.fetchingFlow||a(Ts({fetchingFlow:!0})),e.localization=e.localization||{},e._ui=e._ui||{nodes:{},languages:[],stickies:{}};var r=0,o=!0,s=!1,l=void 0;try{for(var u,c=e.nodes[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value;e._ui.nodes[d.uuid]||(e._ui.nodes[d.uuid]={position:{left:0,top:r},type:ul(d)},r+=150)}}catch(v){s=!0,l=v}finally{try{o||null==c.return||c.return()}finally{if(s)throw l}}var p,h,m=dl(e);pl(t.fields.items,m.fields),pl(t.groups.items,m.groups),pl(t.labels.items,m.labels),pl(t.results.items,m.results),e.language&&(p=t.languages.items[e.language]),p||(p=_e,a(Ts({language:_e})),pl(t.languages.items,{base:_e})),a((h=p,{type:he.UPDATE_BASE_LANGUAGE,payload:{baseLanguage:h}})),a(be(function(e){return Ki(e,{nodes:[],_ui:{$merge:{nodes:{}}}})}(e))),a(ke(m.renderNodeMap)),a(Ce(t)),a(Ts({language:p,fetchingFlow:!1})),n&&n()}},As=function(e,t,n){return function(){var a=Object(nt.a)(tt.a.mark(function a(i,r){var o,s,l;return tt.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(i(Ts({fetchingFlow:!0})),o=r(),s=o.flowContext.assetStore,Object.keys(s).length){a.next=6;break}return a.next=5,mt(e);case 5:s=a.sent;case 6:return hl(e.activity,i,r,t),window.triggerActivityUpdate=function(){hl(e.activity,i,r,t)},a.next=10,vt(s.revisions);case 10:l=a.sent,i(Us(l,s,n)),i(Ts({currentRevision:l.revision})),Ss=js(s.revisions.endpoint,i,r);case 14:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}()},Ds=function(e,t){return function(n,a){var i=a().flowContext.assetStore,r=Yt()(i,Object(E.a)({},e,{items:{$merge:Object(E.a)({},t.id,t)}}));n(Ce(r))}},Fs=function(e){return function(t,n){var a=n(),i=a.flowContext.baseLanguage,r=a.editorState,o=r.translating,s=r.language;Cs()(e,i)?t(Ts({translating:!1})):o||t(Ts({translating:!0})),Cs()(e,s)||t(Ts({language:e}))}},Ps=function(e,t){return function(n,a){var i=function(e,t,n){var a=e;return a.localization[t]||(a=Ki(a,{localization:Object(E.a)({},t,W({}))})),n.forEach(function(e){var n=e.translations,i=e.uuid;if(n){for(var r={},o=0,s=Object.keys(n);o<s.length;o++){var l=s[o],u=n[l];Array.isArray(u)?r[l]=u:r[l]=[u]}a=Ki(a,{localization:Object(E.a)({},t,Object(E.a)({},i,W(r)))})}else a=Ki(a,{localization:Object(E.a)({},t,H([i]))})}),a}(a().flowContext.definition,e,t);return n(be(i)),Ss(),i}},Is=function(e,t,n){return function(a,i){var r=i().flowContext.nodes,o=Xi(r,e,t,n);return a(ke(o)),Ss(),o}},Ms=function(e,t){return function(n,a){return n(Is(e,t,null))}},Ls=function(e,t){return function(n,a){var i=e.split(":"),r=Object(C.a)(i,2),o=r[0],s=r[1];return n(Is(o,s,t))}},zs=function(e){return function(t,n){var a=n().flowContext,i=a.nodes,r=a.assetStore;if(e.router&&e.router.result_name){var o=Yi(e.router.result_name,r,{nodeUUID:e.uuid});t(Ce(o))}var s=Zi(i,e.uuid);return t(ke(s)),Ss(),s}},Bs=function(e,t){return function(n,a){var i=a().flowContext,r=i.nodes,o=i.assetStore,s=r[e];if(t.type===ve.set_run_result){var l=Yi(t.name,o,{nodeUUID:e,actionUUID:t.uuid});n(Ce(l))}if(1===s.node.actions.length){var u=n(zs(s.node));return Ss(),u}var c=function(e,t,n){var a=el(e,t),i=nl(a.node,n);return Ki(e,Object(E.a)({},t,{node:{actions:Q([[i,1]])}}))}(r,e,t.uuid);return n(ke(c)),Ss(),c}},Vs=function(e,t){return function(n,a){var i=function(e,t,n){var a=el(e,t),i=a.node.actions,r=nl(a.node,n);if(0===r)throw new Error("Cannot move an action at the top upwards");var o=i[r],s=i[r-1];return Ki(e,Object(E.a)({},t,{node:{actions:Q([[r-1,2,o,s]])}}))}(a().flowContext.nodes,e,t.uuid);return n(ke(i)),Ss(),i}},Gs=function(e){return function(t){t(function(e){return{type:he.UPDATE_TYPE_CONFIG,payload:{typeConfig:e}}}(e))}},qs=function(){return function(e,t){e(Ts({ghostNode:null})),e(Qt(null))}},Ks=function(e,t){return function(n,a){K("onUpdateAction");var i=a(),r=i.nodeEditor,o=r.userAddingAction,s=r.settings,l=i.flowContext,u=l.nodes,c=l.contactFields,d=l.assetStore;if(null==s||null==s.originalNode)throw new Error("Need originalNode in settings to update an action");var p=s.originalNode,h=s.originalAction,m=d;if(h&&h.type===ve.set_run_result){var v=h.name;m=Yi(v,m,{nodeUUID:p.node.uuid,actionUUID:e.uuid})}var f=u,g=null;if(!(null===p||!p.ghost)){var y={node:{uuid:$(),actions:[e],exits:[{uuid:$(),destination_uuid:null}]},ui:{position:p.ui.position,type:ve.execute_actions},inboundConnections:p.inboundConnections};f=Qi(u,y),g=y.node.uuid}else g=p.node.uuid,f=o?function(e,t,n){return el(e,t),Ki(e,Object(E.a)({},t,{node:{actions:X([n])}}))}(u,p.node.uuid,e):p.node.hasOwnProperty("router")?$i(u,p.node.uuid,e):function(e,t,n,a){var i=el(e,t),r=a?nl(i.node,a.uuid):0;return Ki(e,Object(E.a)({},t,{node:{actions:Object(E.a)({},r,W(n))}}))}(u,p.node.uuid,e,h);(n(ke(f)),n($t(!1)),e.type===ve.set_run_result)&&(m=function(e,t,n){if(e){var a=Hi(e,t.results.items,n);return Ki(t,{results:{items:{$set:a}}})}}(e.name,m,{nodeUUID:g,actionUUID:e.uuid}),n(Ce(m)));if(e.type===ve.set_contact_field){var b=e.field;n(function(e){return{type:he.UPDATE_CONTACT_FIELDS,payload:{contactFields:e}}}(Object(_.a)({},c,Object(E.a)({},b.key,b.name))))}return Ss(),t&&t(n,a),f}},Ws=function(e){return function(t,n){var a=n().flowContext.nodes,i={uuid:$(),type:ve.send_msg,text:""};t(Qt({originalNode:el(a,e.uuid),originalAction:i,showAdvanced:!1})),Ss(),t($t(!0)),t(Gs(cs(ve.send_msg))),t(Ts(Es))}},Ys=function(e){return function(t,n){var a=n().flowContext,i=a.nodes,r=a.definition,o=i,s=r,l=!1,u=!1;return e.forEach(function(e){e in o?(o=Zi(o,e,!0),l=!0):e in s._ui.stickies&&(s=tr(s,e,null),u=!0)}),l&&t(ke(o)),u&&t(be(s)),(u||l)&&Ss(),i}},Hs=function(e){return function(t,n){var a=n().flowContext,i=a.nodes,r=a.definition,o=i,s=!1,l=!1;for(var u in e)o[u]?(o=Ji(o,u,e[u]),s=!0):r._ui.stickies[u]&&(r=er(r,u,e[u]),l=!0);var c=!1;return s&&(c=!0,t(ke(o))),l&&(c=!0,t(be(r))),c&&Ss(),o}},Xs=function(e,t){return function(n,a){for(var i=a().flowContext,r=i.nodes,o=i.assetStore,s=e.sourceId.split(":"),l=Object(C.a)(s,2),u=l[0],c=l[1],d=r[u],p=Object.keys(o.results?o.results.items:{}),h=p.length+1,m="result_".concat(h),v=p.find(function(e){return e===m});v;)m="result_".concat(++h);var f=ll(d,c,h,t);f.inboundConnections=Object(E.a)({},c,u),n(Ts({ghostNode:f}))}},Qs=function(e,t){return function(n,a){var i=a().flowContext.definition,r=tr(i,e,t);n(be(r)),Ss()}},$s=function(e){return function(t,n){var a,i,r=n(),o=r.flowContext,s=o.nodes,l=o.assetStore,u=r.nodeEditor.settings,c=u.originalNode,d=u.originalAction,p=s;if(c){var h=c.ui.position;e.ui.position=h}if(c.ghost){e.inboundConnections=c.inboundConnections;var m=c.ui.position,v=m.left,f=m.top;e.ui.position={left:v,top:f},e.node=Wi(e.node)}if(qi(e.node)){var g=l,y=qi(c.node);y&&(g=Yi(y,g,{nodeUUID:c.node.uuid})),g=function(e,t){var n=e;n||(n={results:{items:{},type:pe.Result}}),n.results||(n.results={items:{},type:pe.Result});var a=qi(t);if(a){var i=Hi(a,e.results.items,{nodeUUID:t.uuid});return Ki(e,{results:{items:{$set:i}}})}return e}(g,e.node),t(Ce(g))}if(c&&d&&!c.ghost&&!zi(c.node)){var b=c.node.actions.find(function(e){return e.uuid===d.uuid});if(b)return e.ui.position.top=c.ui.position.top,t((a=e,i={nodeUUID:c.node.uuid,actionUUID:b.uuid},function(e,t){var n=t().flowContext.nodes,r=n[i.nodeUUID],o=n;o=Zi(o,r.node.uuid,!1),a.node=Wi(a.node);var s,l,u=nl(r.node,i.actionUUID),c=u>0?Object(bt.a)(r.node.actions.slice(0,u)):[],d=r.node.actions.slice(u+1,r.node.actions.length),p=r.ui.position,h=p.left,m=p.top;return c.length>0?(s={node:{uuid:$(),actions:c,exits:[{uuid:$(),destination_uuid:null}]},ui:{position:{left:h,top:m}},inboundConnections:Object(_.a)({},r.inboundConnections)},o=Qi(o,s),m+=U,a.inboundConnections=Object(E.a)({},s.node.exits[0].uuid,s.node.uuid),a.ui.position.top+=U):a.inboundConnections=Object(_.a)({},r.inboundConnections),o=Qi(o,a),d.length>0?(l={node:{uuid:$(),actions:d,exits:[{uuid:$(),destination_uuid:r.node.exits[0].destination_uuid}]},ui:{position:{left:h,top:m}},inboundConnections:Object(E.a)({},a.node.exits[0].uuid,a.node.uuid)},o=Qi(o,l)):o=Xi(o,a.node.uuid,a.node.exits[0].uuid,r.node.exits[0].destination_uuid),e(ke(o)),Ss(),o}));var k=zi(e.node);if(k){var C=k.categories.find(function(e){return e.uuid===k.default_category_uuid});e.node.exits.find(function(e){return e.uuid===C.exit_uuid}).destination_uuid=c.node.exits[0].destination_uuid}e.inboundConnections=Object(E.a)({},c.node.exits[0].uuid,c.node.uuid),e.node=Wi(e.node),e.ui.position.top+=U,p=Qi(p,e)}else p=Qi(p,e);return t(ke(p)),Ss(),p}},Zs=function(e){return function(t,n){var a=n(),i=a.flowContext.definition.localization,r=a.editorState,o=r.language,s=r.translating,l=e.originalNode,u=e.originalAction,c=l.node;if(e.localizations=[],s){var d,p=u;if(!p&&c.actions.length>0&&(p=c.actions[c.actions.length-1]).type!==ve.send_msg&&p.type!==ve.send_broadcast)return;var h=i[o.id];(d=e.localizations).push.apply(d,Object(bt.a)(rl(c,p,o,h)))}!u&&c.actions.length>0&&(u=c.actions[c.actions.length-1]);var m=ba(e);t(Gs(m)),t(Qt(e)),t(Ts(Es))}},Js=null,el=function(e,t){var n=e[t];if(!n)throw new Error("Cannot find node "+t);return n},tl=function(e,t){var n=!0,a=!1,i=void 0;try{for(var r,o=e.exits.entries()[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,l=Object(C.a)(s,2),u=l[0];if(l[1].uuid===t)return u}}catch(c){a=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}throw new Error("Cannot find exit "+t)},nl=function(e,t){var n=!0,a=!1,i=void 0;try{for(var r,o=e.actions.entries()[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value,l=Object(C.a)(s,2),u=l[0];if(l[1].uuid===t)return u}}catch(c){a=!0,i=c}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}throw new Error("Cannot find action "+t)},al=function(e){return function(e){return!(!e.node.router||!e.node.router.wait)}(e)||e.ui.type===ve.split_by_expression||e.ui.type===ve.split_by_subflow},il=function e(t,n,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=t[n],o=t[a];if(n===a)throw new Error("Flow loop detected, can't point to self");if(!al(o)&&!al(r))if(0!==i.length){if(a===i[0])throw new Error("Flow loop detected, route through a wait first");i.push(a);var s=!0,l=!1,u=void 0;try{for(var c,d=o.node.exits[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var p=c.value;p.destination_uuid&&e(t,a,p.destination_uuid,i)}}catch(y){l=!0,u=y}finally{try{s||null==d.return||d.return()}finally{if(l)throw u}}}else{i.push(n);var h=!0,m=!1,v=void 0;try{for(var f,g=o.node.exits[Symbol.iterator]();!(h=(f=g.next()).done);h=!0){var _=f.value;_.destination_uuid&&e(t,o.node.uuid,_.destination_uuid,i)}}catch(y){m=!0,v=y}finally{try{h||null==g.return||g.return()}finally{if(m)throw v}}}},rl=function(e,t,n,i){var r=[];e.router&&e.router.type===a.switch&&e.router.cases.forEach(function(e){return r.push(S.translate(e,n,i))});return t&&r.push(S.translate(t,n,i)),e.router&&e.router.categories.forEach(function(e){e.name&&r.push(S.translate(e,n,i))}),r},ol=function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=sl(t),i=[];a.forEach(function(e){return i.push(e.node)});for(var r={},o=0,s=Object.keys(t);o<s.length;o++){var l=s[o];r[l]=t[l].ui}var u=Object(_.a)({},e,{nodes:i});return n&&(u._ui={nodes:r,stickies:e._ui.stickies,languages:e._ui.languages}),u},sl=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(e[n])}),t.sort(function(e,t){var n=e.ui.position.top-t.ui.position.top;return 0===n&&(n=e.ui.position.left-t.ui.position.left),n})},ll=function(e,t,n,o){var s,l,u={uuid:$(),actions:[],exits:[{uuid:$(),destination_uuid:null}]},c=ve.execute_actions;if(!e||(l=e)&&l.node.router){var d=o===me.VOICE?ve.say_msg:ve.send_msg,p={uuid:$(),text:"",type:d};u.actions.push(p)}else{var h=[{uuid:$(),name:wi.All_Responses,exit_uuid:u.exits[0].uuid}],m={type:i.msg};c=ve.wait_for_response,o===me.VOICE&&(m.hint={type:r.digits,count:1}),u.router={type:a.switch,result_name:(s=n,"Result ".concat(s)),default_category_uuid:h[0].uuid,categories:h,wait:m,cases:[]}}var v={};return e&&(v=Object(E.a)({},t,e.node.uuid)),{node:u,ui:{position:{left:0,top:0},type:c},inboundConnections:v,ghost:!0}},ul=function(e){if(e.router){if(1===e.actions.length){if(e.actions[0].type===ve.call_webhook)return ve.split_by_webhook;if(e.actions[0].type===ve.transfer_airtime)return ve.split_by_airtime;if(e.actions[0].type===ve.call_resthook)return ve.split_by_resthook;if(e.actions[0].type===ve.enter_flow)return ve.split_by_subflow}if(e.router.wait)return ve.wait_for_response;if(e.router.type===a.random)return ve.split_by_random;var t=zi(e);return t&&"@contact.groups"===t.operand?ve.split_by_groups:ve.split_by_expression}return ve.execute_actions},cl=function(e){var t={},n=!0,a=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;t[s.id]=s}}catch(l){a=!0,i=l}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}return t},dl=function(e){var t,n=e.nodes,a=e._ui,i={},r={},o={},s={},l={},u={},c=!0,d=!1,p=void 0;try{for(var h,m=n[Symbol.iterator]();!(c=(h=m.next()).done);c=!0){var v=h.value;v.actions||(v.actions=[]);var f=a.nodes[v.uuid];i[v.uuid]={node:v,ui:f,inboundConnections:{}};var g=qi(v);if(g&&(u=Hi(g,u,{nodeUUID:v.uuid})),f.type===ve.split_by_groups){var _=zi(v),y=!0,b=!1,k=void 0;try{for(var C,E=function(){var e=C.value,t=e.arguments[0],n=_.categories.find(function(t){return t.uuid===e.category_uuid});n&&(o[t]={name:n.name,id:t,type:pe.Group})},w=_.cases[Symbol.iterator]();!(y=(C=w.next()).done);y=!0)E()}catch(ie){b=!0,k=ie}finally{try{y||null==w.return||w.return()}finally{if(b)throw k}}}var O=!0,S=!1,N=void 0;try{for(var x,j=v.actions[Symbol.iterator]();!(O=(x=j.next()).done);O=!0){var T=x.value;if((t=T.type)===ve.add_contact_groups||t===ve.remove_contact_groups||t===ve.send_broadcast){var R=T.groups;if(R){var U=!0,A=!1,D=void 0;try{for(var F,I=R[Symbol.iterator]();!(U=(F=I.next()).done);U=!0){var M=F.value;o[M.uuid]={name:M.name,id:M.uuid,type:pe.Group}}}catch(ie){A=!0,D=ie}finally{try{U||null==I.return||I.return()}finally{if(A)throw D}}}}else if(T.type===ve.set_contact_field){var L=T;s[L.field.key]={name:L.field.name,id:L.field.key,type:pe.Field}}else if(T.type===ve.add_input_labels){var z=!0,B=!1,V=void 0;try{for(var G,q=T.labels[Symbol.iterator]();!(z=(G=q.next()).done);z=!0){var K=G.value;l[K.uuid]={name:K.name,id:K.uuid,type:pe.Label}}}catch(ie){B=!0,V=ie}finally{try{z||null==q.return||q.return()}finally{if(B)throw V}}}else if(T.type===ve.set_run_result){var W=T,Y=P(W.name);Y in u?u[Y].references.push({nodeUUID:v.uuid,actionUUID:T.uuid}):u[Y]={name:W.name,id:Y,type:pe.Result,references:[{nodeUUID:v.uuid,actionUUID:T.uuid}]}}}}catch(ie){S=!0,N=ie}finally{try{O||null==j.return||j.return()}finally{if(S)throw N}}var H=!0,X=!1,Q=void 0;try{for(var $,Z=v.exits[Symbol.iterator]();!(H=($=Z.next()).done);H=!0){var J=$.value;if(J.destination_uuid){var ee=r[J.destination_uuid];ee||(ee={}),ee[J.uuid]=v.uuid,r[J.destination_uuid]=ee}}}catch(ie){X=!0,Q=ie}finally{try{H||null==Z.return||Z.return()}finally{if(X)throw Q}}}}catch(ie){d=!0,p=ie}finally{try{c||null==m.return||m.return()}finally{if(d)throw p}}for(var te=0,ne=Object.keys(r);te<ne.length;te++){var ae=ne[te];i[ae].inboundConnections=r[ae]}return{renderNodeMap:i,groups:o,fields:s,labels:l,results:u}},pl=function(e,t){Object.keys(t).forEach(function(n){e[n]=e[n]||t[n]})},hl=function e(t,n,a,i){var r=a().editorState,o=r.simulating,s=r.activityInterval;r.visible?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise(function(a,i){return it.a.get("".concat(e,"?flow=").concat(t),{headers:n}).then(function(e){return a(e.data)}).catch(function(e){return i(e)})})}(t,i).then(function(r){if(r){var l={liveActivity:r,activityInterval:Math.min(3e5,s+200)};o||(l.activity=r),n(Ts(l)),Js&&window.clearTimeout(Js),Js=window.setTimeout(function(){e(t,n,a,i)},s)}}):(Js&&window.clearTimeout(Js),Js=window.setTimeout(function(){e(t,n,a,i)},1e3))},ml=n(131),vl=n.n(ml),fl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,Object(y.react)(Object(f.a)(n),{include:[/^handle/,"ref"]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"ref",value:function(e){return this.ele=e}},{key:"componentDidMount",value:function(){this.ele&&this.props.updateDimensions&&this.props.updateDimensions(this.props.uuid,{width:this.ele.clientWidth||this.props.position.right-this.props.position.left,height:this.ele.clientHeight||this.props.position.bottom-this.props.position.top})}},{key:"componentDidUpdate",value:function(e){this.ele&&this.ele.clientWidth&&this.ele.clientHeight&&this.props.updateDimensions&&this.props.updateDimensions(this.props.uuid,{width:this.ele.clientWidth,height:this.ele.clientHeight})}},{key:"render",value:function(){var e=this,t=[vl.a.draggable];this.props.selected&&t.push(vl.a.selected);return b.createElement("div",{"data-testid":"draggable_"+this.props.uuid,onTransitionEnd:function(){e.props.onAnimated&&e.props.onAnimated(e.props.uuid)},ref:this.ref,className:t.join(" "),style:{left:this.props.position.left,top:this.props.position.top},onMouseDown:function(t){var n,a;3!==t.nativeEvent.which&&(e.props.onDragStart&&e.props.onDragStart(e.props.uuid,(n=t.pageX-e.props.position.left,a=t.pageY-e.props.position.top,{left:n,top:a})))},onMouseUp:function(t){3!==t.nativeEvent.which&&e.props.onDragStop&&e.props.onDragStop()}},this.props.ele(this.props.selected))}}]),t}(b.PureComponent),gl=n(12),_l=function(e,t,n){return!(!e.bottom||!t.bottom)&&(e.bottom+=n,!(t.left>e.right||t.right<e.left||t.top>e.bottom||t.bottom<e.top))},yl=function(e,t,n){for(var a=function(e){var t=[];return Object.keys(e).forEach(function(n){t.push(Object(_.a)({},e[n],{uuid:n}))}),t.sort(function(e,t){var n=e.top-t.top;return 0===n&&(n=e.left-t.left),n})}(e),i=function(e){var i=a[e];if(e+1<a.length)for(var r=function(e){var r=a[e];if(_l(i,r,n)){if(e+1<a.length){var o=a[e+1];if(_l(r,o,n))return{v:{v:[i,r,o]}}}return t.find(function(e){return r.uuid===e})&&!t.find(function(e){return i.uuid===e})?{v:{v:[r,i]}}:{v:{v:[i,r]}}}},o=e+1;o<a.length;o++){var s=r(o);if("object"===typeof s)return s.v}},r=0;r<a.length;r++){var o=i(r);if("object"===typeof o)return o.v}return[]},bl=function(e,t){return F({top:t,left:e.left,bottom:t+(e.bottom-e.top),right:e.right})},kl=n(92),Cl=n.n(kl),El=300,wl=function(e){function t(e){var n;Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,n.parentOffset=void 0,n.isScrolling=void 0,n.reflowTimeout=void 0,n.lastX=void 0,n.lastY=void 0,n.justSelected=!1;var a=document.documentElement.clientHeight,i={};return n.props.draggables.forEach(function(e){i[e.uuid]=e.position,e.position.bottom&&(a=Math.max(a,e.position.bottom+El))}),n.state={height:a,dragDownPosition:null,dragUUID:null,dragGroup:!1,dragSelection:null,uuid:n.props.uuid,selected:{},positions:i},Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^render/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleWindowResize",value:function(){var e=document.documentElement.clientHeight;this.setState({height:Math.max(e,this.state.height)})}},{key:"componentDidMount",value:function(){var e={left:0,top:0};this.ele&&(e=this.ele.getBoundingClientRect()),this.parentOffset={left:e.left,top:e.top+window.scrollY},window.addEventListener("resize",this.handleWindowResize),document.addEventListener("keydown",this.handleKeyDown)}},{key:"handleKeyDown",value:function(e){this.state.selected&&"Backspace"===e.key&&(Object.keys(this.state.selected).length>0&&this.props.onRemoveNodes(Object.keys(this.state.selected)))}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(e){var t=this,n=!1,a=this.state.positions;this.props.draggables.forEach(function(e){t.state.positions[e.uuid]||(a=Yt()(a,{$merge:Object(E.a)({},e.uuid,e.position)}),n=!0)}),Object.keys(a).forEach(function(e){t.props.draggables.find(function(t){return t.uuid===e})||(a=Yt()(a,{$unset:[[e]]}),n=!0)}),n&&this.setState({positions:a})}},{key:"renderSelectionBox",value:function(){var e=this.state.dragSelection;if(e&&e.startX&&e.startY&&e.currentX&&e.currentY){var t=Math.min(e.startX,e.currentX),n=Math.min(e.startY,e.currentY),a=Math.max(e.startX,e.currentX)-t,i=Math.max(e.startY,e.currentY)-n;if(this.state.dragSelection&&this.state.dragSelection.startX)return k.a.createElement("div",{className:Cl.a.drag_selection,style:{left:t,top:n,width:a,height:i}})}return null}},{key:"isClickOnCanvas",value:function(e){return 3!==e.nativeEvent.which&&e.target.id===this.state.uuid}},{key:"handleMouseDown",value:function(e){3!==e.nativeEvent.which&&(this.justSelected=!1,this.isClickOnCanvas(e)&&this.setState({dragSelection:{startX:e.pageX-this.parentOffset.left,startY:e.pageY-this.parentOffset.top,currentX:e.pageX-this.parentOffset.left,currentY:e.pageY-this.parentOffset.top}}))}},{key:"handleMouseMove",value:function(e){if(this.props.draggingNew)return this.lastX=e.pageX,this.lastY=e.pageY,void this.updateStateWithScroll(e.clientY,e.pageY);if(this.state.dragSelection&&this.state.dragSelection.startX){var t=this.state.dragSelection;if(t&&t.startX&&t.startY&&t.currentX&&t.currentY){var n=Math.min(t.startX,t.currentX),a=Math.min(t.startY,t.currentY),i=Math.max(t.startX,t.currentX),r=Math.max(t.startY,t.currentY),o=function(e,t){for(var n={},a=0,i=Object.keys(e);a<i.length;a++){var r=i[a],o=e[r];_l(t,o,0)&&(n[r]=o)}return n}(this.state.positions,{left:n,top:a,right:i,bottom:r});this.setState({dragSelection:{startX:t.startX,startY:t.startY,currentX:e.pageX-this.parentOffset.left,currentY:e.pageY-this.parentOffset.top}}),this.setState({selected:o}),Object.keys(o).length>0&&(this.justSelected=!0)}}this.state.dragUUID&&this.updatePositions(e.pageX,e.pageY,e.clientY,!1)}},{key:"scrollCanvas",value:function(e){var t=this;if(!this.isScrolling){this.isScrolling=!0;var n=e;window.scrollY+e<0&&(n=0),this.isScrolling=window.setInterval(function(){t.lastX&&t.lastY&&(t.updatePositions(t.lastX,t.lastY+n,0,!1),window.scrollBy(0,n))},30)}}},{key:"handleMouseUpCapture",value:function(e){3!==e.nativeEvent.which&&(this.lastX=null,this.lastY=null,this.state.dragUUID&&this.setState({dragDownPosition:null,dragSelection:null,dragUUID:null}),this.justSelected||(this.props.mergeEditorState({dragActive:!1}),this.setState({selected:{}})),this.state.dragSelection&&this.state.dragSelection.startX&&this.setState({dragSelection:{startX:void 0,startY:void 0,currentX:void 0,currentY:void 0}}),this.justSelected=!1)}},{key:"handleUpdateDimensions",value:function(e,t){var n=this.state.positions[e];n||(n=this.props.draggables.find(function(t){return t.uuid===e}).position);var a={left:n.left,top:n.top,right:n.left+t.width,bottom:n.top+t.height};a.bottom===n.bottom&&a.right===n.right||a.right===n.right&&a.bottom===n.bottom||(this.setState(function(t){return{positions:Yt()(t.positions,{$merge:Object(E.a)({},e,a)}),height:Math.max(a.bottom+El,t.height)}}),this.markReflow())}},{key:"doReflow",value:function(){var e=function(e,t){var n=e,a=[],i=0;K("reflow");for(var r=yl(e,a,t);r.length>0&&i<100;){if(i++,r.length){var o=r,s=Object(C.a)(o,3),l=s[0],u=s[1],c=s[2];if(n=gl(n,Object(E.a)({},u.uuid,W(bl(u,l.bottom+U)))),a.push(u.uuid),c){var d=l.bottom+U;d+=u.bottom-u.top,n=gl(n,Object(E.a)({},c.uuid,W(bl(c,d)))),a.push(c.uuid)}}r=yl(n,a,t)}return{positions:n,changed:a}}(this.state.positions,5),t=e.positions,n=e.changed;n&&(this.setState({positions:t}),n&&this.props.onUpdatePositions(n.reduce(function(e,n){return e[n]=t[n],e},{}))),this.props.onDragging(n)}},{key:"markReflow",value:function(){var e=this;this.reflowTimeout&&clearTimeout(this.reflowTimeout),this.reflowTimeout=setTimeout(function(){e.state.dragUUID||e.doReflow()},200)}},{key:"updateStateWithScroll",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=document.documentElement.clientHeight;this.setState(function(e){return Object(_.a)({},a,{height:Math.max(t+El,e.height)})},function(){n.isScrolling||0===e?0!==e&&e>100&&e+100<i&&(window.clearInterval(n.isScrolling),n.isScrolling=null):e+100>i?n.scrollCanvas(15):e<100&&n.scrollCanvas(-15)})}},{key:"updatePositions",value:function(e,t,n,a){if(this.state.dragUUID){var i=this.state.dragUUID;this.lastX=e,this.lastY=t;var r=this.props.dragActive?this.state.selected[i]:this.state.positions[i];if(this.state.dragDownPosition){var o=e-this.parentOffset.left-this.state.dragDownPosition.left-r.left,s=t-this.parentOffset.top-this.state.dragDownPosition.top-r.top,l=0;if(this.props.dragActive){var u={left:o,top:s},c=this.state,d=Object.keys(c.selected),p=c.positions;d.forEach(function(e){var t=function(e,t){var n=e.right-e.left,a=e.bottom-e.top,i=e.top+t.top,r=e.left+t.left;return n&&a?{left:r,top:i,right:r+n,bottom:i+a}:{top:i,left:r}}(c.selected[e],u);a&&(t=F(t)),t&&t.bottom>l&&(l=t.bottom),p=Yt()(p,{$merge:Object(E.a)({},e,t)})}),this.props.onDragging(d),this.updateStateWithScroll(n,l,{positions:p})}else if(Math.abs(o)+Math.abs(s)>Vu){var h=this.state.selected;this.state.dragUUID in h||(h=Object(E.a)({},i,this.state.positions[i])),this.props.mergeEditorState({dragActive:!0}),this.setState({selected:h})}}}}},{key:"handleDragStart",value:function(e,t){this.setState({dragUUID:e,dragDownPosition:{left:t.left-this.parentOffset.left,top:t.top-this.parentOffset.top}})}},{key:"getSelectedPositions",value:function(){var e=this;return Object.keys(this.state.selected).reduce(function(t,n){return t[n]=e.state.positions[n],t},{})}},{key:"handleDragStop",value:function(){this.state.dragUUID&&this.updatePositions(this.lastX,this.lastY,0,!0),this.props.onUpdatePositions(this.getSelectedPositions()),this.setState({dragUUID:null,dragDownPosition:null,dragSelection:null}),this.markReflow(),this.props.mergeEditorState({dragActive:!1})}},{key:"render",value:function(){var e=this;return k.a.createElement("div",{className:Cl.a.canvas_container},k.a.createElement("div",{"data-testid":"canvas",style:{height:this.state.height},id:this.state.uuid,ref:function(t){e.ele=t},className:Cl.a.canvas,onMouseDown:this.handleMouseDown,onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUpCapture},this.props.draggables.map(function(t){var n=e.state.positions[t.uuid]||t.position;return k.a.createElement(fl,{onAnimated:function(t){e.props.onDragging([t])},key:"draggable_"+t.uuid,uuid:t.uuid,updateDimensions:e.handleUpdateDimensions,position:n,selected:!!e.state.selected[t.uuid],ele:t.ele,onDragStart:e.handleDragStart,onDragStop:e.handleDragStop})}),this.props.children,this.renderSelectionBox()))}}]),t}(k.a.PureComponent),Ol=n(93),Sl=n.n(Ol),Nl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,Object(y.react)(Object(f.a)(n),{include:[/^handle/,/^get/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.handleScrollIntoView()}},{key:"componentDidUpdate",value:function(e){e.count!==this.props.count&&this.handleScrollIntoView()}},{key:"handleScrollIntoView",value:function(){var e=this;this.ele&&this.props.count>0&&this.props.keepVisible&&window.setTimeout(function(){window.scrollTo({top:e.ele.getBoundingClientRect().top-200+window.scrollY,behavior:"smooth"})},200)}},{key:"handleMouseEvent",value:function(e,t){e.preventDefault(),e.stopPropagation(),t&&t()}},{key:"handleMouseEnter",value:function(e){this.handleMouseEvent(e,this.props.onMouseEnter)}},{key:"handleMouseLeave",value:function(e){this.handleMouseEvent(e,this.props.onMouseLeave)}},{key:"handleClick",value:function(e){this.handleMouseEvent(e,this.props.onClick)}},{key:"render",value:function(){var e=this,t=this.props.count.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return b.createElement("div",{ref:function(t){e.ele=t},className:Sl.a.counter+" "+this.props.containerStyle+" "+(this.props.onClick?Sl.a.clickable:"")+" "+(this.props.count>0?Sl.a.visible:""),onClick:this.handleClick,"data-spec":"counter-outter"},b.createElement("div",{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,className:this.props.countStyle,"data-spec":"counter-inner"},t))}}]),t}(b.Component),xl=n(46),jl=n.n(xl),Tl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).confirmationTimeout=void 0,n.state={confirmingRemoval:!1},n.handleConfirmRemoval=n.handleConfirmRemoval.bind(Object(f.a)(n)),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentWillUnmount",value:function(){this.confirmationTimeout&&window.clearTimeout(this.confirmationTimeout)}},{key:"handleMouseUpCapture",value:function(e){e&&(e.preventDefault(),e.stopPropagation())}},{key:"handleConfirmRemoval",value:function(e){var t=this;e&&(e.preventDefault(),e.stopPropagation()),this.setState({confirmingRemoval:!0}),this.confirmationTimeout=window.setTimeout(function(){return t.setState({confirmingRemoval:!1})},2e3)}},{key:"getMoveArrow",value:function(){return this.props.showMove?b.createElement("div",Object.assign({className:jl.a.up_button},z(this.props.onMoveUp,this.props.shouldCancelClick,this.handleMouseUpCapture),{"data-testid":"move-icon"}),b.createElement("span",{className:"fe-arrow-up"})):b.createElement("div",{className:jl.a.up_button,"data-spec":"move"})}},{key:"getRemove",value:function(){var e=null;return this.props.showRemoval&&(e=b.createElement("div",Object.assign({className:jl.a.remove_button},z(this.handleConfirmRemoval,this.props.shouldCancelClick,this.handleMouseUpCapture),{"data-testid":"remove-icon"}),b.createElement("span",{className:"fe-x"}))),e}},{key:"getConfirmationEl",value:function(){var e;return this.state.confirmingRemoval&&(e=b.createElement("div",{className:jl.a.remove_confirm,"data-spec":"confirmation"},b.createElement("div",Object.assign({className:jl.a.remove_button},z(this.props.onRemoval,this.props.shouldCancelClick,this.handleMouseUpCapture),{"data-testid":"confirm-removal"}),b.createElement("span",{className:"fe-x"})),"Remove?")),e}},{key:"render",value:function(){var e=this.getConfirmationEl(),t=this.getMoveArrow(),n=this.getRemove();return b.createElement("div",{className:jl.a.titlebar,"data-spec":"titlebar-container"},b.createElement("div",{className:"".concat(this.props.__className," ").concat(jl.a.normal),"data-spec":"titlebar"},t,n,this.props.title),e)}}]),t}(b.Component),Rl=Xe.a.bind(Object(_.a)({},re.a,ya.a)),Ul=function(e){function t(e,n){var a;return Object(p.a)(this,t),a=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(a),{include:[/^on/,/^handle/]}),a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleActionClicked",value:function(e){var t=e.target,n=t&&t.attributes&&"true"===t.getAttribute("data-advanced");this.props.onOpenNodeEditor({originalNode:this.props.renderNode,originalAction:this.props.action,showAdvanced:n})}},{key:"handleRemoval",value:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.removeAction(this.props.renderNode.node.uuid,this.props.action)}},{key:"handleMoveUp",value:function(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.moveActionUp(this.props.renderNode.node.uuid,this.props.action)}},{key:"getAction",value:function(){return this.props.translating?B(this.props.action,this.props.localization,this.props.language).getObject():this.props.action}},{key:"getClasses",value:function(){var e,t=[],n=!1;if(this.props.translating&&(this.props.action.type!==ve.send_msg&&this.props.action.type!==ve.send_broadcast&&this.props.action.type!==ve.say_msg||t.push("text"),0!==t.length)){var a=B(this.props.action,this.props.localization,this.props.language);if(a.isLocalized())for(var i=0,r=t;i<r.length;i++){if(!(r[i]in a.localizedKeys)){n=!0;break}}else n=!0}var o=this.props.translating&&0===t.length;return Rl((e={},Object(E.a)(e,ya.a.action,!0),Object(E.a)(e,ya.a.has_router,this.props.renderNode.node.hasOwnProperty("router")&&null!==this.props.renderNode.node.router),Object(E.a)(e,ya.a.translating,this.props.translating),Object(E.a)(e,ya.a.not_localizable,o),Object(E.a)(e,ya.a.missing_localization,n),Object(E.a)(e,ya.a.localized,!o&&!n),e))}},{key:"render",value:function(){var e=this,t=cs(this.props.action.type).name,n=this.getClasses(),a=this.getAction(),i=re.a[this.props.action.type]||re.a.missing,r=ya.a[this.props.action.type]||ya.a.missing,o=!this.props.translating,s=!this.props.first&&!this.props.translating;return b.createElement("div",{id:"action-".concat(this.props.action.uuid),className:n,"data-spec":"action-container"},b.createElement("div",{className:ya.a.overlay,"data-spec":"action-overlay"}),b.createElement("div",Object.assign({},z(this.handleActionClicked,function(){return e.props.selected}),{"data-spec":"interactive-div"}),b.createElement(Tl,{__className:i,title:t,onRemoval:this.handleRemoval,showRemoval:o,showMove:s,onMoveUp:this.handleMoveUp,shouldCancelClick:function(){return e.props.selected}}),b.createElement("div",{className:ya.a.body+" "+r,"data-spec":"action-body"},this.props.render(a,this.context.config.endpoints))))}}]),t}(b.Component);Ul.contextTypes={config:Be};var Al=Object(Bn.b)(function(e){var t=e.flowContext.definition.localization,n=e.editorState;return{language:n.language,translating:n.translating,localization:t}},function(e){return Object(de.bindActionCreators)({onOpenNodeEditor:Zs,removeAction:Bs,moveActionUp:Vs},e)})(Ul),Dl=n(47),Fl=n.n(Dl),Pl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={visible:!1},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){var e=this;window.setTimeout(function(){e.state.visible||e.setState({visible:!0})},100)}},{key:"render",value:function(){return b.createElement("div",{className:Fl.a.drag_helper+" "+(this.state.visible?Fl.a.visible:"")},b.createElement("div",{className:Fl.a.arrow},b.createElement("div",{className:Fl.a.tail}),b.createElement("div",{className:Fl.a.head})),b.createElement("div",{className:Fl.a.help_text},"To connect nodes, ",b.createElement("span",{className:Fl.a.bold},"drag")," from the red circle."))}}]),t}(b.Component),Il=function(e){return e.uuid+":"+e.destination_uuid},Ml=n(193),Ll=n.n(Ml),zl=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},Bl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={color:zl(e.color)},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e=this;return b.createElement("div",{className:Ll.a.loading,style:{width:this.props.size*this.props.units*2,height:this.props.size}},Z(0,this.props.units).map(function(t){return b.createElement("div",{key:"ball_".concat(t),style:{borderRadius:e.props.square?"0":"50%",width:e.props.size,height:e.props.size,margin:e.props.size/3,animationDelay:"-".concat(1-t*(1/e.props.units),"s"),background:"rgba(".concat(e.state.color.r,",").concat(e.state.color.g,",").concat(e.state.color.b,", ").concat(1-t*(1/e.props.units),")")}})}))}}]),t}(b.Component),Vl=n(20),Gl=n.n(Vl),ql=Xe.a.bind(Gl.a),Kl=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).timeout=void 0,n.hideDragHelper=void 0,n.pendingMessageFetch={},n.ele=void 0,n.state={confirmDelete:!1,recentMessages:null,fetchingRecentMessages:!1,showDragHelper:e.showDragHelper},Object(y.react)(Object(f.a)(n),{include:[/^on/,/^get/,/^handle/,/^connect/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getSourceId",value:function(){return"".concat(this.props.node.uuid,":").concat(this.props.exit.uuid)}},{key:"handleDisconnect",value:function(){this.setState({showDragHelper:!1})}},{key:"componentDidMount",value:function(){this.props.plumberMakeSource(this.getSourceId()),this.ele&&this.ele.addEventListener("disconnect",this.handleDisconnect),this.props.exit.destination_uuid&&this.connect()}},{key:"componentDidUpdate",value:function(e){this.props.exit.destination_uuid&&this.props.exit.destination_uuid===e.exit.destination_uuid||(this.connect(),this.state.confirmDelete&&this.setState({confirmDelete:!1})),this.props.plumberUpdateClass(this.props.node,this.props.exit,"confirm-delete",this.state.confirmDelete)}},{key:"componentWillUnmount",value:function(){this.props.exit.destination_uuid&&this.props.plumberRemove(this.getSourceId()),this.ele&&this.ele.removeEventListener("disconnect",this.handleDisconnect)}},{key:"handleMouseDown",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"handleClick",value:function(e){var t=this;this.props.translating||(this.props.exit.destination_uuid?(e.preventDefault(),e.stopPropagation(),this.setState({confirmDelete:!0},function(){t.timeout=window.setTimeout(function(){t.setState({confirmDelete:!1})},2e3)})):(e.preventDefault(),e.stopPropagation(),this.state.showDragHelper||this.setState({showDragHelper:!0},function(){t.hideDragHelper&&window.clearTimeout(t.hideDragHelper),t.hideDragHelper=window.setTimeout(function(){t.setState({showDragHelper:!1})},3e3)})))}},{key:"onDisconnect",value:function(e){this.timeout&&window.clearTimeout(this.timeout),this.hideDragHelper&&window.clearTimeout(this.hideDragHelper),this.props.disconnectExit(this.props.node.uuid,this.props.exit.uuid)}},{key:"connect",value:function(){this.props.plumberConnectExit(this.props.node,this.props.exit)}},{key:"handleShowRecentMessages",value:function(){var e=this;this.props.recentMessages?this.setState({recentMessages:this.props.recentMessages}):this.setState({fetchingRecentMessages:!0},function(){var t,n,a;(t=e.context.config.endpoints.recents,n=e.props.exit,a=e.pendingMessageFetch,new Promise(function(e,i){return a.reject=i,it.a.get("".concat(t,"?exits=").concat(n.uuid,"&to=").concat(n.destination_uuid)).then(function(t){var n=[],a=!0,i=!1,r=void 0;try{for(var o,s=t.data[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;n.push({text:l.text,sent:new Date(l.sent)})}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}e(t.data)}).catch(function(e){return i(e)})})).then(function(t){e.setState({recentMessages:t,fetchingRecentMessages:!1})}).catch(function(){})})}},{key:"handleHideRecentMessages",value:function(){this.pendingMessageFetch.reject&&(this.pendingMessageFetch.reject(),this.pendingMessageFetch={}),this.setState({fetchingRecentMessages:!1,recentMessages:null})}},{key:"getSegmentCount",value:function(){if(this.props.exit.destination_uuid){var e="count:".concat(this.props.exit.uuid,":").concat(this.props.exit.destination_uuid);return b.createElement("div",{style:{position:"relative"}},b.createElement(Nl,{key:e,count:this.props.segmentCount,containerStyle:Gl.a.activity,countStyle:Gl.a.count,keepVisible:!1,onMouseEnter:this.handleShowRecentMessages,onMouseLeave:this.handleHideRecentMessages}),this.getRecentMessages())}return null}},{key:"getName",value:function(){var e=this;if(this.props.translating){var t="",n="",a=!1;return this.props.categories.forEach(function(i){var r=B(i,e.props.localization,e.props.language);a=a||"name"in r.localizedKeys;var o=r.getObject();t+=n+o.name,n=", "}),{name:t,localized:a}}return{name:this.props.categories.map(function(e){return e.name}).join(", ")}}},{key:"getRecentMessages",value:function(){if(this.state.fetchingRecentMessages||null!==this.state.recentMessages){var e=this.state.recentMessages||[],t=0!==e.length,n=[Gl.a.recent_messages],a="Recent Messages";return t||this.state.fetchingRecentMessages||(a="No Recent Messages",n.push(Gl.a.no_recents)),b.createElement("div",{className:n.join(" ")},b.createElement("div",{className:Gl.a.title},a),e.map(function(e,t){return b.createElement("div",{key:"recent_"+t,className:Gl.a.message},b.createElement("div",{className:Gl.a.text},e.text),b.createElement("div",{className:Gl.a.sent},e.sent.toLocaleString()))}),null===this.state.recentMessages?b.createElement("div",{className:Gl.a.loading},b.createElement(Bl,{size:10,units:6,color:"#999999"})):null)}return null}},{key:"render",value:function(){var e,t=this,n=this.getName(),a=n.name,i=n.localized,r=a?Gl.a.name:"",o=this.props.exit.destination_uuid?" jtk-connected":"",s=ql(Gl.a.endpoint,o),l=this.state.confirmDelete&&this.props.exit.hasOwnProperty("destination_uuid"),u=l?b.createElement("div",Object.assign({className:Gl.a.confirm_x+" fe-x"},z(this.onDisconnect,function(){return t.props.dragging}))):null,c=ql((e={},Object(E.a)(e,Gl.a.exit,!0),Object(E.a)(e,"plumb-exit",!0),Object(E.a)(e,Gl.a.translating,this.props.translating),Object(E.a)(e,Gl.a.unnamed_exit,null==a),Object(E.a)(e,Gl.a.missing_localization,a&&this.props.translating&&!i),Object(E.a)(e,Gl.a.confirm_delete,l),e)),d=this.getSegmentCount();return b.createElement("div",{className:c},a?b.createElement("div",{className:r},a):null,b.createElement("div",Object.assign({ref:function(e){return t.ele=e}},z(this.handleClick,function(){return t.props.dragging},this.handleMouseDown),{id:"".concat(this.props.node.uuid,":").concat(this.props.exit.uuid),className:s}),u),d,G(this.state.showDragHelper)(b.createElement(Pl,null)))}}]),t}(b.PureComponent);Kl.contextTypes={config:Be};var Wl=Object(Bn.b)(function(e,t){var n=e.flowContext.definition.localization,a=e.editorState,i=a.translating,r=a.language,o=a.dragActive,s=a.activity,l=null,u=Il(t.exit);return u in(s.recentMessages||{})&&(l=s.recentMessages[u]),{dragging:o,segmentCount:s.segments[Il(t.exit)]||0,translating:i,language:r,localization:n,recentMessages:l}},function(e){return Object(de.bindActionCreators)({disconnectExit:Ms},e)})(Kl),Yl=n(23),Hl=n.n(Yl),Xl=Xe.a.bind(Object(_.a)({},re.a,Hl.a)),Ql=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).ele=void 0,n.firstAction=void 0,n.clicking=void 0,n.events=void 0,Object(y.react)(Object(f.a)(n),{include:[/Ref$/,/^on/,/^get/,/^handle/]}),n.events=z(n.onClick,n.handleShouldCancelClick),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleShouldCancelClick",value:function(){return this.props.selected}},{key:"eleRef",value:function(e){return this.ele=e}},{key:"getGhostListener",value:function(){var e=this;return function(t){var n=e.ele.getBoundingClientRect().width,a=t.pageX-n/2-15,i=t.pageY+e.ele.scrollTop-(e.props.containerOffset.top+20),r=e.ele.style;r.left=a+"px",r.top=i+"px",r.visibility=document.querySelector(".plumb-drop-hover")?"hidden":"visible"}}},{key:"componentDidMount",value:function(){if(this.props.plumberMakeTarget(this.props.renderNode.node.uuid),this.props.ghost){var e=this.getGhostListener();window.ghostListener=e,document.addEventListener("mousemove",e)}}},{key:"componentDidUpdate",value:function(e){if(!this.props.ghost)try{this.props.plumberRecalculate(this.props.renderNode.node.uuid);var t=!0,n=!1,a=void 0;try{for(var i,r=this.props.renderNode.node.exits[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;this.props.plumberRecalculate(this.props.renderNode.node.uuid+":"+o.uuid)}}catch(s){n=!0,a=s}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}catch(l){}}},{key:"componentWillUnmount",value:function(){this.props.plumberRemove(this.props.renderNode.node.uuid)}},{key:"handleUUIDClicked",value:function(e){var t=window.getSelection(),n=document.createRange();n.selectNodeContents(e.currentTarget),t.removeAllRanges(),t.addRange(n),document.execCommand("copy"),t.removeAllRanges(),console.log(e.currentTarget.textContent+" copied to clipboard.")}},{key:"handleAddToNode",value:function(){this.props.onAddToNode(this.props.renderNode.node)}},{key:"onClick",value:function(e){this.props.onOpenNodeEditor({originalNode:this.props.renderNode})}},{key:"handleRemoval",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.removeNode(this.props.renderNode.node)}},{key:"getExits",value:function(){var e=this;return this.props.renderNode.node.exits?this.props.renderNode.node.exits.map(function(t,n){return b.createElement(Wl,{key:t.uuid,node:e.props.renderNode.node,categories:Gi(e.props.renderNode,t),exit:t,showDragHelper:e.props.onlyNode&&0===n,plumberMakeSource:e.props.plumberMakeSource,plumberRemove:e.props.plumberRemove,plumberConnectExit:e.props.plumberConnectExit,plumberUpdateClass:e.props.plumberUpdateClass})}):[]}},{key:"isSelected",value:function(){return this.props.selected}},{key:"hasMissing",value:function(){if((this.props.renderNode.ui.type===ve.split_by_run_result||this.props.renderNode.ui.type===ve.split_by_run_result_delimited)&&!(this.props.renderNode.ui.config.operand.id in this.props.results))return!0;if(this.props.renderNode.node.router){var e=this.props.renderNode.node.router.cases||[],t=!0,n=!1,a=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if(!wr(o.type))return!0}}catch(s){n=!0,a=s}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}return!1}},{key:"isStartNodeVisible",value:function(){return this.props.startingNode}},{key:"renderDebug",value:function(){if(this.props.debug&&this.props.debug.showUUIDs)return b.createElement("span",{id:"uuid-".concat(this.props.renderNode.node.uuid),onClick:this.handleUUIDClicked,className:Hl.a.uuid},this.props.renderNode.node.uuid)}},{key:"render",value:function(){var e,t=this,n=[],a=null;if(this.props.renderNode.node.actions){var i={ref:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return t.firstAction=e})};this.props.renderNode.node.actions.forEach(function(e,a){var r=cs(e.type);if(r.hasOwnProperty("component")&&r.component){var o=r.component;n.push(b.createElement(Al,Object.assign({},i,{key:e.uuid,renderNode:t.props.renderNode,selected:t.props.selected,action:e,first:0===a,render:function(e){return b.createElement(o,e)}})))}i={}}),a=n.length>0?b.createElement(is.a,{enterAnimation:"fade",leaveAnimation:"fade",duration:300,easing:"ease-out"},n):null}var r=null,o=null,s=null;if(this.props.renderNode.ui.type!==ve.execute_actions){var l=this.props.renderNode.node.router.type;this.props.renderNode.ui.type&&(l=ds(this.props.renderNode));var u=cs(l),c=null;if(zi(this.props.renderNode.node)){this.props.renderNode.ui.type===ve.split_by_contact_field?c="Split by ".concat(this.props.renderNode.ui.config.operand.name):this.props.renderNode.ui.type===ve.split_by_expression?c="Split by Expression":this.props.renderNode.ui.type===ve.wait_for_response&&(c="Wait for Message");var d=qi(this.props.renderNode.node);d&&(s=b.createElement("div",Object.assign({},this.events,{className:Hl.a.save_result}),b.createElement("div",{className:Hl.a.save_as},"Save as "),b.createElement("div",{className:Hl.a.result_name},d)))}null!==c||this.props.renderNode.ui.type!==ve.split_by_run_result&&this.props.renderNode.ui.type!==ve.split_by_run_result_delimited||(c=this.props.renderNode.ui.config.operand.id in this.props.results?"Split by ".concat(this.props.results[this.props.renderNode.ui.config.operand.id].name):"Missing ".concat(this.props.renderNode.ui.config.operand.id)),null===c&&(c=u.name),this.props.renderNode.node.actions&&this.props.renderNode.node.actions.length||(r=b.createElement("div",{style:{position:"relative"}},b.createElement("div",this.events,b.createElement(Tl,{__className:re.a[this.hasMissing()?"missing":u.type],showRemoval:!this.props.translating,onRemoval:this.handleRemoval,shouldCancelClick:this.handleShouldCancelClick,title:c}))))}else this.props.translating||(o=b.createElement("div",Object.assign({className:Hl.a.add},z(this.handleAddToNode,this.handleShouldCancelClick)),b.createElement("span",{className:"fe-add"})));var p=this.getExits(),h=Xl((e={"plumb-drag":!0},Object(E.a)(e,Hl.a.ghost,this.props.ghost),Object(E.a)(e,Hl.a.flow_start,this.isStartNodeVisible()),Object(E.a)(e,Hl.a.selected,this.isSelected()),e)),m=this.renderDebug();return b.createElement("div",{id:this.props.renderNode.node.uuid,className:"".concat(Hl.a.node_container," ").concat(h),ref:this.eleRef},b.createElement("div",{className:Hl.a.node},this.isStartNodeVisible()?b.createElement("div",{className:Hl.a.flow_start_message},"Flow Start"):null,m,b.createElement(Nl,{count:this.props.activeCount,containerStyle:Hl.a.active,countStyle:"",keepVisible:this.props.simulating,onClick:function(){t.context.config.onActivityClicked&&t.context.config.onActivityClicked(t.props.nodeUUID,t.props.activeCount)}}),b.createElement("div",{className:Hl.a.cropped},r,a,s),b.createElement("div",{className:"".concat(Hl.a.exit_table)},b.createElement("div",Object.assign({className:Hl.a.exits},this.events),p),o)))}}]),t}(b.Component);Ql.contextTypes={config:Be};var $l,Zl=Object(Bn.b)(function(e,t){var n=e.flowContext,a=n.nodes,i=n.definition,r=n.assetStore.results.items,o=e.editorState,s=o.translating,l=o.debug,u=o.ghostNode,c=o.simulating,d=o.containerOffset,p=o.activity,h=null;if(u&&u.node.uuid===t.nodeUUID?h=u:t.nodeUUID in a&&(h=a[t.nodeUUID]),!h)throw Error("Couldn't find node for "+t.nodeUUID);return{results:r,activeCount:p.nodes[t.nodeUUID]||0,containerOffset:d,translating:s,debug:l,definition:i,renderNode:h,simulating:c}},function(e){return Object(de.bindActionCreators)({onAddToNode:Ws,onOpenNodeEditor:Zs,removeNode:zs,mergeEditorState:Ts},e)},null,{withRef:!0})(Ql),Jl=n(194),eu=n.n(Jl),tu=function(e){function t(){return Object(p.a)(this,t),Object(m.a)(this,Object(v.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(h.a)(t,[{key:"render",value:function(){var e={content:{marginLeft:"auto",marginRight:"auto",marginTop:"40px",bottom:"initial",padding:"none",borderRadius:"none",outline:"none",width:this.props.width?this.props.width:"700px",border:"none"}};return b.createElement(eu.a,{ariaHideApp:!1,isOpen:this.props.show,onAfterOpen:this.props.onModalOpen,onRequestClose:this.props.onClose,style:e,shouldCloseOnOverlayClick:!1,contentLabel:"Modal"},this.props.children)}}]),t}(b.Component),nu=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^close/,/^update/,/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"updateLocalizations",value:function(e,t){this.props.onUpdateLocalizations(e,t)}},{key:"close",value:function(e){if(e){var t=Ri(this.props.settings.originalNode);if(t){var n=this.props.nodes[t.nodeUUID],a=!0,i=!1,r=void 0;try{for(var o,s=n.node.exits[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;if(l.uuid===t.exitUUID){this.props.plumberConnectExit(n.node,l);break}}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}}}this.props.resetNodeEditingState(),this.props.updateUserAddingAction(!1)}},{key:"updateAction",value:function(e,t){this.props.onUpdateAction(e,t)}},{key:"updateRouter",value:function(e){this.props.onUpdateRouter(e)}},{key:"handleAddAsset",value:function(e,t){this.props.addAsset(e,t)}},{key:"render",value:function(){if(this.props.settings){var e=this.props.typeConfig;if(this.props.translating){var t=e.localization;if(t){var n={updateLocalizations:this.updateLocalizations,nodeSettings:this.props.settings,typeConfig:this.props.typeConfig,onClose:this.close,language:this.props.language};return b.createElement(tu,{width:"600px",show:!0},b.createElement(t,Object(_.a)({},n)))}}var a=e.form,i={assetStore:this.props.assetStore,addAsset:this.handleAddAsset,updateAction:this.updateAction,updateRouter:this.updateRouter,nodeSettings:this.props.settings,typeConfig:this.props.typeConfig,onTypeChange:this.props.handleTypeConfigChange,onClose:this.close};return b.createElement(tu,{width:"600px",show:!0},b.createElement(a,Object(_.a)({},i)))}return null}}]),t}(b.Component),au=Object(Bn.b)(function(e){var t=e.flowContext,n=t.definition,a=t.nodes,i=t.assetStore,r=e.editorState,o=r.language,s=r.translating,l=e.nodeEditor;return{language:o,definition:n,nodes:a,translating:s,typeConfig:l.typeConfig,settings:l.settings,assetStore:i}},function(e){return Object(de.bindActionCreators)({addAsset:Ds,resetNodeEditingState:qs,mergeEditorState:Ts,handleTypeConfigChange:Gs,onUpdateLocalizations:Ps,onUpdateAction:Ks,onUpdateRouter:$s,updateUserAddingAction:$t},e)})(nu),iu=($(),function(){var e=new Date,t=e.getMinutes(),n=""+t;return t<10&&(n="0"+t),Math.abs(12-e.getHours())+":"+n}),ru=function(e){return!!["msg_created","msg_received","ivr_created"].find(function(t){return t===e.type})},ou=function(e){return!!["msg_created","ivr_created"].find(function(t){return t===e.type})},su=n(15),lu=n.n(su),uu=n(178);!function(e){e[e.MT=0]="MT",e[e.MO=1]="MO"}($l||($l={}));var cu,du=function(e){return e===$l.MO?lu.a.msg_received:lu.a.send_msg},pu=function(e){return b.createElement("div",{className:lu.a.info},b.createElement("span",null,e))},hu=function(e,t,n){var a=t||[];return b.createElement("div",{className:du(n)},a.map(function(t){return b.createElement("div",{key:e+t},function(e){var t=e.indexOf(":");if(t>-1){var n=e.substr(0,t),a=e.substr(t+1);if(n.startsWith("audio"))return b.createElement("div",{className:lu.a.audio_attachment},b.createElement("div",{className:lu.a.media_player},b.createElement(Pa,{url:a})),b.createElement("div",{className:lu.a.audio_text},"Audio Recording"));if(n.startsWith("image"))return b.createElement("img",{src:a,alt:"Attachment"});if(n.startsWith("geo"))return b.createElement("img",{src:uu,alt:"Attachment"});if(n.startsWith("video"))return b.createElement("div",{className:lu.a.video_attachment},b.createElement("video",{controls:!0,src:a}))}return null}(t))}),e?e.split("\n").map(function(e,t){return b.createElement("div",{key:$(),className:lu.a.msg_text},e)}):null)},mu=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).state={detailsVisible:!1},n.showDetails=n.showDetails.bind(Object(f.a)(n)),n.getButtons=n.getButtons.bind(Object(f.a)(n)),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"getButtons",value:function(){var e=this;return{primary:{name:"Ok",onClick:function(){e.setState({detailsVisible:!1})}}}}},{key:"showDetails",value:function(){this.setState({detailsVisible:!0})}},{key:"renderGroupChange",value:function(){var e=this.props.groups_added||this.props.groups_removed,t=this.props.groups_added?"Added to ":"Removed from ",n=" ";return e.forEach(function(e){t+="".concat(n,'"').concat(e.name,'"'),n=", "}),pu(t)}},{key:"renderEmail",value:function(){return this.renderClickable(b.createElement("div",{className:lu.a.info+" "+lu.a.email},'Sent email to "'.concat(this.props.addresses.join(", "),'" with subject "').concat(this.props.subject,'\n                "')),b.createElement(ue,{title:"Email Details",headerClass:ve.send_email,buttons:this.getButtons(),noPadding:!0},b.createElement("div",{className:lu.a.email_details},b.createElement("div",{className:lu.a.to},"To: ",this.props.addresses.join(", ")),b.createElement("div",{className:lu.a.subject},"Subject: ",this.props.subject),b.createElement("div",{className:lu.a.body},this.props.body))))}},{key:"renderWebhook",value:function(){return this.renderClickable(b.createElement("div",{className:lu.a.info+" "+lu.a.webhook},b.createElement("span",null,"Called webhook ",this.props.url)),b.createElement(ue,{title:"Webhook Details",headerClass:ve.call_webhook,buttons:this.getButtons(),noPadding:!0},b.createElement("div",{className:lu.a.webhook_details},b.createElement("div",{className:""},this.props.request),b.createElement("div",{className:lu.a.response},this.props.response))))}},{key:"renderClickable",value:function(e,t){return b.createElement("div",null,b.createElement("div",{className:lu.a.has_detail,onClick:this.showDetails},e),b.createElement(tu,{show:this.state.detailsVisible},b.createElement("div",{className:lu.a.event_viewer},t)))}},{key:"renderLogEvent",value:function(){switch(this.props.type){case"msg_received":return hu(this.props.msg.text,this.props.msg.attachments,$l.MO);case"msg_created":case"ivr_created":return hu(this.props.msg.text,this.props.msg.attachments,$l.MT);case"error":return e=this.props.text,b.createElement("div",{className:lu.a.error},b.createElement("span",null,"Error: ",e));case"msg_wait":return pu("Waiting for reply");case"contact_groups_changed":return this.renderGroupChange();case"contact_urns_changed":return pu("Added a URN for the contact");case"contact_field_changed":return pu('Set contact "'.concat(this.props.field.name,'" to "').concat(this.props.value.text,'"'));case"run_result_changed":return pu('Set result "'.concat(this.props.name,'" to "').concat(this.props.value,'"'));case"contact_name_changed":return pu('Set contact name to "'.concat(this.props.name,'"'));case"email_created":return this.renderEmail();case"broadcast_created":return hu(this.props.translations[this.props.base_language].text,this.props.msg?this.props.msg.attachments:[],$l.MT);case"resthook_called":return pu("Trigerred flow event ".concat(this.props.resthook));case"webhook_called":return this.renderWebhook();case"flow_entered":return pu("Entered flow ".concat(this.props.flow.name));case"session_triggered":return pu("Started somebody else in ".concat(this.props.flow.name));case"contact_language_changed":return pu("Set preferred language to ".concat(this.props.language));case"info":return pu(this.props.text);case"environment_refreshed":return null}var e;return console.log("Simulator render missing",this.props),null}},{key:"render",value:function(){return b.createElement("div",{className:lu.a.evt},this.renderLogEvent())}}]),t}(b.Component),vu=n(11),fu=n.n(vu),gu=n(178),_u="https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_a.jpg",yu="https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_b.jpg",bu="https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_image_c.jpg",ku="https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_video_a.mp4",Cu="https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_video_a_thumb.jpg";!function(e){e.audio="audio",e.images="images",e.videos="videos",e.location="location",e.digit="digit",e.digits="digits",e.quickReplies="quickReplies"}(cu||(cu={}));var Eu=function(e){function t(e,n){var a;return Object(p.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e))).debug=[],a.flows=[],a.currentFlow=void 0,a.inputBox=void 0,a.drawerEle=void 0,a.bottom=void 0,a.state={active:!1,visible:!1,events:[],contact:{uuid:$(),urns:["tel:+12065551212"],fields:{},groups:[]},keypadEntry:"",drawerHeight:0,channel:$(),time:iu(),waitingForHint:!1,drawerOpen:!1,attachmentOptionsVisible:!1,sprinting:!1},a.bottomRef=a.bottomRef.bind(Object(f.a)(a)),a.inputBoxRef=a.inputBoxRef.bind(Object(f.a)(a)),a.currentFlow=a.props.definition.uuid,Object(y.react)(Object(f.a)(a),{include:[/^on/,/^get/,/^handle/]}),a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"bottomRef",value:function(e){return this.bottom=e}},{key:"inputBoxRef",value:function(e){this.inputBox=e}},{key:"updateActivity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.state.session){var t,n=null,a={},i={},r=!0,o=!1,s=void 0;try{for(var l,u=this.state.session.runs[Symbol.iterator]();!(r=(l=u.next()).done);r=!0){var c=l.value,d=null,p=!0,h=!1,m=void 0;try{for(var v,f=c.path[Symbol.iterator]();!(p=(v=f.next()).done);p=!0){var g=v.value;if(n){var _=n+":"+g.node_uuid,y=a[_];y||(y=0),a[_]=++y}n=g.exit_uuid,d=g}}catch(O){h=!0,m=O}finally{try{p||null==f.return||f.return()}finally{if(h)throw m}}if("waiting"===c.status&&d){var b=i[d.node_uuid];b||(b=0),i[d.node_uuid]=++b,t=c.flow_uuid}}}catch(O){o=!0,s=O}finally{try{r||null==u.return||u.return()}finally{if(o)throw s}}var k=this.props.activity.recentMessages||{};for(var C in e){var E=k[C]||[];E=e[C].concat(E),k[C]=E}var w={segments:a,nodes:i,recentMessages:k};this.props.mergeEditorState({activity:w}),t&&t!==this.currentFlow&&(this.currentFlow=t)}}},{key:"updateEvents",value:function(e,t,n,a){var i=this;if(e&&e.length>0){for(var r=[],o=null,s=!1;e.length>0&&!s;){var l=e.shift();if(ru(l)){s=!0;for(var u="",c="",d=t.runs.length-1;d>=0;d--){for(var p=t.runs[d].path,h=p.length-2;h>=0;h--)if(p[h].uuid===l.step_uuid){u=p[h].exit_uuid,c=p[h+1].node_uuid;break}if(u&&c){var m="".concat(u,":").concat(c),v={sent:new Date(l.created_on),text:l.msg.text};m in n?n[m].unshift(v):n[m]=[v]}}ou(l)&&l.msg.quick_replies&&(o=l.msg.quick_replies)}r.push(l)}var f={events:Yt()(this.state.events,{$push:r})};null!==o&&(f.quickReplies=o),this.scrollToBottom(),this.setState(f,function(){0===e.length?a():window.setTimeout(function(){i.updateEvents(e,t,n,a)},200)})}else a()}},{key:"updateRunContext",value:function(e,t){var n=this,a=this.state.active||e.events&&e.events.length>0;this.setState({quickReplies:[]},function(){if(!e.events||0===e.events.length&&t){var i=e.session.runs,r=i[i.length-1],o=r.path[r.path.length-1];e.events=[{msg:{uuid:$(),urn:n.state.contact.urns[0],text:t.text,attachments:t.attachments},type:"msg_created",created_on:(new Date).toISOString(),step_uuid:o.uuid}]}var s={};n.updateEvents(e.events,e.session,s,function(){var t=!1,i=!0,r=!1,o=void 0;try{for(var l,u=e.session.runs[Symbol.iterator]();!(i=(l=u.next()).done);i=!0){if("waiting"===l.value.status){t=!0;break}}}catch(m){r=!0,o=m}finally{try{i||null==u.return||u.return()}finally{if(r)throw o}}var c=n.state.events;!t&&a&&(c=Yt()(n.state.events,{$push:[{type:"info",text:"Exited flow",created_on:new Date}]}));var d=e.session&&e.session.wait&&void 0!==e.session.wait.hint,p=null;if(d)switch(e.session.wait.hint.type){case"audio":p=cu.audio;break;case"video":p=cu.videos;break;case"image":p=cu.images;break;case"location":p=cu.location;break;case"digits":p=cu.digit,1!==e.session.wait.hint.count&&(p=cu.digits);break;default:console.log("Unknown hint",e.session.wait.hint.type)}var h=d;!p&&n.hasQuickReplies()&&(p=cu.quickReplies,h=!0),n.setState({active:t,sprinting:!1,session:e.session,events:c,drawerOpen:h,drawerType:p,waitingForHint:d},function(){n.updateActivity(s),n.handleFocusUpdate()})})})}},{key:"startFlow",value:function(){var e=this;this.setState({sprinting:!0,drawerOpen:!1,attachmentOptionsVisible:!1,events:[]},function(){var t=(new Date).toISOString(),n={contact:e.state.contact,flow:ol(e.props.definition,e.props.nodes,!1),trigger:{type:"manual",environment:{date_format:"DD-MM-YYYY",time_format:"hh:mm",timezone:"America/New_York",languages:[]},contact:{uuid:$(),urns:["tel:+12065551212"],fields:{},groups:[],created_on:t},flow:{uuid:e.props.definition.uuid,name:e.props.definition.name},params:{},triggered_on:t}};it.a.post(ft(e.context.config.endpoints.simulateStart),JSON.stringify(n,null,2)).then(function(t){e.updateRunContext(t.data)})})}},{key:"resume",value:function(e,t){var n=this;(e&&0!==e.trim().length||t)&&("\\debug"!==e?"\\recalc"!==e?this.setState({sprinting:!0,attachmentOptionsVisible:!1,drawerOpen:!1},function(){var a=(new Date).toISOString(),i={text:e,uuid:$(),urn:n.state.session.contact.urns[0],attachments:t?[t]:[]},r={flow:ol(n.props.definition,n.props.nodes,!1),session:n.state.session,resume:{type:"msg",msg:i,resumed_on:a,contact:n.state.session.contact}};it.a.post(ft(n.context.config.endpoints.simulateResume),JSON.stringify(r,null,2)).then(function(e){n.updateRunContext(e.data,i)}).catch(function(e){e.response.status;var t=Yt()(n.state.events,{$push:[{type:"error",text:e.response.status>499?"Server error, try again later":e.response.data.error}]});n.setState({events:t})})}):console.log("recal.."):console.log(JSON.stringify(this.debug,null,2)))}},{key:"onReset",value:function(e){this.startFlow()}},{key:"scrollToBottom",value:function(e){var t=this,n=e||0;this.bottom&&window.setTimeout(function(){t.bottom&&t.bottom.scrollIntoView(!1)},n)}},{key:"componentDidUpdate",value:function(e,t){var n=this;null!==this.drawerEle&&(t.drawerHeight===this.drawerEle.clientHeight&&t.drawerOpen===this.state.drawerOpen||this.setState({drawerHeight:this.drawerEle.clientHeight},function(){n.scrollToBottom(800)}))}},{key:"onKeyUp",value:function(e){if("Enter"===e.key){var t=e.target,n=t.value;t.value="",this.resume(n)}}},{key:"onToggle",value:function(e){var t=this,n=!this.state.visible;this.props.mergeEditorState({simulating:n}),this.setState({visible:n},function(){t.state.visible?(t.updateActivity(),0===t.state.events.length&&t.startFlow(),t.handleFocusUpdate()):window.setTimeout(function(){t.props.mergeEditorState({activity:t.props.liveActivity})},500)})}},{key:"handleFocusUpdate",value:function(){this.inputBox&&this.inputBox.focus()}},{key:"sendAttachment",value:function(e){var t=this;this.setState({drawerOpen:!1,attachmentOptionsVisible:!1},function(){window.setTimeout(function(){t.resume(null,e)},200)})}},{key:"getImageDrawer",value:function(){var e=this;return k.a.createElement("div",{className:fu.a.drawer_items},k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("image/jpeg:"+_u)}},k.a.createElement("img",{src:_u,alt:"Attachment"})),k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("image/jpeg:"+yu)}},k.a.createElement("img",{src:yu,alt:"Attachment"})),k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("image/jpeg:"+bu)}},k.a.createElement("img",{src:bu,alt:"Attachment"})))}},{key:"getLocationDrawer",value:function(){var e=this;return k.a.createElement("div",{className:fu.a.map_thumb,onClick:function(){e.sendAttachment("geo:2.904194,-79.003418")}},k.a.createElement("img",{src:gu,alt:"Attachment"}))}},{key:"getAudioDrawer",value:function(){var e=this;return k.a.createElement("div",{className:fu.a.audio_picker,onClick:function(){e.sendAttachment("audio/mp3:https://s3.amazonaws.com/floweditor-assets.temba.io/simulator/sim_audio_a.mp3")}},k.a.createElement("div",{className:fu.a.audio_icon+" fe-mic"}),k.a.createElement("div",{className:fu.a.audio_message},"Upload Audio"))}},{key:"getVideoDrawer",value:function(){var e=this;return k.a.createElement("div",{className:fu.a.drawer_items},k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("video/mp4:"+ku)}},k.a.createElement("img",{src:Cu,alt:"Attachment"})),k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("video/mp4:"+ku)}},k.a.createElement("img",{src:Cu,alt:"Attachment"})),k.a.createElement("div",{className:fu.a.drawer_item,onClick:function(){e.sendAttachment("video/mp4:"+ku)}},k.a.createElement("img",{src:Cu,alt:"Attachment"})))}},{key:"getQuickRepliesDrawer",value:function(){var e=this;return k.a.createElement("div",{className:fu.a.quick_replies},this.state.quickReplies.map(function(t){return k.a.createElement("div",{className:fu.a.quick_reply,onClick:function(){e.resume(t)},key:"reply_".concat(t)},t)}))}},{key:"handleKeyPress",value:function(e,t){t?"#"===e?(this.resume(this.state.keypadEntry),this.setState({keypadEntry:""})):this.setState(function(t){return{keypadEntry:t.keypadEntry+=e}}):this.resume(e)}},{key:"getKeyRow",value:function(e,t){var n=this;return k.a.createElement("div",{className:fu.a.row},e.map(function(e){return k.a.createElement("div",{key:"btn_"+e,onClick:function(){n.handleKeyPress(e,t)},className:fu.a.key},e)}))}},{key:"getKeypadDrawer",value:function(e){return k.a.createElement("div",{className:fu.a.keypad},e?k.a.createElement("div",{className:fu.a.keypad_entry},this.state.keypadEntry):null,k.a.createElement("div",{className:fu.a.keys},this.getKeyRow(["1","2","3"],e),this.getKeyRow(["4","5","6"],e),this.getKeyRow(["7","8","9"],e),this.getKeyRow(["*","0","#"],e)))}},{key:"getDrawerContents",value:function(){switch(this.state.drawerType){case cu.location:return this.getLocationDrawer();case cu.audio:return this.getAudioDrawer();case cu.images:return this.getImageDrawer();case cu.videos:return this.getVideoDrawer();case cu.quickReplies:return this.getQuickRepliesDrawer();case cu.digits:case cu.digit:return this.getKeypadDrawer(this.state.drawerType===cu.digits)}return null}},{key:"handleDrawerRef",value:function(e){return this.drawerEle=e}},{key:"getDrawer",value:function(){var e={};return this.state.drawerOpen?(e.bottom=50,this.state.waitingForHint&&(e.bottom=25,e.zIndex=150,e.paddingBottom=10)):e.bottom=-this.state.drawerHeight,k.a.createElement("div",{ref:this.handleDrawerRef,style:e,className:fu.a.drawer+" "+(this.state.drawerOpen?fu.a.drawer_visible:"")+" "+(this.state.attachmentOptionsVisible?"":fu.a.forced)},this.getDrawerContents())}},{key:"hasQuickReplies",value:function(){return(this.state.quickReplies||[]).length>0}},{key:"handleHideAttachments",value:function(){var e=this;this.setState({attachmentOptionsVisible:!1,drawerOpen:!1},function(){e.hasQuickReplies()&&window.setTimeout(function(){e.showAttachmentDrawer(cu.quickReplies)},300)})}},{key:"getAttachmentButton",value:function(e,t){var n=this;return k.a.createElement("div",{className:e,onClick:function(){n.showAttachmentDrawer(t)}})}},{key:"getAttachmentOptions",value:function(){return k.a.createElement("div",{className:fu.a.attachment_buttons+" "+(this.state.attachmentOptionsVisible?fu.a.visible:"")},k.a.createElement("div",{className:"fe-x",onClick:this.handleHideAttachments}),this.getAttachmentButton("fe-picture2",cu.images),this.getAttachmentButton("fe-video",cu.videos),this.getAttachmentButton("fe-mic",cu.audio),this.getAttachmentButton("fe-map-marker",cu.location))}},{key:"handleHideAttachmentDrawer",value:function(){this.setState({drawerOpen:!1})}},{key:"showAttachmentDrawer",value:function(e){var t=this;if(this.state.drawerOpen){if(e===this.state.drawerType)return;this.handleHideAttachmentDrawer(),window.setTimeout(function(){t.showAttachmentDrawer(e)},300)}else this.setState(function(t){return{drawerOpen:!0,drawerType:e}})}},{key:"render",value:function(){var e=this,t=[],n=!0,a=!1,i=void 0;try{for(var r,o=this.state.events[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var s=r.value;t.push(k.a.createElement(mu,Object.assign({},s,{key:s.type+"_"+String(s.created_on)})))}}catch(d){a=!0,i=d}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}var l=this.state.visible?"":fu.a.sim_hidden,u=this.state.visible?fu.a.tab_hidden:"",c={height:366-(this.state.drawerOpen?this.state.drawerHeight-20:0)};return this.state.drawerOpen&&this.state.waitingForHint&&(c.height+=25),k.a.createElement("div",{className:fu.a.sim_container},k.a.createElement("div",null,k.a.createElement("div",{id:"simulator",className:fu.a.simulator+" "+l,key:"sim"},k.a.createElement("div",{className:fu.a.screen},k.a.createElement("div",{className:fu.a.header},k.a.createElement("div",{className:fu.a.close+" fe-x",onClick:this.onToggle})),k.a.createElement("div",{className:fu.a.messages,style:c},t,k.a.createElement("div",{id:"bottom",style:{float:"left",clear:"both",marginTop:20},ref:this.bottomRef})),k.a.createElement("div",{className:fu.a.controls},k.a.createElement("input",{ref:this.inputBoxRef,type:"text",onKeyUp:this.onKeyUp,disabled:this.state.sprinting,placeholder:this.state.active?"Enter message":"Press home to start again"}),k.a.createElement("div",{className:fu.a.show_attachments_button},k.a.createElement("div",{className:"fe-paperclip",onClick:function(){e.setState({attachmentOptionsVisible:!0,drawerOpen:!1})}}))),this.getAttachmentOptions(),this.getDrawer(),k.a.createElement("div",{className:fu.a.footer},k.a.createElement("span",{className:fu.a.reset+" "+(this.state.active?fu.a.active:fu.a.inactive),onClick:this.onReset}))))),k.a.createElement("div",{className:fu.a.simulator_tab+" "+u,onClick:this.onToggle},k.a.createElement("div",{className:fu.a.simulator_tab_icon+" fe-smartphone"}),k.a.createElement("div",{className:fu.a.simulator_tab_text},"Run in",k.a.createElement("br",null),"Simulator")))}}]),t}(k.a.Component);Eu.contextTypes={config:Be};var wu=Object(Bn.b)(function(e){var t=e.flowContext,n=t.definition,a=t.nodes,i=t.assetStore,r=e.editorState;return{liveActivity:r.liveActivity,activity:r.activity,assetStore:i,definition:n,nodes:a}},function(e){return Object(de.bindActionCreators)({},e)})(Eu),Ou=n(132),Su=n.n(Ou),Nu=n(21),xu=n.n(Nu),ju={yellow:xu.a.yellow,blue:xu.a.blue,green:xu.a.green,purple:xu.a.purple,gray:xu.a.gray},Tu=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).dragging=!1,n.ele=void 0,n.debounceTextChanges=void 0,n.showConfirmation=void 0,n.DEFUALT_TITLE="New Note",n.DEFUALT_BODY="...",Object(y.react)(Object(f.a)(n),{include:[/^on/,/^get/,/^is/,/^handle/]}),n.state={title:n.props.sticky.title,body:n.props.sticky.body,color:n.props.sticky.color,showConfirmation:!1},n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"isSelected",value:function(){return this.props.selected}},{key:"onRef",value:function(e){return this.ele=e}},{key:"componentWillUnmount",value:function(){this.showConfirmation&&window.clearTimeout(this.showConfirmation),this.debounceTextChanges&&window.clearTimeout(this.debounceTextChanges)}},{key:"handleDrag",value:function(e){}},{key:"handleDragStop",value:function(e){var t=D(e.finalPos[0],e.finalPos[1]),n=t.left,a=t.top;this.ele.style.left="".concat(n,"px"),this.ele.style.top="".concat(a,"px"),this.props.sticky.position={left:n,top:a},this.props.updateSticky(this.props.uuid,this.props.sticky)}},{key:"onUpdateText",value:function(){var e=this;this.debounceTextChanges&&window.clearTimeout(this.debounceTextChanges),this.debounceTextChanges=window.setTimeout(function(){var t=Object(_.a)({},e.props.sticky);t.title=e.state.title,t.body=e.state.body,e.props.updateSticky(e.props.uuid,t),e.debounceTextChanges=null},2e3)}},{key:"handleChangeTitle",value:function(e){this.setState({title:e.currentTarget.value}),this.onUpdateText()}},{key:"handleChangeBody",value:function(e){this.setState({body:e.currentTarget.value}),this.onUpdateText()}},{key:"handleClickRemove",value:function(e){var t=this;this.state.showConfirmation?this.props.updateSticky(this.props.uuid,null):(this.setState({showConfirmation:!0}),this.showConfirmation=window.setTimeout(function(){t.setState({showConfirmation:!1})},2e3))}},{key:"handleChangeColor",value:function(e){this.props.sticky.color=e,this.props.updateSticky(this.props.uuid,this.props.sticky),this.setState({color:e})}},{key:"handleSelectForValue",value:function(e,t){e.value===t&&window.setTimeout(function(){e.select()},0)}},{key:"handleTitleFocused",value:function(e){this.handleSelectForValue(e.currentTarget,"New Note")}},{key:"handleBodyFocused",value:function(e){this.handleSelectForValue(e.currentTarget,"...")}},{key:"getColorChooser",value:function(){var e=this;return b.createElement("div",{className:xu.a.color_chooser_container},b.createElement("div",{className:xu.a.color_chooser},Object.keys(ju).map(function(t){return b.createElement("div",{key:e.props.uuid+t,onClick:function(){e.handleChangeColor(t)},className:xu.a.color_option+" "+ju[t]})})))}},{key:"render",value:function(){var e=[xu.a.title_wrapper];this.state.showConfirmation&&e.push(xu.a.removal);var t=[xu.a.sticky_container];this.props.sticky.color||(this.props.sticky.color="yellow");var n=[xu.a.sticky];this.isSelected()&&n.push(xu.a.selected),t.push(ju[this.props.sticky.color]);var a=this.getColorChooser();return b.createElement("div",{key:this.props.uuid,className:t.join(" "),"data-spec":"sticky-container",ref:this.onRef,id:this.props.uuid},b.createElement("div",{className:n.join(" ")},b.createElement("div",{className:e.join(" ")},b.createElement("div",{className:xu.a.remove_button,onClick:this.handleClickRemove},b.createElement("span",{className:"fe-x"})),b.createElement("div",{className:xu.a.confirmation},"Remove?"),b.createElement(Su.a,{className:xu.a.title,value:this.state.title,onChange:this.handleChangeTitle,onFocusCapture:this.handleTitleFocused})),b.createElement("div",{className:xu.a.body_wrapper},b.createElement(Su.a,{className:xu.a.body,value:this.state.body,onChange:this.handleChangeBody,onFocusCapture:this.handleBodyFocused}),a)))}}]),t}(b.Component),Ru=Object(Bn.b)(function(e){return{definition:e.flowContext.definition}},function(e){return Object(de.bindActionCreators)({updateSticky:Qs},e)},null,{withRef:!1})(Tu),Uu=n(402).jsPlumb.importDefaults,Au={anchor:["Continuous",{shape:"Dot",faces:["top","left","right"]}],endpoint:["Dot",{radius:13,cssClass:"plumb-endpoint",hoverClass:"plumb-endpoint-hover"}],dropOptions:{tolerance:"touch",hoverClass:"plumb-drop-hover",isTarget:!1},dragAllowedWhenFull:!1,deleteEndpointsOnEmpty:!0,isTarget:!1},Du={anchor:"BottomCenter",maxConnections:1,dragAllowedWhenFull:!1,deleteEndpointsOnEmpty:!0,isSource:!0},Fu=function(e,t){return["Continuous",{shape:"Dot",faces:e.getBoundingClientRect().bottom+R/3<t.getBoundingClientRect().top?["top"]:["right","left"]}]},Pu=["Flowchart",{stub:12,midpoint:.75,alwaysRespectStubs:!1,gap:[0,5],cornerRadius:3}],Iu=function(){function e(){var t=this;Object(p.a)(this,e),this.jsPlumb=void 0,this.pendingConnections={},this.pendingConnectionTimeout=void 0,this.animateInterval=null,this.jsPlumb=Uu({DragOptions:{cursor:"pointer",zIndex:1e3},DropOptions:{tolerance:"touch",hoverClass:"plumb-hover"},Endpoint:"Blank",EndpointStyle:{strokeStyle:"transparent"},PaintStyle:{strokeWidth:3.5},ConnectionsDetachable:!0,Connector:Pu,ConnectionOverlays:[["PlainArrow",{location:.999,width:12,length:12,cssClass:"jtk-arrow"}]],Container:"editor-container"}),this.debug=this.debug.bind(this),this.setSourceEnabled=this.setSourceEnabled.bind(this),this.makeSource=this.makeSource.bind(this),this.makeTarget=this.makeTarget.bind(this),this.connectExit=this.connectExit.bind(this),this.setDragSelection=this.setDragSelection.bind(this),this.clearDragSelection=this.clearDragSelection.bind(this),this.removeFromDragSelection=this.removeFromDragSelection.bind(this),this.cancelDurationRepaint=this.cancelDurationRepaint.bind(this),this.remove=this.remove.bind(this),this.repaintForDuration=this.repaintForDuration.bind(this),this.repaintFor=this.repaintFor.bind(this),this.handlePendingConnections=this.handlePendingConnections.bind(this),this.checkForPendingConnections=this.checkForPendingConnections.bind(this),this.connect=this.connect.bind(this),this.bind=this.bind.bind(this),this.repaint=this.repaint.bind(this),this.recalculate=this.recalculate.bind(this),this.recalculateUUIDs=this.recalculateUUIDs.bind(this),this.reset=this.reset.bind(this),this.updateClass=this.updateClass.bind(this),window.onresize=function(){return t.jsPlumb.repaintEverything()}}return Object(h.a)(e,[{key:"debug",value:function(){return this.jsPlumb}},{key:"setSourceEnabled",value:function(e,t){this.jsPlumb.setSourceEnabled(e,t)}},{key:"makeSource",value:function(e){return this.jsPlumb.makeSource(e,Du)}},{key:"makeTarget",value:function(e){this.jsPlumb.makeTarget(e,Au)}},{key:"connectExit",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.connect("".concat(e.uuid,":").concat(t.uuid),t.destination_uuid,n,e.exits.findIndex(function(e){return e.uuid===t.uuid}),e.exits.length)}},{key:"updateClass",value:function(e,t,n,a){var i="".concat(e.uuid,":").concat(t.uuid),r=this.jsPlumb.select({source:i});a?r.addClass(n):r.removeClass(n)}},{key:"removeFromDragSelection",value:function(e){this.jsPlumb.removeFromDragSelection(e)}},{key:"setDragSelection",value:function(e){var t=this;this.cancelDurationRepaint(),this.jsPlumb.clearDragSelection(),Object.keys(e).forEach(function(e){return t.jsPlumb.addToDragSelection(e)})}},{key:"clearDragSelection",value:function(){this.jsPlumb.clearDragSelection()}},{key:"cancelDurationRepaint",value:function(){this.animateInterval&&(window.clearInterval(this.animateInterval),this.animateInterval=null)}},{key:"repaintForDuration",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:600;this.cancelDurationRepaint();var n=t/10,a=0;this.animateInterval=window.setInterval(function(){e.jsPlumb.repaintEverything(),a++>n&&window.clearInterval(e.animateInterval)},10)}},{key:"repaintFor",value:function(e){var t=this;window.setInterval(function(){t.jsPlumb.repaintEverything()},1)}},{key:"handlePendingConnections",value:function(){var e=this,t={};for(var n in this.jsPlumb.batch(function(){var n=Object.keys(e.pendingConnections).length;for(var a in n>1&&console.log("batching "+n+" connections"),e.pendingConnections)if(e.pendingConnections.hasOwnProperty(a)){var i=e.pendingConnections[a],r=i.source,o=i.target,s=i.className,l=i.slot,u=i.totalSlots,c=o?["Bottom",Fu(document.getElementById(r),document.getElementById(o))]:[];if(null!=r){e.jsPlumb.select({source:r}).delete({fireEvent:!1});var d=u<5?.75:.35,p=d+.15*l;l>u/2&&(p=d-.05+.15*(u-l)),p=Math.max(Math.min(.9,p),.1);var h=[].concat(Pu);h[1].midpoint=p,null!=o&&(s?e.jsPlumb.connect({source:r,target:o,anchors:c,fireEvent:!1,cssClass:s,detachable:!1,connector:h}):e.jsPlumb.connect({source:r,target:o,anchors:c,fireEvent:!1,cssClass:s,connector:h}))}null!=o&&(t[o]=!0),delete e.pendingConnections[a]}}),t)t.hasOwnProperty("target")&&this.recalculate(n)}},{key:"checkForPendingConnections",value:function(){var e=this;this.pendingConnectionTimeout&&window.clearTimeout(this.pendingConnectionTimeout),this.pendingConnectionTimeout=window.setTimeout(function(){e.handlePendingConnections()},0)}},{key:"connect",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.pendingConnections["".concat(e,":").concat(t,":").concat(n)]={source:e,target:t,className:n,slot:a,totalSlots:i},this.checkForPendingConnections()}},{key:"bind",value:function(e,t){return this.jsPlumb.bind(e,t)}},{key:"repaint",value:function(e){e?(this.jsPlumb.recalculateOffsets(e),this.jsPlumb.repaint(e)):(this.jsPlumb.recalculateOffsets(),this.jsPlumb.repaintEverything())}},{key:"remove",value:function(e){this.jsPlumb.isSource(e)?(this.jsPlumb.unmakeSource(e),this.jsPlumb.remove(e)):this.jsPlumb.isTarget(e)&&this.jsPlumb.deleteConnectionsForElement(e)}},{key:"recalculateUUIDs",value:function(e){var t=this;this.jsPlumb.batch(function(){e.forEach(function(e){var n=t.jsPlumb.getConnections({target:e}).concat(t.jsPlumb.getConnections({source:e})),a=!0,i=!1,r=void 0;try{for(var o,s=n[Symbol.iterator]();!(a=(o=s.next()).done);a=!0){var l=o.value;l.endpoints[1].setAnchor(Fu(l.endpoints[0].element,l.endpoints[1].element))}}catch(u){i=!0,r=u}finally{try{a||null==s.return||s.return()}finally{if(i)throw r}}t.jsPlumb.revalidate(e)})})}},{key:"recalculate",value:function(e){this.jsPlumb.revalidate(e)}},{key:"reset",value:function(){this.jsPlumb.reset()}}]),e}(),Mu=n(12),Lu=function(){function e(t,n){Object(p.a)(this,e),this.props=void 0,this.state=void 0,this.props=t,this.state=n||{showUUIDs:!1}}return Object(h.a)(e,[{key:"showUUIDs",value:function(){var e=Mu(this.state,{$merge:{showUUIDs:!0}});return this.props.mergeEditorState({debug:e}),e}}]),e}(),zu=n(195),Bu=n.n(zu),Vu=3,Gu=function(e){function t(e,n){var a;return Object(p.a)(this,t),(a=Object(m.a)(this,Object(v.a)(t).call(this,e,n))).Plumber=void 0,a.ele=void 0,a.nodeContainerUUID=void 0,a.ghost=void 0,a.nodeContainerUUID=$(),a.Plumber=new Iu,n.config.debug&&(window.fe=new Lu(e,a.props.editorState.debug)),Object(y.react)(Object(f.a)(a),{include:[/Ref$/,/^on/,/^is/,/^get/]}),K("RenderAndPlumb"),a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"onRef",value:function(e){return this.ele=e}},{key:"ghostRef",value:function(e){return this.ghost=e}},{key:"componentDidMount",value:function(){var e=this;this.Plumber.bind("connection",function(t){return e.props.updateConnection(t.sourceId,t.targetId)}),this.Plumber.bind("beforeDrag",function(t){e.beforeConnectionDrag(t)}),this.Plumber.bind("connectionDrag",function(t){e.props.onConnectionDrag(t,e.context.config.flowType)}),this.Plumber.bind("connectionDragStop",function(t){return e.onConnectorDrop(t)}),this.Plumber.bind("beforeStartDetach",function(t){return!e.props.editorState.translating}),this.Plumber.bind("beforeDetach",function(e){return!0}),this.Plumber.bind("beforeDrop",function(t){return e.onBeforeConnectorDrop(t)});var t={left:0,top:0};this.ele&&(t=this.ele.getBoundingClientRect()),this.props.mergeEditorState({containerOffset:{left:t.left,top:t.top+window.scrollY}}),window.setTimeout(function(){return e.Plumber.repaint()},500)}},{key:"componentWillUnmount",value:function(){this.Plumber.reset()}},{key:"componentWillUpdate",value:function(e){e.editorState.activityInterval===this.props.editorState.activityInterval&&5e3!==this.props.editorState.activityInterval&&this.props.mergeEditorState({activityInterval:5e3})}},{key:"onBeforeConnectorDrop",value:function(e){this.props.resetNodeEditingState();var t=e.sourceId.split(":")[0];try{il(this.props.nodes,t,e.targetId)}catch(n){return!1}return!0}},{key:"onConnectorDrop",value:function(e){var t=this.props.editorState.ghostNode;if(q(t)&&!function(e){return e.suspendedElementId===e.targetId&&null!==e.source}(e)){this.Plumber.recalculate(t.node.uuid);var n=Ri(t);this.Plumber.connect(n.nodeUUID+":"+n.exitUUID,t.node.uuid);var a=this.ghost&&D(this.ghost.wrappedInstance.ele.offsetLeft,this.ghost.wrappedInstance.ele.offsetTop)||{left:0,top:0},i=a.left,r=a.top;this.props.editorState.ghostNode.ui.position={left:i,top:r};var o=null;t.node.actions&&1===t.node.actions.length&&(o=t.node.actions[0]),this.props.onOpenNodeEditor({originalNode:t,originalAction:o})}return document.removeEventListener("mousemove",window.ghostListener),!0}},{key:"beforeConnectionDrag",value:function(e){return e.source&&e.source.dispatchEvent(new Event("disconnect")),!this.props.editorState.translating}},{key:"getNodes",value:function(){var e=this,t=1===Object.keys(this.props.nodes).length;return sl(this.props.nodes).map(function(n,a){return{uuid:n.node.uuid,position:n.ui.position,ele:function(i){return b.createElement(Zl,{onlyNode:t,startingNode:0===a,selected:i,key:n.node.uuid,"data-spec":"node",nodeUUID:n.node.uuid,plumberMakeTarget:e.Plumber.makeTarget,plumberRemove:e.Plumber.remove,plumberRecalculate:e.Plumber.recalculate,plumberMakeSource:e.Plumber.makeSource,plumberConnectExit:e.Plumber.connectExit,plumberUpdateClass:e.Plumber.updateClass})}}})}},{key:"getStickies",value:function(){var e=this.props.definition._ui.stickies||{};return Object.keys(e).map(function(t){return{uuid:t,ele:function(n){return b.createElement(Ru,{key:t,uuid:t,sticky:e[t],selected:n})},position:e[t].position}})}},{key:"getDragNode",value:function(){return q(this.props.editorState.ghostNode)?b.createElement("div",{"data-spec":"ghost-node",key:this.props.editorState.ghostNode.node.uuid,style:{position:"absolute",display:"block",visibility:"hidden"}},b.createElement(Zl,{onlyNode:!1,selected:!1,startingNode:!1,ref:this.ghostRef,ghost:!0,nodeUUID:this.props.editorState.ghostNode.node.uuid,plumberMakeTarget:this.Plumber.makeTarget,plumberRemove:this.Plumber.remove,plumberRecalculate:this.Plumber.recalculate,plumberMakeSource:this.Plumber.makeSource,plumberConnectExit:this.Plumber.connectExit,plumberUpdateClass:this.Plumber.updateClass})):null}},{key:"getSimulator",value:function(){return G(this.context.config.endpoints&&this.context.config.endpoints.simulateStart)(b.createElement(wu,{key:"simulator",mergeEditorState:this.props.mergeEditorState}))}},{key:"getNodeEditor",value:function(){return G(null!==this.props.nodeEditorSettings)(b.createElement(au,{key:"node-editor",plumberConnectExit:this.Plumber.connectExit,plumberRepaintForDuration:this.Plumber.repaintForDuration}))}},{key:"isClickOnCanvas",value:function(e){return e.target.id===this.nodeContainerUUID}},{key:"onDoubleClick",value:function(e){if(this.isClickOnCanvas(e)){var t=D(e.pageX-this.props.editorState.containerOffset.left-100+A,e.pageY-this.props.editorState.containerOffset.top-2*A-40),n=t.left,a=t.top;this.props.updateSticky($(),{position:{left:n,top:a},title:"New Note",body:"..."})}}},{key:"getEmptyFlow",value:function(){var e=this;return b.createElement("div",{key:"create_node",className:Bu.a.empty_flow},b.createElement("h1",null,"Let's get started"),b.createElement("div",null,"We recommend starting your flow by sending a message. This message will be sent to anybody right after they join the flow. This is your chance to send a single message or ask them a question."),b.createElement(ae,{name:"Create Message",onClick:function(){var t=ll(null,null,1,e.context.config.flowType);e.props.onOpenNodeEditor({originalNode:t,originalAction:t.node.actions[0]})}}))}},{key:"render",value:function(){var e=this,t=this.getNodes(),n=[];n=0===t.length?[this.getEmptyFlow()]:[this.getSimulator(),this.getDragNode()];var a=this.getStickies().concat(t);return b.createElement("div",{onDoubleClick:this.onDoubleClick,ref:this.onRef},b.createElement(wl,{draggingNew:!!this.props.editorState.ghostNode,onDragging:function(t){t.forEach(function(n){n in e.props.nodes&&e.props.nodes[n].node.exits.forEach(function(e){e.destination_uuid&&t.push(n+":"+e.uuid)})}),e.Plumber.recalculateUUIDs(t)},uuid:this.nodeContainerUUID,dragActive:this.props.editorState.dragActive,mergeEditorState:this.props.mergeEditorState,onRemoveNodes:this.props.onRemoveNodes,draggables:a,onUpdatePositions:this.props.onUpdateCanvasPositions},n,this.getNodeEditor()))}}]),t}(b.Component);Gu.contextTypes={config:Be};var qu=Object(Bn.b)(function(e){var t=e.flowContext,n=t.definition,a=t.dependencies,i=t.nodes,r=e.editorState;return{nodeEditorSettings:e.nodeEditor.settings,definition:n,nodes:i,dependencies:a,editorState:r}},function(e){return Object(de.bindActionCreators)({mergeEditorState:Ts,resetNodeEditingState:qs,onConnectionDrag:Xs,onOpenNodeEditor:Zs,onUpdateCanvasPositions:Hs,onRemoveNodes:Ys,updateConnection:Ls,updateSticky:Qs},e)})(Gu),Ku=n(48),Wu=n.n(Ku),Yu=n(72),Hu=n.n(Yu),Xu=function(e){function t(e,n){var a;return Object(p.a)(this,t),a=Object(m.a)(this,Object(v.a)(t).call(this,e,n)),Object(y.react)(Object(f.a)(a),{include:[/^handle/]}),a}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleLanguageChanged",value:function(e){this.props.handleLanguageChange(e)}},{key:"handleLanguageSort",value:function(e,t){return"base"===e.id?-1:"base"===t.id?1:void 0!==e.order&&void 0!==t.order?e.order-t.order:e.name.localeCompare(t.name)}},{key:"render",value:function(){var e=this;if(!this.props.language)return null;var t=Object.keys(this.props.languages.items).map(function(t){return e.props.languages.items[t]}).sort(this.handleLanguageSort);return 1===t.length?null:b.createElement("div",{className:"language-selector"},t.map(function(t,n){return b.createElement("div",{key:"lang_"+t.id,className:Hu.a.language},n>0?b.createElement("div",{className:Hu.a.separator},"|"):null,b.createElement("div",{className:Hu.a.language_link+" "+(e.props.language.id===t.id?Hu.a.active:""),onClick:function(){e.handleLanguageChanged(t)}},t.name))}))}}]),t}(b.Component),Qu=Object(Bn.b)(function(e){var t=e.flowContext.assetStore,n=e.editorState.language;return{languages:t.languages,language:n}},function(e){return Object(de.bindActionCreators)({handleLanguageChange:Fs},e)})(Xu),$u=n(38),Zu=n.n($u),Ju=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).poppedEle=void 0,n.state={width:400},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(){this.state.width!==this.poppedEle.offsetWidth&&this.setState({width:this.poppedEle.offsetWidth})}},{key:"handlePoppedRef",value:function(e){return this.poppedEle=e}},{key:"handleTabClick",value:function(){this.props.onShow()}},{key:"handleClose",value:function(){this.props.onHide()}},{key:"render",value:function(){return b.createElement("div",{className:Zu.a.pop_wrapper+" "+(this.props.visible?Zu.a.visible:""),style:{right:-this.state.width,top:this.props.top}},b.createElement("div",{className:Zu.a.tab_wrapper},b.createElement("div",{className:Zu.a.tab,style:{background:this.props.color},onClick:this.handleTabClick},b.createElement("div",{className:Zu.a.icon},b.createElement("span",{className:this.props.icon})),b.createElement("div",{className:Zu.a.label},this.props.label))),b.createElement("div",{ref:this.handlePoppedRef,className:Zu.a.popped,style:{borderColor:this.props.color,right:this.props.visible?15+this.state.width:0,top:-100}},b.createElement("div",{className:Zu.a.header,style:{background:this.props.color}},b.createElement("div",{className:Zu.a.close+" fe-x",onClick:this.handleClose}),b.createElement("div",{className:Zu.a.header_label},this.props.header)),b.createElement(b.Fragment,null,this.props.children)))}}]),t}(b.Component),ec=n(196),tc=n.n(ec),nc=n(26),ac=n.n(nc),ic=Xe.a.bind(ac.a),rc=function(e){function t(e){var n;return Object(p.a)(this,t),(n=Object(m.a)(this,Object(v.a)(t).call(this,e))).onRevisionClicked=function(e){return function(t){t.stopPropagation(),t.preventDefault(),vt(n.props.assetStore.revisions,e.id).then(function(t){n.props.loadFlowDefinition(t,n.props.assetStore),n.setState({revision:e})})}},n.onRevertClicked=function(e){return function(e){e.stopPropagation(),e.preventDefault(),n.props.createNewRevision(),n.setState({visible:!1,revision:null})}},n.state={revisions:[],revision:null,definition:null,visible:!1},Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"handleUpdateRevisions",value:function(){var e=this;if(null!==this.props.assetStore){var t=this.props.assetStore.revisions;return ct(t.endpoint,t.type,t.id||"id").then(function(t){t.length>0&&(t[0].content.current=!0),e.setState({revisions:t})})}}},{key:"handleTabClicked",value:function(){var e=this;this.setState(function(e){return{visible:!e.visible}},function(){e.state.visible?e.handleUpdateRevisions():e.state.revision&&e.state.revision.id!==e.state.revisions[0].id&&vt(e.props.assetStore.revisions,e.state.revisions[0].id).then(function(t){e.props.loadFlowDefinition(t,e.props.assetStore),e.setState({revision:null})})})}},{key:"render",value:function(){var e,t=this,n=ic((e={},Object(E.a)(e,ac.a.visible,this.state.visible),Object(E.a)(e,ac.a.simulating,this.props.simulating),e));return k.a.createElement("div",{className:n},k.a.createElement("div",{className:ac.a.mask}),k.a.createElement(Ju,{header:"Revisions",color:"#8e5ea7",icon:"fe-time",label:"Revision History",top:"360px",visible:this.state.visible,onShow:this.handleTabClicked,onHide:this.handleTabClicked},k.a.createElement("div",{className:ac.a.explorer_wrapper},k.a.createElement("div",{className:ac.a.explorer},k.a.createElement("div",{className:ac.a.revisions},this.state.revisions.map(function(e){var n=e.content,a=t.state.revision&&e.id===t.state.revision.id,i=n.current||a?ac.a.selected:"";return k.a.createElement("div",{className:ac.a.revision+" "+i,key:"revision_"+e.id,onClick:t.onRevisionClicked(e)},G(n.current)(k.a.createElement("div",{className:ac.a.button+" "+ac.a.current},"current")),G(a&&!n.current)(k.a.createElement("div",{onClick:t.onRevertClicked(e),className:ac.a.button},"revert")),k.a.createElement("div",{className:ac.a.created_on},tc()(new Date(n.created_on),"mmmm d, yyyy, h:MM TT",t.props.utc)),k.a.createElement("div",{className:ac.a.email},n.user.name||n.user.email))}))))))}}]),t}(k.a.Component),oc=qe,sc=n(197),lc=n(198),uc=n.n(lc),cc=Object(de.combineReducers)({flowContext:Ee,editorState:Os,nodeEditor:Zt}),dc={flowContext:ye,editorState:ws,nodeEditor:Xt},pc=[uc.a],hc=n(403).default,mc=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dc;return Object(de.createStore)(cc,e,Object(sc.composeWithDevTools)(de.applyMiddleware.apply(void 0,pc)))}(),vc={config:Be},fc=function(e){function t(e){var n;return Object(p.a)(this,t),n=Object(m.a)(this,Object(v.a)(t).call(this,e)),Object(y.react)(Object(f.a)(n),{include:[/^handle/]}),n}return Object(g.a)(t,e),Object(h.a)(t,[{key:"componentDidMount",value:function(){this.props.fetchFlow(this.context.config.endpoints,this.context.config.flow,this.context.config.onLoad)}},{key:"handleDownloadClicked",value:function(){!function(e,t){var n="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e,null,2)),a=document.createElement("a");a.setAttribute("href",n),a.setAttribute("download",t+".json"),document.body.appendChild(a),a.click(),a.remove()}(ol(this.props.definition,this.props.nodes),"definition")}},{key:"handleVisibilityChanged",value:function(e){this.props.mergeEditorState({visible:e,activityInterval:5e3})}},{key:"getAlertModal",value:function(){var e=this;return this.props.modalMessage?b.createElement(tu,{width:"600px",show:!0},b.createElement(ue,{className:Wu.a.alert_modal,title:this.props.modalMessage.title,headerClass:"alert",buttons:{primary:{name:"Ok",onClick:function(){e.props.mergeEditorState({modalMessage:null})}}}},b.createElement("div",{className:Wu.a.alert_body},this.props.modalMessage.body))):null}},{key:"getSavingIndicator",value:function(){return this.props.saving?b.createElement("div",{className:Wu.a.saving},b.createElement(ce,null,b.createElement(Bl,{units:5,color:"#3498db",size:7}))):null}},{key:"getFooter",value:function(){return!this.props.fetchingFlow&&this.context.config.showDownload?b.createElement("div",{className:Wu.a.footer},b.createElement("div",{className:Wu.a.download_button},b.createElement(ae,{name:"Download",onClick:this.handleDownloadClicked,type:w.primary}))):null}},{key:"render",value:function(){return b.createElement(hc,{onChange:this.handleVisibilityChanged},b.createElement("div",{id:"editor-container",className:this.props.translating?Wu.a.translating:void 0,"data-spec":"editor-container"},this.getFooter(),this.getAlertModal(),b.createElement("div",{className:Wu.a.editor,"data-spec":"editor"},G(this.props.languages&&Object.keys(this.props.languages.items).length>0)(b.createElement(Qu,null)),this.getSavingIndicator(),G(this.props.definition&&this.props.language&&!this.props.fetchingFlow)(b.createElement(qu,null)),b.createElement(rc,{simulating:this.props.simulating,loadFlowDefinition:this.props.loadFlowDefinition,createNewRevision:this.props.createNewRevision,assetStore:this.props.assetStore}))))}}]),t}(b.Component);fc.contextTypes=vc;var gc=Object(Bn.b)(function(e){var t=e.flowContext,n=t.definition,a=t.dependencies,i=t.nodes,r=t.assetStore,o=e.editorState,s=o.translating,l=o.language,u=o.fetchingFlow,c=o.simulating;return{modalMessage:o.modalMessage,saving:o.saving,simulating:c,assetStore:r,translating:s,language:l,fetchingFlow:u,definition:n,dependencies:a,nodes:i,languages:r?r.languages:null}},function(e){return Object(de.bindActionCreators)({fetchFlow:As,loadFlowDefinition:Us,createNewRevision:Rs,mergeEditorState:Ts},e)})(fc),_c=function(e){var t=e.config;return Rt(t.endpoints),b.createElement(oc,{config:Object(_.a)({},t)},b.createElement(Bn.a,{store:mc},b.createElement(gc,null)))},yc=n(27),bc=n.n(yc);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));window.showFlowEditor=function(e,t){bc.a.render(k.a.createElement(_c,{config:t}),e)},"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},43:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",count:"CharCount_count__ABAEX",tooltip:"CharCount_tooltip__1p2RV",fine_print:"CharCount_fine_print__RYzHy",divider:"CharCount_divider__3pF0R",tooltip_text:"CharCount_tooltip_text__3ruDu",unicode:"CharCount_unicode__1nLUL"}},44:function(e,t,n){e.exports={player:"MediaPlayer_player__gYGWS",playing:"MediaPlayer_playing__2Jrw_",button:"MediaPlayer_button__rRXz1",circles:"MediaPlayer_circles__1pr_0",circle_background:"MediaPlayer_circle_background__OMPcS",circle_foreground:"MediaPlayer_circle_foreground__1L6K9"}},45:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",translating_categories:"RouterLocalizationForm_translating_categories__34-3g",translating_category:"RouterLocalizationForm_translating_category__1GtBO",translating_from:"RouterLocalizationForm_translating_from__1jvjb",translating_to:"RouterLocalizationForm_translating_to__1m7uk",translating_operator_title:"RouterLocalizationForm_translating_operator_title__3vA3V",translating_operator_instructions:"RouterLocalizationForm_translating_operator_instructions___Yv3N",translating_operator_container:"RouterLocalizationForm_translating_operator_container__39jsM",translating_operator:"RouterLocalizationForm_translating_operator__AgpTS"}},46:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",titlebar:"TitleBar_titlebar__1_zDw",normal:"TitleBar_normal__z0QaD",remove_confirm:"TitleBar_remove_confirm__3ywj-",remove_button:"TitleBar_remove_button__2lO9D",up_button:"TitleBar_up_button__2Imiq"}},47:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",drag_helper:"DragHelper_drag_helper__a_fFa",visible:"DragHelper_visible__1Z4lg",arrow:"DragHelper_arrow__YH1ED",tail:"DragHelper_tail__12x7O",help_text:"DragHelper_help_text__2luNE",head:"DragHelper_head__3ViUG",bold:"DragHelper_bold__2v--u"}},48:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",editor:"components_editor__36a9s",translating:"components_translating__1uBgy",footer:"components_footer__1OFgP",download_button:"components_download_button__392jz",alert_body:"components_alert_body__2Bxt0",alert_modal:"components_alert_modal__3xFu-",saving:"components_saving__1mebj"}},54:function(e,t,n){e.exports={label:"CheckboxElement_label__3vFGD",title:"CheckboxElement_title__3QShp",description:"CheckboxElement_description__3BguK",description_solo:"CheckboxElement_description_solo__2o0rh"}},55:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",quick_replies:"SendMsg_quick_replies__2bre8",attachment:"SendMsg_attachment__1JoQl",summary:"SendMsg_summary__2c05X",whatsapp:"SendMsg_whatsapp__2O95I",line:"SendMsg_line__LMI4I"}},56:function(e,t,n){e.exports={form_element:"CurrencyElement_form_element__F0wio",transfer:"CurrencyElement_transfer__1IAVm",currency:"CurrencyElement_currency__278L2",amount:"CurrencyElement_amount__fJKsJ",remove:"CurrencyElement_remove__3D5_y"}},65:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",btn:"Button_btn__1hdG6",disabled:"Button_disabled__xk6Qi",primary:"Button_primary__3PDu-",active:"Button_active__3BxT0",secondary:"Button_secondary__1LfJY",tertiary:"Button_tertiary__3UJsa"}},66:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",message:"AssetSelector_message__1viBV"}},67:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",pill:"Pill_pill__3FyMl",clickable:"Pill_clickable__24gn3",icon:"Pill_icon__QZrb0",large:"Pill_large__3mcHa"}},68:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",recipients:"SendBroadcast_recipients__1ZSQV",node:"SendBroadcast_node__26RLX",to:"SendBroadcast_to__25_7K",name:"SendBroadcast_name__RNJWu",icon:"SendBroadcast_icon__2YfpF",more:"SendBroadcast_more__11MJm",message:"SendBroadcast_message__6ZIco",line:"SendBroadcast_line__3Dm3R"}},69:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",lead_in:"MenuRouterForm_lead_in__253j6",digit:"MenuRouterForm_digit__ruJhi",category:"MenuRouterForm_category__2Khjv",menu:"MenuRouterForm_menu__OrNSa",menu_option:"MenuRouterForm_menu_option__2e-jl"}},70:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",lead_in:"RandomRouterForm_lead_in__2iUt2",bucket_select:"RandomRouterForm_bucket_select__5jt8Q",bucket_list:"RandomRouterForm_bucket_list__14I85",bucket_name:"RandomRouterForm_bucket_name__t3I5z"}},71:function(e,t,n){e.exports={timeout_control_container:"TimeoutControl_timeout_control_container__ChGjA",left_section:"TimeoutControl_left_section__23W9H",label:"TimeoutControl_label__3L-JA",checkbox:"TimeoutControl_checkbox__NYV4k",drop_down:"TimeoutControl_drop_down__2Yy9r"}},72:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",language:"LanguageSelector_language__3Q3TZ",language_link:"LanguageSelector_language_link__32yIO",active:"LanguageSelector_active__3RqNy",separator:"LanguageSelector_separator__2oanc"}},87:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13"}},89:function(e,t,n){e.exports={ele:"SendEmailForm_ele__2CvL5",subject:"SendEmailForm_subject__U7jTR",message:"SendEmailForm_message__1k6GE"}},90:function(e,t,n){e.exports={form:"SetRunResultForm_form__HNnt4",name:"SetRunResultForm_name__1aW9R",value:"SetRunResultForm_value__36pab",category:"SetRunResultForm_category__TuHWy"}},91:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",node:"StartSession_node__d1IsL",to:"StartSession_to__2uqPY",name:"StartSession_name__HfSVl",icon:"StartSession_icon__1l-0q",more:"StartSession_more__8uoUD",message:"StartSession_message__1KRsK",flow:"StartSession_flow__zPhXS"}},92:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",canvas_container:"Canvas_canvas_container__oR3SR",canvas:"Canvas_canvas__XH7zY",drag_selection:"Canvas_drag_selection__3wxA2"}},93:function(e,t,n){e.exports={grid_size:"20",node_spacing:"13",node_padding:"3","background-size":"13",counter:"Counter_counter__1_pCt",visible:"Counter_visible__3Avdq",clickable:"Counter_clickable__3pprF"}}},[[200,1,2]]]);
//# sourceMappingURL=main.d152d2bb.chunk.js.map