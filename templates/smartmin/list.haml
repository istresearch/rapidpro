-extends "smartmin/base.html"
-load smartmin

-block extra-style
  :css
    tr.multiselect-header{
      border:0px solid;
    }
    .multiselect-header th a span.icon {
      visibility: hidden;
      text-decoration: none;
      font-size: 14px;
      margin-top: -1px;
    }
    .multiselect-header th a {
      text-decoration: none;
      font-weight:200;
      color: #aaa;
    }
    .multiselect-header th:hover a span.icon {
      visibility: visible;
      font-size: 14px;
    }
    .multiselect-header th a span.icon.visible {
      visibility: visible;
    }
    .multiselect-header th {
      font-size:11px;
      height:10px;
      padding:0;
      padding-top:10px;
      padding-left:14px;
      font-weight:200;
      color: #aaa;
      border:0px solid;
      text-align:center;
      white-space: nowrap;
    }

    .multiselect-header th div {
       width: 14px;
       padding-top: 4px;
    }
    .multiselect-header {
      border: none !important;
    }

-block top-form
  - if view.search_fields and object_list
    - block search-form
      %form
        %input.input-medium.search-query{type:'text', placeholder:'Search', name:"search", value:"{{search}}"}

-block content
  -block table-controls
    .row
      .span12.table-buttons
        - block table-buttons
          - if view.add_button
            %a.btn.btn-primary.pull-right{ href:"./create/" } Add
  {% block pjax %}
  #pjax
    .row-fluid
      .span12
        - block pre-table

        - block table
          .scroll-x
            %table{ class:'{% get_list_class object_list %} list-table table table-striped', cellspacing:'0'}
              %tr.multiselect
                %th{style: 'padding-left:0px'}
                  %a.multiselect-select-all.checkbox.object-row-checkbox.glyph.icon-checkbox-unchecked.contact-checkbox.object-row-checkbox{style: 'padding-left: 5px'}
                  %div{style: 'padding-top: 4px; width: 60px'}
                    Select all
              %thead
                %tr
                  - for field in fields
                    %th{ class:'header-{{field}} {% if view|field_orderable:field %}header {% if field == order %}{% if order_asc %}headerSortUp{% else %}headerSortDown{% endif %}{% endif %}{% endif %}', id:'header-{{field}}' }
                      {% get_label field %}

                %tbody
                  - for obj in object_list
                    %tr{ class:'{% cycle "row2" "row1" %} {% if not obj.is_active and obj|is_smartobject %}inactive{% endif %}'}
                      -for field in fields
                        %td{ class:'value-{{field}} {% get_class field obj %}{% if field in link_fields %} clickable{% endif %}'}
                          - if field in link_fields
                            <a {% if pjax %}data-pjax='{{ pjax }}'{% endif %} href="{% get_field_link field obj %}">{% get_value obj field %}</a>
                          - else
                            {% get_value obj field %}

                  - empty
                    %tr.empty_list
                      - for field in fields
                        %td

          - block extra-rows

        - block post-table

  {% block paginator %}
  .row
    - include "smartmin/sidebar_pagination.haml"

{% endblock pjax %}
{% endblock content %}

{% block extra-script %}
{{ block.super }}
:javascript
  {% if current_label.id %}
    current_label_id = {{current_label.id}};
  {% else %}
    current_label_id = 0;
  {% endif %}
    $(document).on("click", '.multiselect-select-all', function(event) {
      if($(this).hasClass('checked')){
        $(this).removeClass('checked');
        $('tr.checked > td > div.object-row-checkbox').each(function(){
          $(this).click();
        });
      }else{
        $(this).addClass('checked');
        $('tr:not(.checked) > td > div.object-row-checkbox').each(function(){
          $(this).click();
        });
      }
    });

<script>
  $(document).ready(function(){
    $("th.header").click(function(evt){
      // build up our ordering
      var field = evt.target.id.substr(evt.target.id.indexOf("-")+1)

      {% if order_asc %}
      if (field == "{{order}}"){
        field = "-" + field;
      }
      {% endif %}

      document.location = "{{url_params|urlencode}}_order=" + field;
    });
  });
</script>

{% endblock %}
