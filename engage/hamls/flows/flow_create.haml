-extends 'includes/modax.haml'
-load smartmin i18n

-block fields

  .flex.items-start

    .flex-grow
      -render_field 'name'
    .ml-3
      -render_field 'flow_type'

  .keywords(class="{% if form.flow_type.value == 'B' or form.flow_type.value == 'S' %}hidden{%endif%}")
    -render_field 'keyword_triggers'

  .flex.items-start
    -if form.fields.base_language
      .w-half.flex.flex-col
        -render_field 'base_language'

    -if form.fields.expires_after_minutes
      .flex-grow.flex-col
        -render_field 'expires_after_minutes'

  -if form.fields.ignore_triggers
    #field_ignore_triggers.flex.flex-col
      -render_field 'ignore_triggers'

  -if form.fields.flow_channels
    .flex.flex-col{style:"overflow-y: auto;max-height: 8em;"}
      -render_field 'flow_channels'

-block modal-script
  {{block.super}}

  :javascript

    var modalBody = document.querySelector("#create-flow-modal").shadowRoot;
    var typeSelect = modalBody.querySelector("temba-select[name='flow_type']");
    var ignoreTriggers = modalBody.querySelector("#field_ignore_triggers");
    var keywords = modalBody.querySelector(".keywords");
    var keywordsSelect = modalBody.querySelector("temba-select[name='keyword_triggers']");

    typeSelect.addEventListener("change", function(evt) {
        let selected = evt.target.values[0];
        if (selected.value === "B") {
          ignoreTriggers.classList.add("hidden");
        } else {
          ignoreTriggers.classList.remove("hidden");
        }
        if (selected.value === "B" || selected.value === "S") {
          keywords.classList.add("hidden");
          keywordsSelect.clear();
        } else {
          keywords.classList.remove("hidden");
        }
    });
