-extends "smartmin/base.html"
-load smartmin

-block top-form
  - if view.search_fields and object_list
    - block search-form
      %form
        %input.input-medium.search-query{type:'text', placeholder:'Search', name:"search", value:"{{search}}"}

-block content
  -block table-controls
    .row
      .span12.table-buttons
        - block table-buttons
          - if view.add_button
            %a.btn.btn-primary.pull-right{ href:"./create/" } Add
  {% block pjax %}
  #pjax
    -block pre-table
    -block table
      %table.list.lined
        %thead
          %tr
            -for field in fields
              %th{ class:'header-{{field}} {% if view|field_orderable:field %}header {% if field == order %}{% if order_asc %}headerSortUp{% else %}headerSortDown{% endif %}{% endif %}{% endif %}', id:'header-{{field}}' }
                {% get_label field %}

          %tbody
            - for obj in object_list
              %tr{ class:'{% cycle "row2" "row1" %} {% if not obj.is_active and obj|is_smartobject %}inactive{% endif %}'}
                -for field in fields
                  %td{ class:'value-{{field}} {% get_class field obj %}{% if field in link_fields %} clickable{% endif %}'}
                    - if field in link_fields
                      <a {% if pjax %}data-pjax='{{ pjax }}'{% endif %} href="{% get_field_link field obj %}">{% get_value obj field %}</a>
                    - else
                      {% get_value obj field %}

            -empty
              %tr.empty_list
                -for field in fields
                  %td

    -block extra-rows

  -block post-table

  {% block paginator %}
    -include "includes/pagination.haml"

{% endblock pjax %}
{% endblock content %}

{% block extra-script %}
{{ block.super }}
:javascript
  {% if current_label.id %}
    current_label_id = {{current_label.id}};
  {% else %}
    current_label_id = 0;
  {% endif %}
  $(document).on("click", '.multiselect-select-all', function(event) {
    $(this).toggleClass('checked');
    if ( $(this).hasClass('checked') ) {
      $('tr:not(.checked) td temba-checkbox').each(function() { $($(this)[0].shadowRoot).children('temba-field').click();});
    } else {
      $('tr.checked td temba-checkbox').each(function() { $($(this)[0].shadowRoot).children('temba-field').click();});
    }
  });

<script>
  $(document).ready(function(){
    $("th.header").click(function(evt){
      // build up our ordering
      var field = evt.target.id.substr(evt.target.id.indexOf("-")+1)

      {% if order_asc %}
      if (field == "{{order}}"){
        field = "-" + field;
      }
      {% endif %}

      document.location = "{{url_params|urlencode}}_order=" + field;
    });
  });
</script>

{% endblock %}

-block extra-style
  {{block.super}}
  :css
    .multiselect-select-all{
      font-size: 16px !important;
      padding-left: 5px;
      margin-right: 8px;
    }
    .multiselect-select-all a {
        margin-left: 5px;
        margin-right: 5px;
     }

     div.multiselect-header {
        padding-bottom: 0px !important;
        padding-left: 0px !important;
        display: inline;
        vertical-align: sub;
     }
