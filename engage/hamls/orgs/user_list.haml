-extends "smartmin/list.html"
-load smartmin sms temba compress contacts i18n humanize

-block extra-style
  {{block.super}}
  :css
    temba-button {
      display: block;
    }

-block page-title
  {{title}}

-block title-icon
  %span.title-icon
    .glyph.icon-inbox

-block page-top

-block content

  .lp-frame
    .right
      .flex.w-full.items-end.mb-4
        .flex-grow.ml-2.items-center
          -block title-text
            .page-title.leading-tight
              {{title}}
        .gear-links
          -include "gear_links_include.haml"

      %form#search-form.mb-4(method="get")
        %temba-textinput.w-full(placeholder='{% trans "Search" %}' name="search" value="{{search}}")

      -block user-list
        %table.list.object-list.lined{class: 'selectable'}
          %tbody
            -for object in object_list
              %tr.object-row{id: 'id-row-{{object.id}}', data-object-id:'{{ object.id }}'}
                %td.whitespace-nowrap
                  {{ object.contact|short_name:user_org }}
                %td.w-full
                  .flex.flex-wrap.flex-end.items-center.justify-end
                    .flex-grow.inline
                      {% get_value object 'text' %}
                    .labels.flex.items-center.flex-wrap
                      -if 'label' in actions
                        -for label in object.labels.all
                          .lbl.linked.ml-2{onclick:"goto(event, this)", href:"{% url 'msgs.msg_filter' label.uuid %}", data-id: '{{label.id}}'}
                            {{label.name}}

                  -if object.attachments
                    .value-attachments{ style:"margin-top: 5px" }
                      - for attachment in object.attachments
                        {% attachment_button attachment %}

                %td
                  .flex.w-full.items-end.justify-end.pr-4
                    .time.whitespace-nowrap
                      {% short_datetime object.created_on %}

                    -if show_channel_logs and not user_org.is_anon or perms.contacts.contact_break_anon
                      .inline-block.text-gray-400.linked.ml-3
                        {% channel_log_link object %}

            -if not object_list
              %tr.empty_list
                %td{ colspan:'99' }
                  -trans "No messages"

        - block paginator
          -if object_list.count
            -block search-details
              .flex.mx-4.mt-3.mb-16
                .text-gray-700
                  -if not paginator or paginator.num_pages <= 1
                    -if search
                      -blocktrans trimmed with results_count=paginator.count|intcomma count cc=paginator.count
                        Found {{ results_count }} message in last 90 days matching <i>{{search}}</i>.
                        -plural
                          Found {{ results_count }} messages in last 90 days matching <i>{{search}}</i>.
                    -else
                      -if start_date
                        -blocktrans trimmed with results_count=paginator.count|intcomma count cc=paginator.count
                          {{ results_count }} message since {{ start_date}}.
                          -plural
                            {{ results_count }} messages since {{ start_date}}.

                  - else

                    -if search
                      -blocktrans trimmed with results_count=paginator.count|intcomma start=page_obj.start_index|intcomma end=page_obj.end_index|intcomma count cc=paginator.count
                        Found {{ results_count }} message in last 90 days matching <i>{{search}}</i>.
                        -plural
                          {{ start }} - {{ end }} of {{ results_count }} results for <i>{{search}}</i> since {{start_date}}.
                    -else
                      -if start_date
                        -blocktrans trimmed with results_count=paginator.count|intcomma start=page_obj.start_index|intcomma end=page_obj.end_index|intcomma count cc=paginator.count
                          {{ results_count }} message since {{ start_date}}.
                          -plural
                            {{ start }} - {{ end }} of {{ results_count }} messages since {{ start_date}}.

                .flex-grow
                  -include "includes/pages.html"
