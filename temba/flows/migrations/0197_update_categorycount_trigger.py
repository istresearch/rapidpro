# Generated by Django 2.1.8 on 2019-04-22 15:34

from django.db import migrations

SQL = """
CREATE OR REPLACE FUNCTION temba_insert_flowcategorycount(_flow_id integer, result_key text, _result json, _count integer)
 RETURNS void
 LANGUAGE plpgsql
AS $function$
  BEGIN
    IF _result->>'category' IS NOT NULL THEN
      INSERT INTO flows_flowcategorycount("flow_id", "node_uuid", "result_key", "result_name", "category_name", "count", "is_squashed")
        VALUES(_flow_id, (_result->>'node_uuid')::uuid, result_key, _result->>'name', _result->>'category', _count, FALSE);
    END IF;
  END;
$function$;
"""


class Migration(migrations.Migration):

    dependencies = [("flows", "0196_populate_results_and_waiting_exits")]

    operations = [migrations.RunSQL(SQL, "")]
