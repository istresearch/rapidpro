# Generated by Django 2.2.20 on 2021-07-22 20:46

from django.db import migrations


def noop(apps, schema_editor):  # pragma: no cover
    pass


def populate_wa_api_version(apps, schema_editor):  # pragma: no cover
    Channel = apps.get_model("channels", "Channel")

    for channel in Channel.objects.filter(is_active=True, channel_type="WA"):
        base_url = channel.config.get("base_url")
        if base_url.startswith("https://whatsapp.turn.io") or base_url.startswith("https://whatsapp.praekelt.org"):
            continue
        if not channel.config.get("version"):
            channel.config.update(version="v2.33.4")


class Migration(migrations.Migration):

    dependencies = [
        ("channels", "0127_auto_20210715_1825"),
    ]

    operations = [migrations.RunPython(populate_wa_api_version, noop)]
