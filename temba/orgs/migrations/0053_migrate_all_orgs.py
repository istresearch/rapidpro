# Generated by Django 2.1.8 on 2019-06-07 16:54

from django.db import migrations, models


def migrate_all_orgs(apps, schema_editor):
    from temba.orgs.models import Org

    num_converted = 0
    for org in Org.objects.filter(flow_server_enabled=False):
        org.enable_flow_server()
        num_converted += 1

    if num_converted:
        print(f"Converted {num_converted} orgs to use mailroom")


class Migration(migrations.Migration):

    dependencies = [("orgs", "0052_populate_org_uuid")]

    operations = [
        migrations.RunPython(migrate_all_orgs),
        migrations.AlterField(
            model_name="org",
            name="flow_server_enabled",
            field=models.BooleanField(
                default=True, help_text="Whether flows and messages should be handled by mailroom"
            ),
        ),
    ]
